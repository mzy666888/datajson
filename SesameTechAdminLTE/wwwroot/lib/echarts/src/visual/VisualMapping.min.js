/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/visual/VisualMapping.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import*as zrColor from"zrender/src/tool/color";import{linearMap}from"../util/number";var each=zrUtil.each,isObject=zrUtil.isObject,CATEGORY_DEFAULT_VISUAL_INDEX=-1,VisualMapping=function(i){var a=i.mappingMethod,r=i.type,e=this.option=zrUtil.clone(i);this.type=r,this.mappingMethod=a,this._normalizeData=normalizers[a];var t=visualHandlers[r];this.applyVisual=t.applyVisual,this.getColorMapper=t.getColorMapper,this._doMap=t._doMap[a],"piecewise"===a?(normalizeVisualRange(e),preprocessForPiecewise(e)):"category"===a?e.categories?preprocessForSpecifiedCategory(e):normalizeVisualRange(e,!0):(zrUtil.assert("linear"!==a||e.dataExtent),normalizeVisualRange(e))};VisualMapping.prototype={constructor:VisualMapping,mapValueToVisual:function(i){var a=this._normalizeData(i);return this._doMap(a,i)},getNormalizer:function(){return zrUtil.bind(this._normalizeData,this)}};var visualHandlers=VisualMapping.visualHandlers={color:{applyVisual:makeApplyVisual("color"),getColorMapper:function(){var i=this.option;return zrUtil.bind("category"===i.mappingMethod?function(i,a){return!a&&(i=this._normalizeData(i)),doMapCategory.call(this,i)}:function(a,r,e){var t=!!e;return!r&&(a=this._normalizeData(a)),e=zrColor.fastLerp(a,i.parsedVisual,e),t?e:zrColor.stringify(e,"rgba")},this)},_doMap:{linear:function(i){return zrColor.stringify(zrColor.fastLerp(i,this.option.parsedVisual),"rgba")},category:doMapCategory,piecewise:function(i,a){var r=getSpecifiedVisual.call(this,a);return null==r&&(r=zrColor.stringify(zrColor.fastLerp(i,this.option.parsedVisual),"rgba")),r},fixed:doMapFixed}},colorHue:makePartialColorVisualHandler(function(i,a){return zrColor.modifyHSL(i,a)}),colorSaturation:makePartialColorVisualHandler(function(i,a){return zrColor.modifyHSL(i,null,a)}),colorLightness:makePartialColorVisualHandler(function(i,a){return zrColor.modifyHSL(i,null,null,a)}),colorAlpha:makePartialColorVisualHandler(function(i,a){return zrColor.modifyAlpha(i,a)}),opacity:{applyVisual:makeApplyVisual("opacity"),_doMap:makeDoMap([0,1])},liftZ:{applyVisual:makeApplyVisual("liftZ"),_doMap:{linear:doMapFixed,category:doMapFixed,piecewise:doMapFixed,fixed:doMapFixed}},symbol:{applyVisual:function(i,a,r){var e=this.mapValueToVisual(i);if(zrUtil.isString(e))r("symbol",e);else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&r(t,e[t])},_doMap:{linear:doMapToArray,category:doMapCategory,piecewise:function(i,a){var r=getSpecifiedVisual.call(this,a);return null==r&&(r=doMapToArray.call(this,i)),r},fixed:doMapFixed}},symbolSize:{applyVisual:makeApplyVisual("symbolSize"),_doMap:makeDoMap([0,1])}};function preprocessForPiecewise(i){var a=i.pieceList;i.hasSpecialVisual=!1,zrUtil.each(a,function(a,r){a.originIndex=r,null!=a.visual&&(i.hasSpecialVisual=!0)})}function preprocessForSpecifiedCategory(i){var a=i.categories,r=i.visual,e=i.categoryMap={};if(each(a,function(i,a){e[i]=a}),!zrUtil.isArray(r)){var t=[];zrUtil.isObject(r)?each(r,function(i,a){var r=e[a];t[null!=r?r:CATEGORY_DEFAULT_VISUAL_INDEX]=i}):t[CATEGORY_DEFAULT_VISUAL_INDEX]=r,r=setVisualToOption(i,t)}for(var n=a.length-1;n>=0;n--)null==r[n]&&(delete e[a[n]],a.pop())}function normalizeVisualRange(i,a){var r=i.visual,e=[];zrUtil.isObject(r)?each(r,function(i){e.push(i)}):null!=r&&e.push(r);a||1!==e.length||{color:1,symbol:1}.hasOwnProperty(i.type)||(e[1]=e[0]),setVisualToOption(i,e)}function makePartialColorVisualHandler(i){return{applyVisual:function(a,r,e){a=this.mapValueToVisual(a),e("color",i(r("color"),a))},_doMap:makeDoMap([0,1])}}function doMapToArray(i){var a=this.option.visual;return a[Math.round(linearMap(i,[0,1],[0,a.length-1],!0))]||{}}function makeApplyVisual(i){return function(a,r,e){e(i,this.mapValueToVisual(a))}}function doMapCategory(i){var a=this.option.visual;return a[this.option.loop&&i!==CATEGORY_DEFAULT_VISUAL_INDEX?i%a.length:i]}function doMapFixed(){return this.option.visual[0]}function makeDoMap(i){return{linear:function(a){return linearMap(a,i,this.option.visual,!0)},category:doMapCategory,piecewise:function(a,r){var e=getSpecifiedVisual.call(this,r);return null==e&&(e=linearMap(a,i,this.option.visual,!0)),e},fixed:doMapFixed}}function getSpecifiedVisual(i){var a=this.option,r=a.pieceList;if(a.hasSpecialVisual){var e=r[VisualMapping.findPieceIndex(i,r)];if(e&&e.visual)return e.visual[this.type]}}function setVisualToOption(i,a){return i.visual=a,"color"===i.type&&(i.parsedVisual=zrUtil.map(a,function(i){return zrColor.parse(i)})),a}var normalizers={linear:function(i){return linearMap(i,this.option.dataExtent,[0,1],!0)},piecewise:function(i){var a=this.option.pieceList,r=VisualMapping.findPieceIndex(i,a,!0);if(null!=r)return linearMap(r,[0,a.length-1],[0,1],!0)},category:function(i){var a=this.option.categories?this.option.categoryMap[i]:i;return null==a?CATEGORY_DEFAULT_VISUAL_INDEX:a},fixed:zrUtil.noop};function littleThan(i,a,r){return i?a<=r:a<r}VisualMapping.listVisualTypes=function(){var i=[];return zrUtil.each(visualHandlers,function(a,r){i.push(r)}),i},VisualMapping.addVisualHandler=function(i,a){visualHandlers[i]=a},VisualMapping.isValidType=function(i){return visualHandlers.hasOwnProperty(i)},VisualMapping.eachVisual=function(i,a,r){zrUtil.isObject(i)?zrUtil.each(i,a,r):a.call(r,i)},VisualMapping.mapVisual=function(i,a,r){var e,t=zrUtil.isArray(i)?[]:zrUtil.isObject(i)?{}:(e=!0,null);return VisualMapping.eachVisual(i,function(i,n){var l=a.call(r,i,n);e?t=l:t[n]=l}),t},VisualMapping.retrieveVisuals=function(i){var a,r={};return i&&each(visualHandlers,function(e,t){i.hasOwnProperty(t)&&(r[t]=i[t],a=!0)}),a?r:null},VisualMapping.prepareVisualTypes=function(i){if(isObject(i)){var a=[];each(i,function(i,r){a.push(r)}),i=a}else{if(!zrUtil.isArray(i))return[];i=i.slice()}return i.sort(function(i,a){return"color"===a&&"color"!==i&&0===i.indexOf("color")?1:-1}),i},VisualMapping.dependsOn=function(i,a){return"color"===a?!(!i||0!==i.indexOf(a)):i===a},VisualMapping.findPieceIndex=function(i,a,r){for(var e,t=1/0,n=0,l=a.length;n<l;n++){var o=a[n].value;if(null!=o){if(o===i||"string"==typeof o&&o===i+"")return n;r&&c(o,n)}}for(n=0,l=a.length;n<l;n++){var s=a[n],u=s.interval,p=s.close;if(u){if(u[0]===-1/0){if(littleThan(p[1],i,u[1]))return n}else if(u[1]===1/0){if(littleThan(p[0],u[0],i))return n}else if(littleThan(p[0],u[0],i)&&littleThan(p[1],i,u[1]))return n;r&&c(u[0],n),r&&c(u[1],n)}}if(r)return i===1/0?a.length-1:i===-1/0?0:e;function c(a,r){var n=Math.abs(a-i);n<t&&(t=n,e=r)}};export default VisualMapping;
//# sourceMappingURL=/sm/5adcf67f179cb72ce463383cb852ec356a07da2e45a16b0dd3529021941f9aad.map