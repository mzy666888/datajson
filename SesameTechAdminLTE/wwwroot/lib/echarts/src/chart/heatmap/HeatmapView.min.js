/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/heatmap/HeatmapView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../../config";import*as echarts from"../../echarts";import*as graphic from"../../util/graphic";import HeatmapLayer from"./HeatmapLayer";import*as zrUtil from"zrender/src/core/util";function getIsInPiecewiseRange(e,t,a){var i=e[1]-e[0],n=(t=zrUtil.map(t,function(t){return{interval:[(t.interval[0]-e[0])/i,(t.interval[1]-e[0])/i]}})).length,r=0;return function(e){for(var i=r;i<n;i++){if((o=t[i].interval)[0]<=e&&e<=o[1]){r=i;break}}if(i===n)for(i=r-1;i>=0;i--){var o;if((o=t[i].interval)[0]<=e&&e<=o[1]){r=i;break}}return i>=0&&i<n&&a[i]}}function getIsInContinuousRange(e,t){var a=e[1]-e[0];return t=[(t[0]-e[0])/a,(t[1]-e[0])/a],function(e){return e>=t[0]&&e<=t[1]}}function isGeoCoordSys(e){var t=e.dimensions;return"lng"===t[0]&&"lat"===t[1]}export default echarts.extendChartView({type:"heatmap",render:function(e,t,a){var i;if(t.eachComponent("visualMap",function(t){t.eachTargetSeries(function(a){a===e&&(i=t)})}),__DEV__&&!i)throw new Error("Heatmap must use with visualMap");this.group.removeAll(),this._incrementalDisplayable=null;var n=e.coordinateSystem;"cartesian2d"===n.type||"calendar"===n.type?this._renderOnCartesianAndCalendar(e,a,0,e.getData().count()):isGeoCoordSys(n)&&this._renderOnGeo(n,e,i,a)},incrementalPrepareRender:function(e,t,a){this.group.removeAll()},incrementalRender:function(e,t,a,i){t.coordinateSystem&&this._renderOnCartesianAndCalendar(t,i,e.start,e.end,!0)},_renderOnCartesianAndCalendar:function(e,t,a,i,n){var r,o,s=e.coordinateSystem;if("cartesian2d"===s.type){var l=s.getAxis("x"),m=s.getAxis("y");if(__DEV__){if("category"!==l.type||"category"!==m.type)throw new Error("Heatmap on cartesian must have two category axes");if(!l.onBand||!m.onBand)throw new Error("Heatmap on cartesian must have two axes with boundaryGap true")}r=l.getBandWidth(),o=m.getBandWidth()}for(var g=this.group,c=e.getData(),p=e.getModel("itemStyle").getItemStyle(["color"]),u=e.getModel("emphasis.itemStyle").getItemStyle(),h=e.getModel("label"),d=e.getModel("emphasis.label"),y=s.type,f="cartesian2d"===y?[c.mapDimension("x"),c.mapDimension("y"),c.mapDimension("value")]:[c.mapDimension("time"),c.mapDimension("value")],v=a;v<i;v++){var w;if("cartesian2d"===y){if(isNaN(c.get(f[2],v)))continue;var I=s.dataToPoint([c.get(f[0],v),c.get(f[1],v)]);w=new graphic.Rect({shape:{x:I[0]-r/2,y:I[1]-o/2,width:r,height:o},style:{fill:c.getItemVisual(v,"color"),opacity:c.getItemVisual(v,"opacity")}})}else{if(isNaN(c.get(f[1],v)))continue;w=new graphic.Rect({z2:1,shape:s.dataToRect([c.get(f[0],v)]).contentShape,style:{fill:c.getItemVisual(v,"color"),opacity:c.getItemVisual(v,"opacity")}})}var S=c.getItemModel(v);c.hasItemOption&&(p=S.getModel("itemStyle").getItemStyle(["color"]),u=S.getModel("emphasis.itemStyle").getItemStyle(),h=S.getModel("label"),d=S.getModel("emphasis.label"));var x=e.getRawValue(v),_="-";x&&null!=x[2]&&(_=x[2]),graphic.setLabelStyle(p,u,h,d,{labelFetcher:e,labelDataIndex:v,defaultText:_,isRectText:!0}),w.setStyle(p),graphic.setHoverStyle(w,c.hasItemOption?u:zrUtil.extend({},u)),w.incremental=n,n&&(w.useHoverLayer=!0),g.add(w),c.setItemGraphicEl(v,w)}},_renderOnGeo:function(e,t,a,i){var n=a.targetVisuals.inRange,r=a.targetVisuals.outOfRange,o=t.getData(),s=this._hmLayer||this._hmLayer||new HeatmapLayer;s.blurSize=t.get("blurSize"),s.pointSize=t.get("pointSize"),s.minOpacity=t.get("minOpacity"),s.maxOpacity=t.get("maxOpacity");var l=e.getViewRect().clone(),m=e.getRoamTransform();l.applyTransform(m);var g=Math.max(l.x,0),c=Math.max(l.y,0),p=Math.min(l.width+l.x,i.getWidth()),u=Math.min(l.height+l.y,i.getHeight()),h=p-g,d=u-c,y=[o.mapDimension("lng"),o.mapDimension("lat"),o.mapDimension("value")],f=o.mapArray(y,function(t,a,i){var n=e.dataToPoint([t,a]);return n[0]-=g,n[1]-=c,n.push(i),n}),v=a.getExtent(),w="visualMap.continuous"===a.type?getIsInContinuousRange(v,a.option.range):getIsInPiecewiseRange(v,a.getPieceList(),a.option.selected);s.update(f,h,d,n.color.getNormalizer(),{inRange:n.color.getColorMapper(),outOfRange:r.color.getColorMapper()},w);var I=new graphic.Image({style:{width:h,height:d,x:g,y:c,image:s.canvas},silent:!0});this.group.add(I)},dispose:function(){}});
//# sourceMappingURL=/sm/918a797d81fa49ca965201b29cd71ce67b48165ea4a613a54cf5ab42c0567f88.map