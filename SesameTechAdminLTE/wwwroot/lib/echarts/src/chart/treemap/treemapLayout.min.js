/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/treemap/treemapLayout.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import BoundingRect from"zrender/src/core/BoundingRect";import{parsePercent,MAX_SAFE_INTEGER}from"../../util/number";import*as layout from"../../util/layout";import*as helper from"../helper/treeHelper";var mathMax=Math.max,mathMin=Math.min,retrieveValue=zrUtil.retrieve,each=zrUtil.each,PATH_BORDER_WIDTH=["itemStyle","borderWidth"],PATH_GAP_WIDTH=["itemStyle","gapWidth"],PATH_UPPER_LABEL_SHOW=["upperLabel","show"],PATH_UPPER_LABEL_HEIGHT=["upperLabel","height"];export default{seriesType:"treemap",reset:function(e,t,a,r){var i=a.getWidth(),o=a.getHeight(),n=e.option,u=layout.getLayoutRect(e.getBoxLayoutParams(),{width:a.getWidth(),height:a.getHeight()}),h=n.size||[],l=parsePercent(retrieveValue(u.width,h[0]),i),g=parsePercent(retrieveValue(u.height,h[1]),o),s=r&&r.type,d=helper.retrieveTargetInfo(r,["treemapZoomToNode","treemapRootToNode"],e),v="treemapRender"===s||"treemapMove"===s?r.rootRect:null,f=e.getViewRoot(),p=helper.getPathToRoot(f);if("treemapMove"!==s){var c="treemapZoomToNode"===s?estimateRootSize(e,d,f,l,g):v?[v.width,v.height]:[l,g],m=n.sort;m&&"asc"!==m&&"desc"!==m&&(m="desc");var y={squareRatio:n.squareRatio,sort:m,leafDepth:n.leafDepth};f.hostTree.clearLayouts();var L={x:0,y:0,width:c[0],height:c[1],area:c[0]*c[1]};f.setLayout(L),squarify(f,y,!1,0);L=f.getLayout();each(p,function(e,t){var a=(p[t+1]||f).getValue();e.setLayout(zrUtil.extend({dataExtent:[a,a],borderWidth:0,upperHeight:0},L))})}var R=e.getData().tree.root;R.setLayout(calculateRootPosition(u,v,d),!0),e.setLayoutInfo(u),prunning(R,new BoundingRect(-u.x,-u.y,i,o),p,f,0)}};function squarify(e,t,a,r){var i,o;if(!e.isRemoved()){var n=e.getLayout();i=n.width,o=n.height;var u=(v=e.getModel()).get(PATH_BORDER_WIDTH),h=v.get(PATH_GAP_WIDTH)/2,l=getUpperLabelHeight(v),g=Math.max(u,l),s=u-h,d=g-h,v=e.getModel();e.setLayout({borderWidth:u,upperHeight:g,upperLabelHeight:l},!0);var f=(i=mathMax(i-2*s,0))*(o=mathMax(o-s-d,0)),p=initChildren(e,v,f,t,a,r);if(p.length){var c={x:s,y:d,width:i,height:o},m=mathMin(i,o),y=1/0,L=[];L.area=0;for(var R=0,x=p.length;R<x;){var H=p[R];L.push(H),L.area+=H.getLayout().area;var T=worst(L,m,t.squareRatio);T<=y?(R++,y=T):(L.area-=L.pop().getLayout().area,position(L,m,c,h,!1),m=mathMin(c.width,c.height),L.length=L.area=0,y=1/0)}if(L.length&&position(L,m,c,h,!0),!a){var _=v.get("childrenVisibleMin");null!=_&&f<_&&(a=!0)}for(R=0,x=p.length;R<x;R++)squarify(p[R],t,a,r+1)}}}function initChildren(e,t,a,r,i,o){var n=e.children||[],u=r.sort;"asc"!==u&&"desc"!==u&&(u=null);var h=null!=r.leafDepth&&r.leafDepth<=o;if(i&&!h)return e.viewChildren=[];sort(n=zrUtil.filter(n,function(e){return!e.isRemoved()}),u);var l=statistic(t,n,u);if(0===l.sum)return e.viewChildren=[];if(l.sum=filterByThreshold(t,a,l.sum,u,n),0===l.sum)return e.viewChildren=[];for(var g=0,s=n.length;g<s;g++){var d=n[g].getValue()/l.sum*a;n[g].setLayout({area:d})}return h&&(n.length&&e.setLayout({isLeafRoot:!0},!0),n.length=0),e.viewChildren=n,e.setLayout({dataExtent:l.dataExtent},!0),n}function filterByThreshold(e,t,a,r,i){if(!r)return a;for(var o=e.get("visibleMin"),n=i.length,u=n,h=n-1;h>=0;h--){var l=i["asc"===r?n-h-1:h].getValue();l/a*t<o&&(u=h,a-=l)}return"asc"===r?i.splice(0,n-u):i.splice(u,n-u),a}function sort(e,t){return t&&e.sort(function(e,a){var r="asc"===t?e.getValue()-a.getValue():a.getValue()-e.getValue();return 0===r?"asc"===t?e.dataIndex-a.dataIndex:a.dataIndex-e.dataIndex:r}),e}function statistic(e,t,a){for(var r=0,i=0,o=t.length;i<o;i++)r+=t[i].getValue();var n=e.get("visualDimension");if(t&&t.length)if("value"===n&&a)u=[t[t.length-1].getValue(),t[0].getValue()],"asc"===a&&u.reverse();else{var u=[1/0,-1/0];each(t,function(e){var t=e.getValue(n);t<u[0]&&(u[0]=t),t>u[1]&&(u[1]=t)})}else u=[NaN,NaN];return{sum:r,dataExtent:u}}function worst(e,t,a){for(var r,i=0,o=1/0,n=0,u=e.length;n<u;n++)(r=e[n].getLayout().area)&&(r<o&&(o=r),r>i&&(i=r));var h=e.area*e.area,l=t*t*a;return h?mathMax(l*i/h,h/(l*o)):1/0}function position(e,t,a,r,i){var o=t===a.width?0:1,n=1-o,u=["x","y"],h=["width","height"],l=a[u[o]],g=t?e.area/t:0;(i||g>a[h[n]])&&(g=a[h[n]]);for(var s=0,d=e.length;s<d;s++){var v=e[s],f={},p=g?v.getLayout().area/g:0,c=f[h[n]]=mathMax(g-2*r,0),m=a[u[o]]+a[h[o]]-l,y=s===d-1||m<p?m:p,L=f[h[o]]=mathMax(y-2*r,0);f[u[n]]=a[u[n]]+mathMin(r,c/2),f[u[o]]=l+mathMin(r,L/2),l+=y,v.setLayout(f,!0)}a[u[n]]+=g,a[h[n]]-=g}function estimateRootSize(e,t,a,r,i){var o,n=(t||{}).node,u=[r,i];if(!n||n===a)return u;for(var h=r*i,l=h*e.option.zoomToNodeRatio;o=n.parentNode;){for(var g=0,s=o.children,d=0,v=s.length;d<v;d++)g+=s[d].getValue();var f=n.getValue();if(0===f)return u;l*=g/f;var p=o.getModel(),c=p.get(PATH_BORDER_WIDTH);(l+=4*c*c+(3*c+Math.max(c,getUpperLabelHeight(p,c)))*Math.pow(l,.5))>MAX_SAFE_INTEGER&&(l=MAX_SAFE_INTEGER),n=o}l<h&&(l=h);var m=Math.pow(l/h,.5);return[r*m,i*m]}function calculateRootPosition(e,t,a){if(t)return{x:t.x,y:t.y};var r={x:0,y:0};if(!a)return r;var i=a.node,o=i.getLayout();if(!o)return r;for(var n=[o.width/2,o.height/2],u=i;u;){var h=u.getLayout();n[0]+=h.x,n[1]+=h.y,u=u.parentNode}return{x:e.width/2-n[0],y:e.height/2-n[1]}}function prunning(e,t,a,r,i){var o=e.getLayout(),n=a[i],u=n&&n===e;if(!(n&&!u||i===a.length&&e!==r)){e.setLayout({isInView:!0,invisible:!u&&!t.intersect(o),isAboveViewRoot:u},!0);var h=new BoundingRect(t.x-o.x,t.y-o.y,t.width,t.height);each(e.viewChildren||[],function(e){prunning(e,h,a,r,i+1)})}}function getUpperLabelHeight(e){return e.get(PATH_UPPER_LABEL_SHOW)?e.get(PATH_UPPER_LABEL_HEIGHT):0}
//# sourceMappingURL=/sm/746240edf0134c98c5a5175071116bd66dcef36a5f8c87b55ff7bd8954572415.map