/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/helper/LargeSymbolDraw.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as graphic from"../../util/graphic";import{createSymbol}from"../../util/symbol";import IncrementalDisplayable from"zrender/src/graphic/IncrementalDisplayable";var BOOST_SIZE_THRESHOLD=4,LargeSymbolPath=graphic.extendShape({shape:{points:null},symbolProxy:null,softClipShape:null,buildPath:function(e,t){var a=t.points,r=t.size,o=this.symbolProxy,n=o.shape;if(!((e.getContext?e.getContext():e)&&r[0]<BOOST_SIZE_THRESHOLD))for(var l=0;l<a.length;){var i=a[l++],s=a[l++];isNaN(i)||isNaN(s)||(this.softClipShape&&!this.softClipShape.contain(i,s)||(n.x=i-r[0]/2,n.y=s-r[1]/2,n.width=r[0],n.height=r[1],o.buildPath(e,n,!0)))}},afterBrush:function(e){var t=this.shape,a=t.points,r=t.size;if(r[0]<BOOST_SIZE_THRESHOLD){this.setTransform(e);for(var o=0;o<a.length;){var n=a[o++],l=a[o++];isNaN(n)||isNaN(l)||(this.softClipShape&&!this.softClipShape.contain(n,l)||e.fillRect(n-r[0]/2,l-r[1]/2,r[0],r[1]))}this.restoreTransform(e)}},findDataIndex:function(e,t){for(var a=this.shape,r=a.points,o=a.size,n=Math.max(o[0],4),l=Math.max(o[1],4),i=r.length/2-1;i>=0;i--){var s=2*i,h=r[s]-n/2,m=r[s+1]-l/2;if(e>=h&&t>=m&&e<=h+n&&t<=m+l)return i}return-1}});function LargeSymbolDraw(){this.group=new graphic.Group}var largeSymbolProto=LargeSymbolDraw.prototype;largeSymbolProto.isPersistent=function(){return!this._incremental},largeSymbolProto.updateData=function(e,t){this.group.removeAll();var a=new LargeSymbolPath({rectHover:!0,cursor:"default"});a.setShape({points:e.getLayout("symbolPoints")}),this._setCommon(a,e,!1,t),this.group.add(a),this._incremental=null},largeSymbolProto.updateLayout=function(e){if(!this._incremental){var t=e.getLayout("symbolPoints");this.group.eachChild(function(e){if(null!=e.startIndex){var a=2*(e.endIndex-e.startIndex),r=4*e.startIndex*2;t=new Float32Array(t.buffer,r,a)}e.setShape("points",t)})}},largeSymbolProto.incrementalPrepareUpdate=function(e){this.group.removeAll(),this._clearIncremental(),e.count()>2e6?(this._incremental||(this._incremental=new IncrementalDisplayable({silent:!0})),this.group.add(this._incremental)):this._incremental=null},largeSymbolProto.incrementalUpdate=function(e,t,a){var r;this._incremental?(r=new LargeSymbolPath,this._incremental.addDisplayable(r,!0)):((r=new LargeSymbolPath({rectHover:!0,cursor:"default",startIndex:e.start,endIndex:e.end})).incremental=!0,this.group.add(r)),r.setShape({points:t.getLayout("symbolPoints")}),this._setCommon(r,t,!!this._incremental,a)},largeSymbolProto._setCommon=function(e,t,a,r){var o=t.hostModel;r=r||{};var n=t.getVisual("symbolSize");e.setShape("size",n instanceof Array?n:[n,n]),e.softClipShape=r.clipShape||null,e.symbolProxy=createSymbol(t.getVisual("symbol"),0,0,0,0),e.setColor=e.symbolProxy.setColor;var l=e.shape.size[0]<BOOST_SIZE_THRESHOLD;e.useStyle(o.getModel("itemStyle").getItemStyle(l?["color","shadowBlur","shadowColor"]:["color"]));var i=t.getVisual("color");i&&e.setColor(i),a||(e.seriesIndex=o.seriesIndex,e.on("mousemove",function(t){e.dataIndex=null;var a=e.findDataIndex(t.offsetX,t.offsetY);a>=0&&(e.dataIndex=a+(e.startIndex||0))}))},largeSymbolProto.remove=function(){this._clearIncremental(),this._incremental=null,this.group.removeAll()},largeSymbolProto._clearIncremental=function(){var e=this._incremental;e&&e.clearDisplaybles()};export default LargeSymbolDraw;
//# sourceMappingURL=/sm/f78c94ca5a0da2e4ae16a24fe3bfbaddbdc603c8f85fe71d6acc4cbaf4046e6d.map