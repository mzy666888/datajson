/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/helper/Line.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import*as vector from"zrender/src/core/vector";import*as symbolUtil from"../../util/symbol";import LinePath from"./LinePath";import*as graphic from"../../util/graphic";import{round}from"../../util/number";var SYMBOL_CATEGORIES=["fromSymbol","toSymbol"];function makeSymbolTypeKey(t){return"_"+t+"Type"}function createSymbol(t,e,i){var o=e.getItemVisual(i,"color"),a=e.getItemVisual(i,t),l=e.getItemVisual(i,t+"Size");if(a&&"none"!==a){zrUtil.isArray(l)||(l=[l,l]);var r=symbolUtil.createSymbol(a,-l[0]/2,-l[1]/2,l[0],l[1],o);return r.name=t,r}}function createLine(t){var e=new LinePath({name:"line",subPixelOptimize:!0});return setLinePoints(e.shape,t),e}function setLinePoints(t,e){t.x1=e[0][0],t.y1=e[0][1],t.x2=e[1][0],t.y2=e[1][1],t.percent=1;var i=e[2];i?(t.cpx1=i[0],t.cpy1=i[1]):(t.cpx1=NaN,t.cpy1=NaN)}function updateSymbolAndLabelBeforeLineUpdate(){var t=this.childOfName("fromSymbol"),e=this.childOfName("toSymbol"),i=this.childOfName("label");if(t||e||!i.ignore){for(var o=1,a=this.parent;a;)a.scale&&(o/=a.scale[0]),a=a.parent;var l=this.childOfName("line");if(this.__dirty||l.__dirty){var r=l.shape.percent,n=l.pointAt(0),s=l.pointAt(r),h=vector.sub([],s,n);if(vector.normalize(h,h),t){t.attr("position",n);var m=l.tangentAt(0);t.attr("rotation",Math.PI/2-Math.atan2(m[1],m[0])),t.attr("scale",[o*r,o*r])}if(e){e.attr("position",s);m=l.tangentAt(1);e.attr("rotation",-Math.PI/2-Math.atan2(m[1],m[0])),e.attr("scale",[o*r,o*r])}if(!i.ignore){var c,p,d;i.attr("position",s);var g=5*o;if("end"===i.__position)c=[h[0]*g+s[0],h[1]*g+s[1]],p=h[0]>.8?"left":h[0]<-.8?"right":"center",d=h[1]>.8?"top":h[1]<-.8?"bottom":"middle";else if("middle"===i.__position){var y=r/2,f=[(m=l.tangentAt(y))[1],-m[0]],u=l.pointAt(y);f[1]>0&&(f[0]=-f[0],f[1]=-f[1]),c=[u[0]+f[0]*g,u[1]+f[1]*g],p="center",d="bottom";var S=-Math.atan2(m[1],m[0]);s[0]<n[0]&&(S=Math.PI+S),i.attr("rotation",S)}else c=[-h[0]*g+n[0],-h[1]*g+n[1]],p=h[0]>.8?"right":h[0]<-.8?"left":"center",d=h[1]>.8?"bottom":h[1]<-.8?"top":"middle";i.attr({style:{textVerticalAlign:i.__verticalAlign||d,textAlign:i.__textAlign||p},position:c,scale:[o,o]})}}}}function Line(t,e,i){graphic.Group.call(this),this._createLine(t,e,i)}var lineProto=Line.prototype;lineProto.beforeUpdate=updateSymbolAndLabelBeforeLineUpdate,lineProto._createLine=function(t,e,i){var o=t.hostModel,a=createLine(t.getItemLayout(e));a.shape.percent=0,graphic.initProps(a,{shape:{percent:1}},o,e),this.add(a);var l=new graphic.Text({name:"label",lineLabelOriginalOpacity:1});this.add(l),zrUtil.each(SYMBOL_CATEGORIES,function(i){var o=createSymbol(i,t,e);this.add(o),this[makeSymbolTypeKey(i)]=t.getItemVisual(e,i)},this),this._updateCommonStl(t,e,i)},lineProto.updateData=function(t,e,i){var o=t.hostModel,a=this.childOfName("line"),l=t.getItemLayout(e),r={shape:{}};setLinePoints(r.shape,l),graphic.updateProps(a,r,o,e),zrUtil.each(SYMBOL_CATEGORIES,function(i){var o=t.getItemVisual(e,i),a=makeSymbolTypeKey(i);if(this[a]!==o){this.remove(this.childOfName(i));var l=createSymbol(i,t,e);this.add(l)}this[a]=o},this),this._updateCommonStl(t,e,i)},lineProto._updateCommonStl=function(t,e,i){var o=t.hostModel,a=this.childOfName("line"),l=i&&i.lineStyle,r=i&&i.hoverLineStyle,n=i&&i.labelModel,s=i&&i.hoverLabelModel;if(!i||t.hasItemOption){var h=t.getItemModel(e);l=h.getModel("lineStyle").getLineStyle(),r=h.getModel("emphasis.lineStyle").getLineStyle(),n=h.getModel("label"),s=h.getModel("emphasis.label")}var m=t.getItemVisual(e,"color"),c=zrUtil.retrieve3(t.getItemVisual(e,"opacity"),l.opacity,1);a.useStyle(zrUtil.defaults({strokeNoScale:!0,fill:"none",stroke:m,opacity:c},l)),a.hoverStyle=r,zrUtil.each(SYMBOL_CATEGORIES,function(t){var e=this.childOfName(t);e&&(e.setColor(m),e.setStyle({opacity:c}))},this);var p,d,g=n.getShallow("show"),y=s.getShallow("show"),f=this.childOfName("label");if((g||y)&&(p=m||"#000",null==(d=o.getFormattedLabel(e,"normal",t.dataType)))){var u=o.getRawValue(e);d=null==u?t.getName(e):isFinite(u)?round(u):u}var S=g?d:null,v=y?zrUtil.retrieve2(o.getFormattedLabel(e,"emphasis",t.dataType),d):null,L=f.style;null==S&&null==v||(graphic.setTextStyle(f.style,n,{text:S},{autoColor:p}),f.__textAlign=L.textAlign,f.__verticalAlign=L.textVerticalAlign,f.__position=n.get("position")||"middle"),f.hoverStyle=null!=v?{text:v,textFill:s.getTextColor(!0),fontStyle:s.getShallow("fontStyle"),fontWeight:s.getShallow("fontWeight"),fontSize:s.getShallow("fontSize"),fontFamily:s.getShallow("fontFamily")}:{text:null},f.ignore=!g&&!y,graphic.setHoverStyle(this)},lineProto.highlight=function(){this.trigger("emphasis")},lineProto.downplay=function(){this.trigger("normal")},lineProto.updateLayout=function(t,e){this.setLinePoints(t.getItemLayout(e))},lineProto.setLinePoints=function(t){var e=this.childOfName("line");setLinePoints(e.shape,t),e.dirty()},zrUtil.inherits(Line,graphic.Group);export default Line;
//# sourceMappingURL=/sm/b2a09f6144cd1f00bd82c240978b64350ea16807342e2d6147a7f4d96ca25acd.map