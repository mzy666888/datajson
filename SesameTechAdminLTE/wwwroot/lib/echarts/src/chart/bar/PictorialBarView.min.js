/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/bar/PictorialBarView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as echarts from"../../echarts";import*as zrUtil from"zrender/src/core/util";import*as graphic from"../../util/graphic";import{createSymbol}from"../../util/symbol";import{parsePercent,isNumeric}from"../../util/number";import{setLabel}from"./helper";var BAR_BORDER_WIDTH_QUERY=["itemStyle","borderWidth"],LAYOUT_ATTRS=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],pathForLineWidth=new graphic.Circle,BarView=echarts.extendChartView({type:"pictorialBar",render:function(e,t,a){var i=this.group,o=e.getData(),r=this._data,n=e.coordinateSystem,l=!!n.getBaseAxis().isHorizontal(),s=n.grid.getRect(),c={ecSize:{width:a.getWidth(),height:a.getHeight()},seriesModel:e,coordSys:n,coordSysExtent:[[s.x,s.x+s.width],[s.y,s.y+s.height]],isHorizontal:l,valueDim:LAYOUT_ATTRS[+l],categoryDim:LAYOUT_ATTRS[1-l]};return o.diff(r).add(function(e){if(o.hasValue(e)){var t=getItemModel(o,e),a=getSymbolMeta(o,e,t,c),r=createBar(o,c,a);o.setItemGraphicEl(e,r),i.add(r),updateCommon(r,c,a)}}).update(function(e,t){var a=r.getItemGraphicEl(t);if(o.hasValue(e)){var n=getItemModel(o,e),l=getSymbolMeta(o,e,n,c),s=getShapeStr(o,l);a&&s!==a.__pictorialShapeStr&&(i.remove(a),o.setItemGraphicEl(e,null),a=null),a?updateBar(a,c,l):a=createBar(o,c,l,!0),o.setItemGraphicEl(e,a),a.__pictorialSymbolMeta=l,i.add(a),updateCommon(a,c,l)}else i.remove(a)}).remove(function(e){var t=r.getItemGraphicEl(e);t&&removeBar(r,e,t.__pictorialSymbolMeta.animationModel,t)}).execute(),this._data=o,this.group},dispose:zrUtil.noop,remove:function(e,t){var a=this.group,i=this._data;e.get("animation")?i&&i.eachItemGraphicEl(function(t){removeBar(i,t.dataIndex,e,t)}):a.removeAll()}});function getSymbolMeta(e,t,a,i){var o=e.getItemLayout(t),r=a.get("symbolRepeat"),n=a.get("symbolClip"),l=a.get("symbolPosition")||"start",s=(a.get("symbolRotate")||0)*Math.PI/180||0,c=a.get("symbolPatternSize")||2,p=a.isAnimationEnabled(),m={dataIndex:t,layout:o,itemModel:a,symbolType:e.getItemVisual(t,"symbol")||"circle",color:e.getItemVisual(t,"color"),symbolClip:n,symbolRepeat:r,symbolRepeatDirection:a.get("symbolRepeatDirection"),symbolPatternSize:c,rotation:s,animationModel:p?a:null,hoverAnimation:p&&a.get("hoverAnimation"),z2:a.getShallow("z",!0)||0};prepareBarLength(a,r,o,i,m),prepareSymbolSize(e,t,o,r,n,m.boundingLength,m.pxSign,c,i,m),prepareLineWidth(a,m.symbolScale,s,i,m);var d=m.symbolSize,h=a.get("symbolOffset");return zrUtil.isArray(h)&&(h=[parsePercent(h[0],d[0]),parsePercent(h[1],d[1])]),prepareLayoutInfo(a,d,o,r,n,h,l,m.valueLineWidth,m.boundingLength,m.repeatCutLength,i,m),m}function prepareBarLength(e,t,a,i,o){var r,n=i.valueDim,l=e.get("symbolBoundingData"),s=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis()),c=s.toGlobalCoord(s.dataToCoord(0)),p=1-+(a[n.wh]<=0);if(zrUtil.isArray(l)){var m=[convertToCoordOnAxis(s,l[0])-c,convertToCoordOnAxis(s,l[1])-c];m[1]<m[0]&&m.reverse(),r=m[p]}else r=null!=l?convertToCoordOnAxis(s,l)-c:t?i.coordSysExtent[n.index][p]-c:a[n.wh];o.boundingLength=r,t&&(o.repeatCutLength=a[n.wh]),o.pxSign=r>0?1:r<0?-1:0}function convertToCoordOnAxis(e,t){return e.toGlobalCoord(e.dataToCoord(e.scale.parse(t)))}function prepareSymbolSize(e,t,a,i,o,r,n,l,s,c){var p=s.valueDim,m=s.categoryDim,d=Math.abs(a[m.wh]),h=e.getItemVisual(t,"symbolSize");zrUtil.isArray(h)?h=h.slice():(null==h&&(h="100%"),h=[h,h]),h[m.index]=parsePercent(h[m.index],d),h[p.index]=parsePercent(h[p.index],i?d:Math.abs(r)),c.symbolSize=h,(c.symbolScale=[h[0]/l,h[1]/l])[p.index]*=(s.isHorizontal?-1:1)*n}function prepareLineWidth(e,t,a,i,o){var r=e.get(BAR_BORDER_WIDTH_QUERY)||0;r&&(pathForLineWidth.attr({scale:t.slice(),rotation:a}),pathForLineWidth.updateTransform(),r/=pathForLineWidth.getLineScale(),r*=t[i.valueDim.index]),o.valueLineWidth=r}function prepareLayoutInfo(e,t,a,i,o,r,n,l,s,c,p,m){var d=p.categoryDim,h=p.valueDim,u=m.pxSign,g=Math.max(t[h.index]+l,0),y=g;if(i){var b=Math.abs(s),S=zrUtil.retrieve(e.get("symbolMargin"),"15%")+"",v=!1;S.lastIndexOf("!")===S.length-1&&(v=!0,S=S.slice(0,S.length-1)),S=parsePercent(S,t[h.index]);var f=Math.max(g+2*S,0),_=v?0:2*S,x=isNumeric(i),P=x?i:toIntTimes((b+_)/f);f=g+2*(S=(b-P*g)/2/(v?P:P-1)),_=v?0:2*S,x||"fixed"===i||(P=c?toIntTimes((Math.abs(c)+_)/f):0),y=P*f-_,m.repeatTimes=P,m.symbolMargin=S}var A=u*(y/2),M=m.pathPosition=[];M[d.index]=a[d.wh]/2,M[h.index]="start"===n?A:"end"===n?s-A:s/2,r&&(M[0]+=r[0],M[1]+=r[1]);var R=m.bundlePosition=[];R[d.index]=a[d.xy],R[h.index]=a[h.xy];var I=m.barRectShape=zrUtil.extend({},a);I[h.wh]=u*Math.max(Math.abs(a[h.wh]),Math.abs(M[h.index]+A)),I[d.wh]=a[d.wh];var B=m.clipShape={};B[d.xy]=-a[d.xy],B[d.wh]=p.ecSize[d.wh],B[h.xy]=0,B[h.wh]=a[h.wh]}function createPath(e){var t=e.symbolPatternSize,a=createSymbol(e.symbolType,-t/2,-t/2,t,t,e.color);return a.attr({culling:!0}),"image"!==a.type&&a.setStyle({strokeNoScale:!0}),a}function createOrUpdateRepeatSymbols(e,t,a,i){var o=e.__pictorialBundle,r=a.symbolSize,n=a.valueLineWidth,l=a.pathPosition,s=t.valueDim,c=a.repeatTimes||0,p=0,m=r[t.valueDim.index]+n+2*a.symbolMargin;for(eachPath(e,function(e){e.__pictorialAnimationIndex=p,e.__pictorialRepeatTimes=c,p<c?updateAttr(e,null,u(p),a,i):updateAttr(e,null,{scale:[0,0]},a,i,function(){o.remove(e)}),updateHoverAnimation(e,a),p++});p<c;p++){var d=createPath(a);d.__pictorialAnimationIndex=p,d.__pictorialRepeatTimes=c,o.add(d);var h=u(p);updateAttr(d,{position:h.position,scale:[0,0]},{scale:h.scale,rotation:h.rotation},a,i),d.on("mouseover",g).on("mouseout",y),updateHoverAnimation(d,a)}function u(e){var t=l.slice(),i=a.pxSign,o=e;return("start"===a.symbolRepeatDirection?i>0:i<0)&&(o=c-1-e),t[s.index]=m*(o-c/2+.5)+l[s.index],{position:t,scale:a.symbolScale.slice(),rotation:a.rotation}}function g(){eachPath(e,function(e){e.trigger("emphasis")})}function y(){eachPath(e,function(e){e.trigger("normal")})}}function createOrUpdateSingleSymbol(e,t,a,i){var o=e.__pictorialBundle,r=e.__pictorialMainPath;r?updateAttr(r,null,{position:a.pathPosition.slice(),scale:a.symbolScale.slice(),rotation:a.rotation},a,i):(r=e.__pictorialMainPath=createPath(a),o.add(r),updateAttr(r,{position:a.pathPosition.slice(),scale:[0,0],rotation:a.rotation},{scale:a.symbolScale.slice()},a,i),r.on("mouseover",function(){this.trigger("emphasis")}).on("mouseout",function(){this.trigger("normal")})),updateHoverAnimation(r,a)}function createOrUpdateBarRect(e,t,a){var i=zrUtil.extend({},t.barRectShape),o=e.__pictorialBarRect;o?updateAttr(o,null,{shape:i},t,a):(o=e.__pictorialBarRect=new graphic.Rect({z2:2,shape:i,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),e.add(o))}function createOrUpdateClip(e,t,a,i){if(a.symbolClip){var o=e.__pictorialClipPath,r=zrUtil.extend({},a.clipShape),n=t.valueDim,l=a.animationModel,s=a.dataIndex;if(o)graphic.updateProps(o,{shape:r},l,s);else{r[n.wh]=0,o=new graphic.Rect({shape:r}),e.__pictorialBundle.setClipPath(o),e.__pictorialClipPath=o;var c={};c[n.wh]=a.clipShape[n.wh],graphic[i?"updateProps":"initProps"](o,{shape:c},l,s)}}}function getItemModel(e,t){var a=e.getItemModel(t);return a.getAnimationDelayParams=getAnimationDelayParams,a.isAnimationEnabled=isAnimationEnabled,a}function getAnimationDelayParams(e){return{index:e.__pictorialAnimationIndex,count:e.__pictorialRepeatTimes}}function isAnimationEnabled(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function updateHoverAnimation(e,t){e.off("emphasis").off("normal");var a=t.symbolScale.slice();t.hoverAnimation&&e.on("emphasis",function(){this.animateTo({scale:[1.1*a[0],1.1*a[1]]},400,"elasticOut")}).on("normal",function(){this.animateTo({scale:a.slice()},400,"elasticOut")})}function createBar(e,t,a,i){var o=new graphic.Group,r=new graphic.Group;return o.add(r),o.__pictorialBundle=r,r.attr("position",a.bundlePosition.slice()),a.symbolRepeat?createOrUpdateRepeatSymbols(o,t,a):createOrUpdateSingleSymbol(o,t,a),createOrUpdateBarRect(o,a,i),createOrUpdateClip(o,t,a,i),o.__pictorialShapeStr=getShapeStr(e,a),o.__pictorialSymbolMeta=a,o}function updateBar(e,t,a){var i=a.animationModel,o=a.dataIndex,r=e.__pictorialBundle;graphic.updateProps(r,{position:a.bundlePosition.slice()},i,o),a.symbolRepeat?createOrUpdateRepeatSymbols(e,t,a,!0):createOrUpdateSingleSymbol(e,t,a,!0),createOrUpdateBarRect(e,a,!0),createOrUpdateClip(e,t,a,!0)}function removeBar(e,t,a,i){var o=i.__pictorialBarRect;o&&(o.style.text=null);var r=[];eachPath(i,function(e){r.push(e)}),i.__pictorialMainPath&&r.push(i.__pictorialMainPath),i.__pictorialClipPath&&(a=null),zrUtil.each(r,function(e){graphic.updateProps(e,{scale:[0,0]},a,t,function(){i.parent&&i.parent.remove(i)})}),e.setItemGraphicEl(t,null)}function getShapeStr(e,t){return[e.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function eachPath(e,t,a){zrUtil.each(e.__pictorialBundle.children(),function(i){i!==e.__pictorialBarRect&&t.call(a,i)})}function updateAttr(e,t,a,i,o,r){t&&e.attr(t),i.symbolClip&&!o?a&&e.attr(a):a&&graphic[o?"updateProps":"initProps"](e,a,i.animationModel,i.dataIndex,r)}function updateCommon(e,t,a){var i=a.color,o=a.dataIndex,r=a.itemModel,n=r.getModel("itemStyle").getItemStyle(["color"]),l=r.getModel("emphasis.itemStyle").getItemStyle(),s=r.getShallow("cursor");eachPath(e,function(e){e.setColor(i),e.setStyle(zrUtil.defaults({fill:i,opacity:a.opacity},n)),graphic.setHoverStyle(e,l),s&&(e.cursor=s),e.z2=a.z2});var c={},p=t.valueDim.posDesc[+(a.boundingLength>0)],m=e.__pictorialBarRect;setLabel(m.style,c,r,i,t.seriesModel,o,p),graphic.setHoverStyle(m,c)}function toIntTimes(e){var t=Math.round(e);return Math.abs(e-t)<1e-4?t:Math.ceil(e)}export default BarView;
//# sourceMappingURL=/sm/2b938f512e892a9b4d1c97f9399cd627bc540cbfdc7e5b51d82aed24d87e996d.map