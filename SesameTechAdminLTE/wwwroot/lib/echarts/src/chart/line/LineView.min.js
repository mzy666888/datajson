/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/line/LineView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../../config";import*as zrUtil from"zrender/src/core/util";import SymbolDraw from"../helper/SymbolDraw";import SymbolClz from"../helper/Symbol";import lineAnimationDiff from"./lineAnimationDiff";import*as graphic from"../../util/graphic";import*as modelUtil from"../../util/model";import{Polyline,Polygon}from"./poly";import ChartView from"../../view/Chart";import{prepareDataCoordInfo,getStackedOnPoint}from"./helper";import{createGridClipPath,createPolarClipPath}from"../helper/createClipPathFromCoordSys";function isPointsSame(t,e){if(t.length===e.length){for(var o=0;o<t.length;o++){var i=t[o],n=e[o];if(i[0]!==n[0]||i[1]!==n[1])return}return!0}}function getSmooth(t){return"number"==typeof t?t:t?.5:0}function getStackedOnPoints(t,e,o){if(!o.valueDim)return[];for(var i=[],n=0,r=e.count();n<r;n++)i.push(getStackedOnPoint(o,t,e,n));return i}function turnPointsIntoStep(t,e,o){for(var i=e.getBaseAxis(),n="x"===i.dim||"radius"===i.dim?0:1,r=[],a=0;a<t.length-1;a++){var s=t[a+1],l=t[a];r.push(l);var p=[];switch(o){case"end":p[n]=s[n],p[1-n]=l[1-n],r.push(p);break;case"middle":var h=(l[n]+s[n])/2,u=[];p[n]=u[n]=h,p[1-n]=l[1-n],u[1-n]=s[1-n],r.push(p),r.push(u);break;default:p[n]=l[n],p[1-n]=s[1-n],r.push(p)}}return t[a]&&r.push(t[a]),r}function getVisualGradient(t,e){var o=t.getVisual("visualMeta");if(o&&o.length&&t.count())if("cartesian2d"===e.type){for(var i,n,r=o.length-1;r>=0;r--){var a=o[r].dimension,s=t.dimensions[a],l=t.getDimensionInfo(s);if("x"===(i=l&&l.coordDim)||"y"===i){n=o[r];break}}if(n){var p=e.getAxis(i),h=zrUtil.map(n.stops,function(t){return{coord:p.toGlobalCoord(p.dataToCoord(t.value)),color:t.color}}),u=h.length,c=n.outerColors.slice();u&&h[0].coord>h[u-1].coord&&(h.reverse(),c.reverse());var m=h[0].coord-10,d=h[u-1].coord+10,g=d-m;if(g<.001)return"transparent";zrUtil.each(h,function(t){t.offset=(t.coord-m)/g}),h.push({offset:u?h[u-1].offset:.5,color:c[1]||"transparent"}),h.unshift({offset:u?h[0].offset:.5,color:c[0]||"transparent"});var f=new graphic.LinearGradient(0,0,0,0,h,!0);return f[i]=m,f[i+"2"]=d,f}__DEV__&&console.warn("Visual map on line style only support x or y dimension.")}else __DEV__&&console.warn("Visual map on line style is only supported on cartesian2d.")}function getIsIgnoreFunc(t,e,o){var i=t.get("showAllSymbol"),n="auto"===i;if(!i||n){var r=o.getAxesByScale("ordinal")[0];if(r&&(!n||!canShowAllSymbolForCategory(r,e))){var a=e.mapDimension(r.dim),s={};return zrUtil.each(r.getViewLabels(),function(t){s[t.tickValue]=1}),function(t){return!s.hasOwnProperty(e.get(a,t))}}}}function canShowAllSymbolForCategory(t,e){var o=t.getExtent(),i=Math.abs(o[1]-o[0])/t.scale.count();isNaN(i)&&(i=0);for(var n=e.count(),r=Math.max(1,Math.round(n/5)),a=0;a<n;a+=r)if(1.5*SymbolClz.getSymbolSize(e,a)[t.isHorizontal()?1:0]>i)return!1;return!0}function createLineClipPath(t,e,o){if("cartesian2d"===t.type){var i=t.getBaseAxis().isHorizontal(),n=createGridClipPath(t,e,o);if(!o.get("clip",!0)){var r=n.shape,a=Math.max(r.width,r.height);i?(r.y-=a,r.height+=2*a):(r.x-=a,r.width+=2*a)}return n}return createPolarClipPath(t,e,o)}export default ChartView.extend({type:"line",init:function(){var t=new graphic.Group,e=new SymbolDraw;this.group.add(e.group),this._symbolDraw=e,this._lineGroup=t},render:function(t,e,o){var i=t.coordinateSystem,n=this.group,r=t.getData(),a=t.getModel("lineStyle"),s=t.getModel("areaStyle"),l=r.mapArray(r.getItemLayout),p="polar"===i.type,h=this._coordSys,u=this._symbolDraw,c=this._polyline,m=this._polygon,d=this._lineGroup,g=t.get("animation"),f=!s.isEmpty(),y=s.get("origin"),_=getStackedOnPoints(i,r,prepareDataCoordInfo(i,r,y)),v=t.get("showSymbol"),S=v&&!p&&getIsIgnoreFunc(t,r,i),P=this._data;P&&P.eachItemGraphicEl(function(t,e){t.__temp&&(n.remove(t),P.setItemGraphicEl(e,null))}),v||u.remove(),n.add(d);var w,I=!p&&t.get("step");i&&i.getArea&&(null!=(w=i.getArea()).width?(w.x-=.1,w.y-=.1,w.width+=.2,w.height+=.2):w.r0&&(w.r0-=.5,w.r1+=.5)),c&&h.type===i.type&&I===this._step?(f&&!m?m=this._newPolygon(l,_,i,g):m&&!f&&(d.remove(m),m=this._polygon=null),d.setClipPath(createLineClipPath(i,!1,t)),v&&u.updateData(r,{isIgnore:S,clipShape:w}),r.eachItemGraphicEl(function(t){t.stopAnimation(!0)}),isPointsSame(this._stackedOnPoints,_)&&isPointsSame(this._points,l)||(g?this._updateAnimation(r,_,i,o,I,y):(I&&(l=turnPointsIntoStep(l,i,I),_=turnPointsIntoStep(_,i,I)),c.setShape({points:l}),m&&m.setShape({points:l,stackedOnPoints:_})))):(v&&u.updateData(r,{isIgnore:S,clipShape:w}),I&&(l=turnPointsIntoStep(l,i,I),_=turnPointsIntoStep(_,i,I)),c=this._newPolyline(l,i,g),f&&(m=this._newPolygon(l,_,i,g)),d.setClipPath(createLineClipPath(i,!0,t)));var C=getVisualGradient(r,i)||r.getVisual("color");c.useStyle(zrUtil.defaults(a.getLineStyle(),{fill:"none",stroke:C,lineJoin:"bevel"}));var b=t.get("smooth");if(b=getSmooth(t.get("smooth")),c.setShape({smooth:b,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")}),m){var D=r.getCalculationInfo("stackedOnSeries"),G=0;m.useStyle(zrUtil.defaults(s.getAreaStyle(),{fill:C,opacity:.7,lineJoin:"bevel"})),D&&(G=getSmooth(D.get("smooth"))),m.setShape({smooth:b,stackedOnSmooth:G,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")})}this._data=r,this._coordSys=i,this._stackedOnPoints=_,this._points=l,this._step=I,this._valueOrigin=y},dispose:function(){},highlight:function(t,e,o,i){var n=t.getData(),r=modelUtil.queryDataIndex(n,i);if(!(r instanceof Array)&&null!=r&&r>=0){var a=n.getItemGraphicEl(r);if(!a){var s=n.getItemLayout(r);if(!s)return;(a=new SymbolClz(n,r)).position=s,a.setZ(t.get("zlevel"),t.get("z")),a.ignore=isNaN(s[0])||isNaN(s[1]),a.__temp=!0,n.setItemGraphicEl(r,a),a.stopSymbolAnimation(!0),this.group.add(a)}a.highlight()}else ChartView.prototype.highlight.call(this,t,e,o,i)},downplay:function(t,e,o,i){var n=t.getData(),r=modelUtil.queryDataIndex(n,i);if(null!=r&&r>=0){var a=n.getItemGraphicEl(r);a&&(a.__temp?(n.setItemGraphicEl(r,null),this.group.remove(a)):a.downplay())}else ChartView.prototype.downplay.call(this,t,e,o,i)},_newPolyline:function(t){var e=this._polyline;return e&&this._lineGroup.remove(e),e=new Polyline({shape:{points:t},silent:!0,z2:10}),this._lineGroup.add(e),this._polyline=e,e},_newPolygon:function(t,e){var o=this._polygon;return o&&this._lineGroup.remove(o),o=new Polygon({shape:{points:t,stackedOnPoints:e},silent:!0}),this._lineGroup.add(o),this._polygon=o,o},_updateAnimation:function(t,e,o,i,n,r){var a=this._polyline,s=this._polygon,l=t.hostModel,p=lineAnimationDiff(this._data,t,this._stackedOnPoints,e,this._coordSys,o,this._valueOrigin,r),h=p.current,u=p.stackedOnCurrent,c=p.next,m=p.stackedOnNext;n&&(h=turnPointsIntoStep(p.current,o,n),u=turnPointsIntoStep(p.stackedOnCurrent,o,n),c=turnPointsIntoStep(p.next,o,n),m=turnPointsIntoStep(p.stackedOnNext,o,n)),a.shape.__points=p.current,a.shape.points=h,graphic.updateProps(a,{shape:{points:c}},l),s&&(s.setShape({points:h,stackedOnPoints:u}),graphic.updateProps(s,{shape:{points:c,stackedOnPoints:m}},l));for(var d=[],g=p.status,f=0;f<g.length;f++){if("="===g[f].cmd){var y=t.getItemGraphicEl(g[f].idx1);y&&d.push({el:y,ptIdx:f})}}a.animators&&a.animators.length&&a.animators[0].during(function(){for(var t=0;t<d.length;t++){d[t].el.attr("position",a.shape.__points[d[t].ptIdx])}})},remove:function(t){var e=this.group,o=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),o&&o.eachItemGraphicEl(function(t,i){t.__temp&&(e.remove(t),o.setItemGraphicEl(i,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._data=null}});
//# sourceMappingURL=/sm/56b3672d832e674d2024a1f781a467dcffc3588e1a591df36c4a70ac6b302825.map