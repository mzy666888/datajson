/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/tree/TreeView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import*as graphic from"../../util/graphic";import SymbolClz from"../helper/Symbol";import{radialCoordinate}from"./layoutHelper";import*as echarts from"../../echarts";import*as bbox from"zrender/src/core/bbox";import View from"../../coord/View";import*as roamHelper from"../../component/helper/roamHelper";import RoamController from"../../component/helper/RoamController";import{onIrrelevantElement}from"../../component/helper/cursorHelper";export default echarts.extendChartView({type:"tree",init:function(e,t){this._oldTree,this._mainGroup=new graphic.Group,this._controller=new RoamController(t.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},render:function(e,t,o,a){var r=e.getData(),i=e.layoutInfo,n=this._mainGroup,l=e.get("layout");"radial"===l?n.attr("position",[i.x+i.width/2,i.y+i.height/2]):n.attr("position",[i.x,i.y]),this._updateViewCoordSys(e,i,l),this._updateController(e,t,o);var d=this._data,s={expandAndCollapse:e.get("expandAndCollapse"),layout:l,orient:e.getOrient(),curvature:e.get("lineStyle.curveness"),symbolRotate:e.get("symbolRotate"),symbolOffset:e.get("symbolOffset"),hoverAnimation:e.get("hoverAnimation"),useNameLabel:!0,fadeIn:!0};r.diff(d).add(function(t){symbolNeedsDraw(r,t)&&updateNode(r,t,null,n,e,s)}).update(function(t,o){var a=d.getItemGraphicEl(o);symbolNeedsDraw(r,t)?updateNode(r,t,a,n,e,s):a&&removeNode(d,o,a,n,e,s)}).remove(function(t){var o=d.getItemGraphicEl(t);o&&removeNode(d,t,o,n,e,s)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),!0===s.expandAndCollapse&&r.eachItemGraphicEl(function(t,a){t.off("click").on("click",function(){o.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:a})})}),this._data=r},_updateViewCoordSys:function(e){var t=e.getData(),o=[];t.each(function(e){var a=t.getItemLayout(e);!a||isNaN(a.x)||isNaN(a.y)||o.push([+a.x,+a.y])});var a=[],r=[];bbox.fromPoints(o,a,r);var i=this._min,n=this._max;r[0]-a[0]==0&&(a[0]=i?i[0]:a[0]-1,r[0]=n?n[0]:r[0]+1),r[1]-a[1]==0&&(a[1]=i?i[1]:a[1]-1,r[1]=n?n[1]:r[1]+1);var l=e.coordinateSystem=new View;l.zoomLimit=e.get("scaleLimit"),l.setBoundingRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),l.setCenter(e.get("center")),l.setZoom(e.get("zoom")),this.group.attr({position:l.position,scale:l.scale}),this._viewCoordSys=l,this._min=a,this._max=r},_updateController:function(e,t,o){var a=this._controller,r=this._controllerHost,i=this.group;a.setPointerChecker(function(t,a,r){var n=i.getBoundingRect();return n.applyTransform(i.transform),n.contain(a,r)&&!onIrrelevantElement(t,o,e)}),a.enable(e.get("roam")),r.zoomLimit=e.get("scaleLimit"),r.zoom=e.coordinateSystem.getZoom(),a.off("pan").off("zoom").on("pan",function(t){roamHelper.updateViewOnPan(r,t.dx,t.dy),o.dispatchAction({seriesId:e.id,type:"treeRoam",dx:t.dx,dy:t.dy})},this).on("zoom",function(t){roamHelper.updateViewOnZoom(r,t.scale,t.originX,t.originY),o.dispatchAction({seriesId:e.id,type:"treeRoam",zoom:t.scale,originX:t.originX,originY:t.originY}),this._updateNodeAndLinkScale(e)},this)},_updateNodeAndLinkScale:function(e){var t=e.getData(),o=this._getNodeGlobalScale(e),a=[o,o];t.eachItemGraphicEl(function(e,t){e.attr("scale",a)})},_getNodeGlobalScale:function(e){var t=e.coordinateSystem;if("view"!==t.type)return 1;var o=this._nodeScaleRatio,a=t.scale,r=a&&a[0]||1;return((t.getZoom()-1)*o+1)/r},dispose:function(){this._controller&&this._controller.dispose(),this._controllerHost={}},remove:function(){this._mainGroup.removeAll(),this._data=null}});function symbolNeedsDraw(e,t){var o=e.getItemLayout(t);return o&&!isNaN(o.x)&&!isNaN(o.y)&&"none"!==e.getItemVisual(t,"symbol")}function getTreeNodeStyle(e,t,o){return o.itemModel=t,o.itemStyle=t.getModel("itemStyle").getItemStyle(),o.hoverItemStyle=t.getModel("emphasis.itemStyle").getItemStyle(),o.lineStyle=t.getModel("lineStyle").getLineStyle(),o.labelModel=t.getModel("label"),o.hoverLabelModel=t.getModel("emphasis.label"),!1===e.isExpand&&0!==e.children.length?o.symbolInnerColor=o.itemStyle.fill:o.symbolInnerColor="#fff",o}function updateNode(e,t,o,a,r,i){var n=!o,l=e.tree.getNodeByDataIndex(t),d=l.getModel(),s=(i=getTreeNodeStyle(l,d,i),e.tree.root),p=l.parentNode===s?l:l.parentNode||l,c=e.getItemGraphicEl(p.dataIndex),m=p.getLayout(),u=c?{x:c.position[0],y:c.position[1],rawX:c.__radialOldRawX,rawY:c.__radialOldRawY}:m,h=l.getLayout();n?(o=new SymbolClz(e,t,i)).attr("position",[u.x,u.y]):o.updateData(e,t,i),o.__radialOldRawX=o.__radialRawX,o.__radialOldRawY=o.__radialRawY,o.__radialRawX=h.rawX,o.__radialRawY=h.rawY,a.add(o),e.setItemGraphicEl(t,o),graphic.updateProps(o,{position:[h.x,h.y]},r);var y=o.getSymbolPath();if("radial"===i.layout){var g,f,x=s.children[0],_=x.getLayout(),v=x.children.length;if(h.x===_.x&&!0===l.isExpand){var S={};S.x=(x.children[0].getLayout().x+x.children[v-1].getLayout().x)/2,S.y=(x.children[0].getLayout().y+x.children[v-1].getLayout().y)/2,(g=Math.atan2(S.y-_.y,S.x-_.x))<0&&(g=2*Math.PI+g),(f=S.x<_.x)&&(g-=Math.PI)}else(g=Math.atan2(h.y-_.y,h.x-_.x))<0&&(g=2*Math.PI+g),0===l.children.length||0!==l.children.length&&!1===l.isExpand?(f=h.x<_.x)&&(g-=Math.PI):(f=h.x>_.x)||(g-=Math.PI);var N=f?"left":"right",w=i.labelModel.get("rotate"),I=w*(Math.PI/180);y.setStyle({textPosition:i.labelModel.get("position")||N,textRotation:null==w?-g:I,textOrigin:"center",verticalAlign:"middle"})}if(l.parentNode&&l.parentNode!==s){var b=o.__edge;b||(b=o.__edge=new graphic.BezierCurve({shape:getEdgeShape(i,u,u),style:zrUtil.defaults({opacity:0,strokeNoScale:!0},i.lineStyle)})),graphic.updateProps(b,{shape:getEdgeShape(i,m,h),style:{opacity:1}},r),a.add(b)}}function removeNode(e,t,o,a,r,i){for(var n,l=e.tree.getNodeByDataIndex(t),d=e.tree.root,s=l.getModel(),p=(i=getTreeNodeStyle(l,s,i),l.parentNode===d?l:l.parentNode||l);null==(n=p.getLayout());)p=p.parentNode===d?p:p.parentNode||p;graphic.updateProps(o,{position:[n.x+1,n.y+1]},r,function(){a.remove(o),e.setItemGraphicEl(t,null)}),o.fadeOut(null,{keepLabel:!0});var c=o.__edge;c&&graphic.updateProps(c,{shape:getEdgeShape(i,n,n),style:{opacity:0}},r,function(){a.remove(c)})}function getEdgeShape(e,t,o){var a,r,i,n,l,d,s,p,c=e.orient;if("radial"===e.layout){l=t.rawX,s=t.rawY,d=o.rawX,p=o.rawY;var m=radialCoordinate(l,s),u=radialCoordinate(l,s+(p-s)*e.curvature),h=radialCoordinate(d,p+(s-p)*e.curvature),y=radialCoordinate(d,p);return{x1:m.x,y1:m.y,x2:y.x,y2:y.y,cpx1:u.x,cpy1:u.y,cpx2:h.x,cpy2:h.y}}return l=t.x,s=t.y,d=o.x,p=o.y,"LR"!==c&&"RL"!==c||(a=l+(d-l)*e.curvature,r=s,i=d+(l-d)*e.curvature,n=p),"TB"!==c&&"BT"!==c||(a=l,r=s+(p-s)*e.curvature,i=d,n=p+(s-p)*e.curvature),{x1:l,y1:s,x2:d,y2:p,cpx1:a,cpy1:r,cpx2:i,cpy2:n}}
//# sourceMappingURL=/sm/114efbe8a42a10d776c5929262a72211e7d3c45f62713c47b2d0e815d4a4c658.map