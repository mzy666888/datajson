/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/graph/GraphView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as echarts from"../../echarts";import*as zrUtil from"zrender/src/core/util";import SymbolDraw from"../helper/SymbolDraw";import LineDraw from"../helper/LineDraw";import RoamController from"../../component/helper/RoamController";import*as roamHelper from"../../component/helper/roamHelper";import{onIrrelevantElement}from"../../component/helper/cursorHelper";import*as graphic from"../../util/graphic";import adjustEdge from"./adjustEdge";import{getNodeGlobalScale}from"./graphHelper";var FOCUS_ADJACENCY="__focusNodeAdjacency",UNFOCUS_ADJACENCY="__unfocusNodeAdjacency",nodeOpacityPath=["itemStyle","opacity"],lineOpacityPath=["lineStyle","opacity"];function getItemOpacity(t,e){var o=t.getVisual("opacity");return null!=o?o:t.getModel().get(e)}function fadeOutItem(t,e,o){var a=t.getGraphicEl(),i=getItemOpacity(t,e);null!=o&&(null==i&&(i=1),i*=o),a.downplay&&a.downplay(),a.traverse(function(t){if(!t.isGroup){var e=t.lineLabelOriginalOpacity;null!=e&&null==o||(e=i),t.setStyle("opacity",e)}})}function fadeInItem(t,e){var o=getItemOpacity(t,e),a=t.getGraphicEl();a.traverse(function(t){!t.isGroup&&t.setStyle("opacity",o)}),a.highlight&&a.highlight()}export default echarts.extendChartView({type:"graph",init:function(t,e){var o=new SymbolDraw,a=new LineDraw,i=this.group;this._controller=new RoamController(e.getZr()),this._controllerHost={target:i},i.add(o.group),i.add(a.group),this._symbolDraw=o,this._lineDraw=a,this._firstRender=!0},render:function(t,e,o){var a=t.coordinateSystem;this._model=t;var i=this._symbolDraw,n=this._lineDraw,r=this.group;if("view"===a.type){var d={position:a.position,scale:a.scale};this._firstRender?r.attr(d):graphic.updateProps(r,d,t)}adjustEdge(t.getGraph(),getNodeGlobalScale(t));var c=t.getData();i.updateData(c);var l=t.getEdgeData();n.updateData(l),this._updateNodeAndLinkScale(),this._updateController(t,e,o),clearTimeout(this._layoutTimeout);var s=t.forceLayout,u=t.get("force.layoutAnimation");s&&this._startForceLayoutIteration(s,u),c.eachItemGraphicEl(function(e,a){var i=c.getItemModel(a);e.off("drag").off("dragend");var n=i.get("draggable");n&&e.on("drag",function(){s&&(s.warmUp(),!this._layouting&&this._startForceLayoutIteration(s,u),s.setFixed(a),c.setItemLayout(a,e.position))},this).on("dragend",function(){s&&s.setUnfixed(a)},this),e.setDraggable(n&&s),e[FOCUS_ADJACENCY]&&e.off("mouseover",e[FOCUS_ADJACENCY]),e[UNFOCUS_ADJACENCY]&&e.off("mouseout",e[UNFOCUS_ADJACENCY]),i.get("focusNodeAdjacency")&&(e.on("mouseover",e[FOCUS_ADJACENCY]=function(){o.dispatchAction({type:"focusNodeAdjacency",seriesId:t.id,dataIndex:e.dataIndex})}),e.on("mouseout",e[UNFOCUS_ADJACENCY]=function(){o.dispatchAction({type:"unfocusNodeAdjacency",seriesId:t.id})}))},this),c.graph.eachEdge(function(e){var a=e.getGraphicEl();a[FOCUS_ADJACENCY]&&a.off("mouseover",a[FOCUS_ADJACENCY]),a[UNFOCUS_ADJACENCY]&&a.off("mouseout",a[UNFOCUS_ADJACENCY]),e.getModel().get("focusNodeAdjacency")&&(a.on("mouseover",a[FOCUS_ADJACENCY]=function(){o.dispatchAction({type:"focusNodeAdjacency",seriesId:t.id,edgeDataIndex:e.dataIndex})}),a.on("mouseout",a[UNFOCUS_ADJACENCY]=function(){o.dispatchAction({type:"unfocusNodeAdjacency",seriesId:t.id})}))});var p="circular"===t.get("layout")&&t.get("circular.rotateLabel"),h=c.getLayout("cx"),m=c.getLayout("cy");c.eachItemGraphicEl(function(t,e){var o=c.getItemModel(e).get("label.rotate")||0,a=t.getSymbolPath();if(p){var i=c.getItemLayout(e),n=Math.atan2(i[1]-m,i[0]-h);n<0&&(n=2*Math.PI+n);var r=i[0]<h;r&&(n-=Math.PI);var d=r?"left":"right";graphic.modifyLabelStyle(a,{textRotation:-n,textPosition:d,textOrigin:"center"},{textPosition:d})}else graphic.modifyLabelStyle(a,{textRotation:o*=Math.PI/180})}),this._firstRender=!1},dispose:function(){this._controller&&this._controller.dispose(),this._controllerHost={}},focusNodeAdjacency:function(t,e,o,a){var i=this._model.getData().graph,n=a.dataIndex,r=a.edgeDataIndex,d=i.getNodeByIndex(n),c=i.getEdgeByIndex(r);(d||c)&&(i.eachNode(function(t){fadeOutItem(t,nodeOpacityPath,.1)}),i.eachEdge(function(t){fadeOutItem(t,lineOpacityPath,.1)}),d&&(fadeInItem(d,nodeOpacityPath),zrUtil.each(d.edges,function(t){t.dataIndex<0||(fadeInItem(t,lineOpacityPath),fadeInItem(t.node1,nodeOpacityPath),fadeInItem(t.node2,nodeOpacityPath))})),c&&(fadeInItem(c,lineOpacityPath),fadeInItem(c.node1,nodeOpacityPath),fadeInItem(c.node2,nodeOpacityPath)))},unfocusNodeAdjacency:function(t,e,o,a){var i=this._model.getData().graph;i.eachNode(function(t){fadeOutItem(t,nodeOpacityPath)}),i.eachEdge(function(t){fadeOutItem(t,lineOpacityPath)})},_startForceLayoutIteration:function(t,e){var o=this;!function a(){t.step(function(t){o.updateLayout(o._model),(o._layouting=!t)&&(e?o._layoutTimeout=setTimeout(a,16):a())})}()},_updateController:function(t,e,o){var a=this._controller,i=this._controllerHost,n=this.group;a.setPointerChecker(function(e,a,i){var r=n.getBoundingRect();return r.applyTransform(n.transform),r.contain(a,i)&&!onIrrelevantElement(e,o,t)}),"view"===t.coordinateSystem.type?(a.enable(t.get("roam")),i.zoomLimit=t.get("scaleLimit"),i.zoom=t.coordinateSystem.getZoom(),a.off("pan").off("zoom").on("pan",function(e){roamHelper.updateViewOnPan(i,e.dx,e.dy),o.dispatchAction({seriesId:t.id,type:"graphRoam",dx:e.dx,dy:e.dy})}).on("zoom",function(e){roamHelper.updateViewOnZoom(i,e.scale,e.originX,e.originY),o.dispatchAction({seriesId:t.id,type:"graphRoam",zoom:e.scale,originX:e.originX,originY:e.originY}),this._updateNodeAndLinkScale(),adjustEdge(t.getGraph(),getNodeGlobalScale(t)),this._lineDraw.updateLayout()},this)):a.disable()},_updateNodeAndLinkScale:function(){var t=this._model,e=t.getData(),o=getNodeGlobalScale(t),a=[o,o];e.eachItemGraphicEl(function(t,e){t.attr("scale",a)})},updateLayout:function(t){adjustEdge(t.getGraph(),getNodeGlobalScale(t)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},remove:function(t,e){this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()}});
//# sourceMappingURL=/sm/6ab56e0bf790f90c82ef8c28833f242e67cfdd71f050c2b3eace8bfb01d9ba00.map