/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/chart/custom.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../config";import*as zrUtil from"zrender/src/core/util";import*as graphicUtil from"../util/graphic";import{getDefaultLabel}from"./helper/labelHelper";import createListFromArray from"./helper/createListFromArray";import{getLayoutOnAxis}from"../layout/barGrid";import DataDiffer from"../data/DataDiffer";import SeriesModel from"../model/Series";import Model from"../model/Model";import ChartView from"../view/Chart";import{createClipPath}from"./helper/createClipPathFromCoordSys";import prepareCartesian2d from"../coord/cartesian/prepareCustom";import prepareGeo from"../coord/geo/prepareCustom";import prepareSingleAxis from"../coord/single/prepareCustom";import preparePolar from"../coord/polar/prepareCustom";import prepareCalendar from"../coord/calendar/prepareCustom";var CACHED_LABEL_STYLE_PROPERTIES=graphicUtil.CACHED_LABEL_STYLE_PROPERTIES,ITEM_STYLE_NORMAL_PATH=["itemStyle"],ITEM_STYLE_EMPHASIS_PATH=["emphasis","itemStyle"],LABEL_NORMAL=["label"],LABEL_EMPHASIS=["emphasis","label"],GROUP_DIFF_PREFIX="e\0\0",prepareCustoms={cartesian2d:prepareCartesian2d,geo:prepareGeo,singleAxis:prepareSingleAxis,polar:preparePolar,calendar:prepareCalendar};function createEl(e){var t,r=e.type;if("path"===r){var a=e.shape,i=null!=a.width&&null!=a.height?{x:a.x||0,y:a.y||0,width:a.width,height:a.height}:null,n=getPathData(a);(t=graphicUtil.makePath(n,null,i,a.layout||"center")).__customPathData=n}else if("image"===r)(t=new graphicUtil.Image({})).__customImagePath=e.style.image;else if("text"===r)(t=new graphicUtil.Text({})).__customText=e.style.text;else if("group"===r)t=new graphicUtil.Group;else{if("compoundPath"===r)throw new Error('"compoundPath" is not supported yet.');var o=graphicUtil.getShapeClass(r);__DEV__&&zrUtil.assert(o,'graphic type "'+r+'" can not be found.'),t=new o}return t.__customGraphicType=r,t.name=e.name,t}function updateEl(e,t,r,a,i,n,o){var l={},s=r.style||{};if(r.shape&&(l.shape=zrUtil.clone(r.shape)),r.position&&(l.position=r.position.slice()),r.scale&&(l.scale=r.scale.slice()),r.origin&&(l.origin=r.origin.slice()),r.rotation&&(l.rotation=r.rotation),"image"===e.type&&r.style){var p=l.style={};zrUtil.each(["x","y","width","height"],function(t){prepareStyleTransition(t,p,s,e.style,n)})}if("text"===e.type&&r.style){p=l.style={};zrUtil.each(["x","y"],function(t){prepareStyleTransition(t,p,s,e.style,n)}),!s.hasOwnProperty("textFill")&&s.fill&&(s.textFill=s.fill),!s.hasOwnProperty("textStroke")&&s.stroke&&(s.textStroke=s.stroke)}if("group"!==e.type&&(e.useStyle(s),n)){e.style.opacity=0;var u=s.opacity;null==u&&(u=1),graphicUtil.initProps(e,{style:{opacity:u}},a,t)}n?e.attr(l):graphicUtil.updateProps(e,l,a,t),r.hasOwnProperty("z2")&&e.attr("z2",r.z2||0),r.hasOwnProperty("silent")&&e.attr("silent",r.silent),r.hasOwnProperty("invisible")&&e.attr("invisible",r.invisible),r.hasOwnProperty("ignore")&&e.attr("ignore",r.ignore),r.hasOwnProperty("info")&&e.attr("info",r.info);var d=r.styleEmphasis;graphicUtil.setElementHoverStyle(e,d),o&&graphicUtil.setAsHighDownDispatcher(e,!1!==d)}function prepareStyleTransition(e,t,r,a,i){null==r[e]||i||(t[e]=r[e],r[e]=a[e])}function makeRenderItem(e,t,r,a){var i=e.get("renderItem"),n=e.coordinateSystem,o={};n&&(__DEV__&&(zrUtil.assert(i,"series.render is required."),zrUtil.assert(n.prepareCustoms||prepareCustoms[n.type],"This coordSys does not support custom series.")),o=n.prepareCustoms?n.prepareCustoms():prepareCustoms[n.type](n));var l,s,p,u,d,c=zrUtil.defaults({getWidth:a.getWidth,getHeight:a.getHeight,getZr:a.getZr,getDevicePixelRatio:a.getDevicePixelRatio,value:function(e,r){return null==r&&(r=l),t.get(t.getDimension(e||0),r)},style:function(r,a){null==a&&(a=l),g(a);var i=s.getModel(ITEM_STYLE_NORMAL_PATH).getItemStyle();null!=d&&(i.fill=d);var n=t.getItemVisual(a,"opacity");null!=n&&(i.opacity=n);var o=r?applyExtraBefore(r,p):p;return graphicUtil.setTextStyle(i,o,null,{autoColor:d,isRectText:!0}),i.text=o.getShallow("show")?zrUtil.retrieve2(e.getFormattedLabel(a,"normal"),getDefaultLabel(t,a)):null,r&&applyExtraAfter(i,r),i},styleEmphasis:function(r,a){null==a&&(a=l),g(a);var i=s.getModel(ITEM_STYLE_EMPHASIS_PATH).getItemStyle(),n=r?applyExtraBefore(r,u):u;return graphicUtil.setTextStyle(i,n,null,{isRectText:!0},!0),i.text=n.getShallow("show")?zrUtil.retrieve3(e.getFormattedLabel(a,"emphasis"),e.getFormattedLabel(a,"normal"),getDefaultLabel(t,a)):null,r&&applyExtraAfter(i,r),i},visual:function(e,r){return null==r&&(r=l),t.getItemVisual(r,e)},barLayout:function(e){if(n.getBaseAxis){var t=n.getBaseAxis();return getLayoutOnAxis(zrUtil.defaults({axis:t},e),a)}},currentSeriesIndices:function(){return r.getCurrentSeriesIndices()},font:function(e){return graphicUtil.getFont(e,r)}},o.api||{}),m={context:{},seriesId:e.id,seriesName:e.name,seriesIndex:e.seriesIndex,coordSys:o.coordSys,dataInsideLength:t.count(),encode:wrapEncodeDef(e.getData())},h=!0;return function(e,r){return l=e,h=!0,i&&i(zrUtil.defaults({dataIndexInside:e,dataIndex:t.getRawIndex(e),actionType:r?r.type:null},m),c)};function g(e){null==e&&(e=l),h&&(s=t.getItemModel(e),p=s.getModel(LABEL_NORMAL),u=s.getModel(LABEL_EMPHASIS),d=t.getItemVisual(e,"color"),h=!1)}}function wrapEncodeDef(e){var t={};return zrUtil.each(e.dimensions,function(r,a){var i=e.getDimensionInfo(r);if(!i.isExtraCoord){var n=i.coordDim;(t[n]=t[n]||[])[i.coordDimIndex]=a}}),t}function createOrUpdate(e,t,r,a,i,n){return(e=doCreateOrUpdate(e,t,r,a,i,n,!0))&&n.setItemGraphicEl(t,e),e}function doCreateOrUpdate(e,t,r,a,i,n,o){var l=!r,s=(r=r||{}).type,p=r.shape,u=r.style;if(e&&(l||null!=s&&s!==e.__customGraphicType||"path"===s&&hasOwnPathData(p)&&getPathData(p)!==e.__customPathData||"image"===s&&hasOwn(u,"image")&&u.image!==e.__customImagePath||"text"===s&&hasOwn(p,"text")&&u.text!==e.__customText)&&(i.remove(e),e=null),!l){var d=!e;return!e&&(e=createEl(r)),updateEl(e,t,r,a,n,d,o),"group"===s&&mergeChildren(e,t,r,a,n),i.add(e),e}}function mergeChildren(e,t,r,a,i){var n=r.children,o=n?n.length:0,l=r.$mergeChildren,s="byName"===l||r.diffChildrenByName,p=!1===l;if(o||s||p)if(s)diffGroupChildren({oldChildren:e.children()||[],newChildren:n||[],dataIndex:t,animatableModel:a,group:e,data:i});else{p&&e.removeAll();for(var u=0;u<o;u++)n[u]&&doCreateOrUpdate(e.childAt(u),t,n[u],a,e,i);__DEV__&&zrUtil.assert(!p||e.childCount()===u,"MUST NOT contain empty item in children array when `group.$mergeChildren` is `false`.")}}function diffGroupChildren(e){new DataDiffer(e.oldChildren,e.newChildren,getKey,getKey,e).add(processAddUpdate).update(processAddUpdate).remove(processRemove).execute()}function getKey(e,t){var r=e&&e.name;return null!=r?r:GROUP_DIFF_PREFIX+t}function processAddUpdate(e,t){var r=this.context,a=null!=e?r.newChildren[e]:null;doCreateOrUpdate(null!=t?r.oldChildren[t]:null,r.dataIndex,a,r.animatableModel,r.group,r.data)}function applyExtraBefore(e,t){var r=new Model({},t);return zrUtil.each(CACHED_LABEL_STYLE_PROPERTIES,function(t,a){e.hasOwnProperty(t)&&(r.option[a]=e[t])}),r}function applyExtraAfter(e,t){for(var r in t)!t.hasOwnProperty(r)&&CACHED_LABEL_STYLE_PROPERTIES.hasOwnProperty(r)||(e[r]=t[r])}function processRemove(e){var t=this.context,r=t.oldChildren[e];r&&t.group.remove(r)}function getPathData(e){return e&&(e.pathData||e.d)}function hasOwnPathData(e){return e&&(e.hasOwnProperty("pathData")||e.hasOwnProperty("d"))}function hasOwn(e,t){return e&&e.hasOwnProperty(t)}SeriesModel.extend({type:"series.custom",dependencies:["grid","polar","geo","singleAxis","calendar"],defaultOption:{coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,useTransform:!0,clip:!1},getInitialData:function(e,t){return createListFromArray(this.getSource(),this)},getDataParams:function(e,t,r){var a=SeriesModel.prototype.getDataParams.apply(this,arguments);return r&&(a.info=r.info),a}}),ChartView.extend({type:"custom",_data:null,render:function(e,t,r,a){var i=this._data,n=e.getData(),o=this.group,l=makeRenderItem(e,n,t,r);n.diff(i).add(function(t){createOrUpdate(null,t,l(t,a),e,o,n)}).update(function(t,r){createOrUpdate(i.getItemGraphicEl(r),t,l(t,a),e,o,n)}).remove(function(e){var t=i.getItemGraphicEl(e);t&&o.remove(t)}).execute();var s=e.get("clip",!0)?createClipPath(e.coordinateSystem,!1,e):null;s?o.setClipPath(s):o.removeClipPath(),this._data=n},incrementalPrepareRender:function(e,t,r){this.group.removeAll(),this._data=null},incrementalRender:function(e,t,r,a,i){var n=t.getData(),o=makeRenderItem(t,n,r,a);function l(e){e.isGroup||(e.incremental=!0,e.useHoverLayer=!0)}for(var s=e.start;s<e.end;s++){createOrUpdate(null,s,o(s,i),t,this.group,n).traverse(l)}},dispose:zrUtil.noop,filterForExposedEvent:function(e,t,r,a){var i=t.element;if(null==i||r.name===i)return!0;for(;(r=r.parent)&&r!==this.group;)if(r.name===i)return!0;return!1}});
//# sourceMappingURL=/sm/0a269fa1640e440f966f33228d9f6dbc2f075ee1a1c3e1285612c9723bc6f2a8.map