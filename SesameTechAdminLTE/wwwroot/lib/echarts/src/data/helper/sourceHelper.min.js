/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/data/helper/sourceHelper.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../../config";import{makeInner,getDataItemValue}from"../../util/model";import{getCoordSysDefineBySeries}from"../../model/referHelper";import{createHashMap,each,map,isArray,isString,isObject,isTypedArray,isArrayLike,extend,assert}from"zrender/src/core/util";import Source from"../Source";import{SOURCE_FORMAT_ORIGINAL,SOURCE_FORMAT_ARRAY_ROWS,SOURCE_FORMAT_OBJECT_ROWS,SOURCE_FORMAT_KEYED_COLUMNS,SOURCE_FORMAT_UNKNOWN,SOURCE_FORMAT_TYPED_ARRAY,SERIES_LAYOUT_BY_ROW}from"./sourceType";var inner=makeInner();export function detectSourceFormat(e){var r=e.option.source,n=SOURCE_FORMAT_UNKNOWN;if(isTypedArray(r))n=SOURCE_FORMAT_TYPED_ARRAY;else if(isArray(r)){0===r.length&&(n=SOURCE_FORMAT_ARRAY_ROWS);for(var t=0,i=r.length;t<i;t++){var a=r[t];if(null!=a){if(isArray(a)){n=SOURCE_FORMAT_ARRAY_ROWS;break}if(isObject(a)){n=SOURCE_FORMAT_OBJECT_ROWS;break}}}}else if(isObject(r)){for(var o in r)if(r.hasOwnProperty(o)&&isArrayLike(r[o])){n=SOURCE_FORMAT_KEYED_COLUMNS;break}}else if(null!=r)throw new Error("Invalid data");inner(e).sourceFormat=n}export function getSource(e){return inner(e).source}export function resetSourceDefaulter(e){inner(e).datasetMap=createHashMap()}export function prepareSource(e){var r=e.option,n=r.data,t=isTypedArray(n)?SOURCE_FORMAT_TYPED_ARRAY:SOURCE_FORMAT_ORIGINAL,i=!1,a=r.seriesLayoutBy,o=r.sourceHeader,s=r.dimensions,l=getDatasetModel(e);if(l){var u=l.option;n=u.source,t=inner(l).sourceFormat,i=!0,a=a||u.seriesLayoutBy,null==o&&(o=u.sourceHeader),s=s||u.dimensions}var f=completeBySourceData(n,t,a,o,s),R=r.encode;!R&&l&&(R=makeDefaultEncode(e,l,n,t,a,f)),inner(e).source=new Source({data:n,fromDataset:i,seriesLayoutBy:a,sourceFormat:t,dimensionsDefine:f.dimensionsDefine,startIndex:f.startIndex,dimensionsDetectCount:f.dimensionsDetectCount,encodeDefine:R})}function completeBySourceData(e,r,n,t,i){if(!e)return{dimensionsDefine:normalizeDimensionsDefine(i)};var a,o,s,l;if(r===SOURCE_FORMAT_ARRAY_ROWS)"auto"===t||null==t?arrayRowsTravelFirst(function(e){null!=e&&"-"!==e&&(isString(e)?null==o&&(o=1):o=0)},n,e,10):o=t?1:0,i||1!==o||(i=[],arrayRowsTravelFirst(function(e,r){i[r]=null!=e?e:""},n,e)),a=i?i.length:n===SERIES_LAYOUT_BY_ROW?e.length:e[0]?e[0].length:null;else if(r===SOURCE_FORMAT_OBJECT_ROWS)i||(i=objectRowsCollectDimensions(e),s=!0);else if(r===SOURCE_FORMAT_KEYED_COLUMNS)i||(i=[],s=!0,each(e,function(e,r){i.push(r)}));else if(r===SOURCE_FORMAT_ORIGINAL){var u=getDataItemValue(e[0]);a=isArray(u)&&u.length||1}else r===SOURCE_FORMAT_TYPED_ARRAY&&__DEV__&&assert(!!i,"dimensions must be given if data is TypedArray.");return s&&each(i,function(e,r){"name"===(isObject(e)?e.name:e)&&(l=r)}),{startIndex:o,dimensionsDefine:normalizeDimensionsDefine(i),dimensionsDetectCount:a,potentialNameDimIndex:l}}function normalizeDimensionsDefine(e){if(e){var r=createHashMap();return map(e,function(e,n){if(null==(e=extend({},isObject(e)?e:{name:e})).name)return e;e.name+="",null==e.displayName&&(e.displayName=e.name);var t=r.get(e.name);return t?e.name+="-"+t.count++:r.set(e.name,{count:1}),e})}}function arrayRowsTravelFirst(e,r,n,t){if(null==t&&(t=1/0),r===SERIES_LAYOUT_BY_ROW)for(var i=0;i<n.length&&i<t;i++)e(n[i]?n[i][0]:null,i);else{var a=n[0]||[];for(i=0;i<a.length&&i<t;i++)e(a[i],i)}}function objectRowsCollectDimensions(e){for(var r,n=0;n<e.length&&!(r=e[n++]););if(r){var t=[];return each(r,function(e,r){t.push(r)}),t}}function makeDefaultEncode(e,r,n,t,i,a){var o=getCoordSysDefineBySeries(e),s={},l=[],u=[],f=e.subType,R=createHashMap(["pie","map","funnel"]),O=createHashMap(["line","bar","pictorialBar","scatter","effectScatter","candlestick","boxplot"]);if(o&&null!=O.get(f)){var c=e.ecModel,_=inner(c).datasetMap,m=r.uid+"_"+i,d=_.get(m)||_.set(m,{categoryWayDim:1,valueWayDim:0});each(o.coordSysDims,function(e){if(null==o.firstCategoryDimIndex){var r=d.valueWayDim++;s[e]=r,u.push(r)}else if(o.categoryAxisMap.get(e))s[e]=0,l.push(0);else{r=d.categoryWayDim++;s[e]=r,u.push(r)}})}else if(null!=R.get(f)){for(var A,S=0;S<5&&null==A;S++)doGuessOrdinal(n,t,i,a.dimensionsDefine,a.startIndex,S)||(A=S);if(null!=A){s.value=A;var p=a.potentialNameDimIndex||Math.max(A-1,0);u.push(p),l.push(p)}}return l.length&&(s.itemName=l),u.length&&(s.seriesName=u),s}function getDatasetModel(e){var r=e.option;if(!r.data)return e.ecModel.getComponent("dataset",r.datasetIndex||0)}export function guessOrdinal(e,r){return doGuessOrdinal(e.data,e.sourceFormat,e.seriesLayoutBy,e.dimensionsDefine,e.startIndex,r)}function doGuessOrdinal(e,r,n,t,i,a){var o,s;if(isTypedArray(e))return!1;if(t&&(s=t[a],s=isObject(s)?s.name:s),r===SOURCE_FORMAT_ARRAY_ROWS)if(n===SERIES_LAYOUT_BY_ROW){for(var l=e[a],u=0;u<(l||[]).length&&u<5;u++)if(null!=(o=c(l[i+u])))return o}else for(u=0;u<e.length&&u<5;u++){var f=e[i+u];if(f&&null!=(o=c(f[a])))return o}else if(r===SOURCE_FORMAT_OBJECT_ROWS){if(!s)return;for(u=0;u<e.length&&u<5;u++){if((R=e[u])&&null!=(o=c(R[s])))return o}}else if(r===SOURCE_FORMAT_KEYED_COLUMNS){if(!s)return;if(!(l=e[s])||isTypedArray(l))return!1;for(u=0;u<l.length&&u<5;u++)if(null!=(o=c(l[u])))return o}else if(r===SOURCE_FORMAT_ORIGINAL)for(u=0;u<e.length&&u<5;u++){var R=e[u],O=getDataItemValue(R);if(!isArray(O))return!1;if(null!=(o=c(O[a])))return o}function c(e){return(null==e||!isFinite(e)||""===e)&&(!(!isString(e)||"-"===e)||void 0)}return!1}
//# sourceMappingURL=/sm/adbc19dbaeaa37e1f41895c83d1cf017a729ca6d0f06cc118d9c9312f145ff6f.map