/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/data/List.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../config";import*as zrUtil from"zrender/src/core/util";import Model from"../model/Model";import DataDiffer from"./DataDiffer";import Source from"./Source";import{defaultDimValueGetters,DefaultDataProvider}from"./helper/dataProvider";import{summarizeDimensions}from"./helper/dimensionHelper";var isObject=zrUtil.isObject,UNDEFINED="undefined",INDEX_NOT_FOUND=-1,ID_PREFIX="e\0\0",dataCtors={float:typeof Float64Array===UNDEFINED?Array:Float64Array,int:typeof Int32Array===UNDEFINED?Array:Int32Array,ordinal:Array,number:Array,time:Array},CtorUint32Array=typeof Uint32Array===UNDEFINED?Array:Uint32Array,CtorInt32Array=typeof Int32Array===UNDEFINED?Array:Int32Array,CtorUint16Array=typeof Uint16Array===UNDEFINED?Array:Uint16Array;function getIndicesCtor(t){return t._rawCount>65535?CtorUint32Array:CtorUint16Array}function cloneChunk(t){var i=t.constructor;return i===Array?t.slice():new i(t)}var TRANSFERABLE_PROPERTIES=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_chunkSize","_chunkCount","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx"],CLONE_PROPERTIES=["_extent","_approximateExtent","_rawExtent"];function transferProperties(t,i){zrUtil.each(TRANSFERABLE_PROPERTIES.concat(i.__wrappedMethods||[]),function(e){i.hasOwnProperty(e)&&(t[e]=i[e])}),t.__wrappedMethods=i.__wrappedMethods,zrUtil.each(CLONE_PROPERTIES,function(e){t[e]=zrUtil.clone(i[e])}),t._calculationInfo=zrUtil.extend(i._calculationInfo)}var List=function(t,i){t=t||["x","y"];for(var e={},n=[],r={},s=0;s<t.length;s++){var o=t[s];zrUtil.isString(o)&&(o={name:o});var a=o.name;o.type=o.type||"float",o.coordDim||(o.coordDim=a,o.coordDimIndex=0),o.otherDims=o.otherDims||{},n.push(a),e[a]=o,o.index=s,o.createInvertedIndices&&(r[a]=[])}this.dimensions=n,this._dimensionInfos=e,this.hostModel=i,this.dataType,this._indices=null,this._count=0,this._rawCount=0,this._storage={},this._nameList=[],this._idList=[],this._optionModels=[],this._visual={},this._layout={},this._itemVisuals=[],this.hasItemVisual={},this._itemLayouts=[],this._graphicEls=[],this._chunkSize=1e5,this._chunkCount=0,this._rawData,this._rawExtent={},this._extent={},this._approximateExtent={},this._dimensionsSummary=summarizeDimensions(this),this._invertedIndicesMap=r,this._calculationInfo={},this.userOutput=this._dimensionsSummary.userOutput},listProto=List.prototype;function prepareChunks(t,i,e,n,r){var s=dataCtors[i.type],o=n-1,a=i.name,h=t[a][o];if(h&&h.length<e){for(var u=new s(Math.min(r-o*e,e)),l=0;l<h.length;l++)u[l]=h[l];t[a][o]=u}for(var c=n*e;c<r;c+=e)t[a].push(new s(Math.min(r-c,e)))}function prepareInvertedIndex(t){var i=t._invertedIndicesMap;zrUtil.each(i,function(e,n){var r=t._dimensionInfos[n].ordinalMeta;if(r){e=i[n]=new CtorInt32Array(r.categories.length);for(var s=0;s<e.length;s++)e[s]=INDEX_NOT_FOUND;for(s=0;s<t._count;s++)e[t.get(n,s)]=s}})}function getRawValueFromStore(t,i,e){var n;if(null!=i){var r=t._chunkSize,s=Math.floor(e/r),o=e%r,a=t.dimensions[i],h=t._storage[a][s];if(h){n=h[o];var u=t._dimensionInfos[a].ordinalMeta;u&&u.categories.length&&(n=u.categories[n])}}return n}function getRawIndexWithoutIndices(t){return t}function getRawIndexWithIndices(t){return t<this._count&&t>=0?this._indices[t]:-1}function getId(t,i){var e=t._idList[i];return null==e&&(e=getRawValueFromStore(t,t._idDimIdx,i)),null==e&&(e=ID_PREFIX+i),e}function normalizeDimensions(t){return zrUtil.isArray(t)||(t=[t]),t}function validateDimensions(t,i){for(var e=0;e<i.length;e++)t._dimensionInfos[i[e]]||console.error("Unkown dimension "+i[e])}function cloneListForMapAndSample(t,i){var e=t.dimensions,n=new List(zrUtil.map(e,t.getDimensionInfo,t),t.hostModel);transferProperties(n,t);for(var r=n._storage={},s=t._storage,o=0;o<e.length;o++){var a=e[o];s[a]&&(zrUtil.indexOf(i,a)>=0?(r[a]=cloneDimStore(s[a]),n._rawExtent[a]=getInitialExtent(),n._extent[a]=null):r[a]=s[a])}return n}function cloneDimStore(t){for(var i=new Array(t.length),e=0;e<t.length;e++)i[e]=cloneChunk(t[e]);return i}function getInitialExtent(){return[1/0,-1/0]}listProto.type="list",listProto.hasItemOption=!0,listProto.getDimension=function(t){return"number"!=typeof t&&(isNaN(t)||this._dimensionInfos.hasOwnProperty(t))||(t=this.dimensions[t]),t},listProto.getDimensionInfo=function(t){return this._dimensionInfos[this.getDimension(t)]},listProto.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()},listProto.mapDimension=function(t,i){var e=this._dimensionsSummary;if(null==i)return e.encodeFirstDimNotExtra[t];var n=e.encode[t];return!0===i?(n||[]).slice():n&&n[i]},listProto.initData=function(t,i,e){var n=Source.isInstance(t)||zrUtil.isArrayLike(t);if(n&&(t=new DefaultDataProvider(t,this.dimensions.length)),__DEV__&&!n&&("function"!=typeof t.getItem||"function"!=typeof t.count))throw new Error("Inavlid data provider.");this._rawData=t,this._storage={},this._indices=null,this._nameList=i||[],this._idList=[],this._nameRepeatCount={},e||(this.hasItemOption=!1),this.defaultDimValueGetter=defaultDimValueGetters[this._rawData.getSource().sourceFormat],this._dimValueGetter=e=e||this.defaultDimValueGetter,this._dimValueGetterArrayRows=defaultDimValueGetters.arrayRows,this._rawExtent={},this._initDataFromProvider(0,t.count()),t.pure&&(this.hasItemOption=!1)},listProto.getProvider=function(){return this._rawData},listProto.appendData=function(t){__DEV__&&zrUtil.assert(!this._indices,"appendData can only be called on raw data.");var i=this._rawData,e=this.count();i.appendData(t);var n=i.count();i.persistent||(n+=e),this._initDataFromProvider(e,n)},listProto.appendValues=function(t,i){for(var e=this._chunkSize,n=this._storage,r=this.dimensions,s=r.length,o=this._rawExtent,a=this.count(),h=a+Math.max(t.length,i?i.length:0),u=this._chunkCount,l=0;l<s;l++){o[I=r[l]]||(o[I]=getInitialExtent()),n[I]||(n[I]=[]),prepareChunks(n,this._dimensionInfos[I],e,u,h),this._chunkCount=n[I].length}for(var c=new Array(s),_=a;_<h;_++){for(var f=_-a,d=Math.floor(_/e),m=_%e,g=0;g<s;g++){var I=r[g],p=this._dimValueGetterArrayRows(t[f]||c,I,f,g);n[I][d][m]=p;var v=o[I];p<v[0]&&(v[0]=p),p>v[1]&&(v[1]=p)}i&&(this._nameList[_]=i[f])}this._rawCount=this._count=h,this._extent={},prepareInvertedIndex(this)},listProto._initDataFromProvider=function(t,i){if(!(t>=i)){for(var e,n=this._chunkSize,r=this._rawData,s=this._storage,o=this.dimensions,a=o.length,h=this._dimensionInfos,u=this._nameList,l=this._idList,c=this._rawExtent,_=this._nameRepeatCount={},f=this._chunkCount,d=0;d<a;d++){c[w=o[d]]||(c[w]=getInitialExtent());var m=h[w];0===m.otherDims.itemName&&(e=this._nameDimIdx=d),0===m.otherDims.itemId&&(this._idDimIdx=d),s[w]||(s[w]=[]),prepareChunks(s,m,n,f,i),this._chunkCount=s[w].length}for(var g=new Array(a),I=t;I<i;I++){g=r.getItem(I,g);for(var p=Math.floor(I/n),v=I%n,D=0;D<a;D++){var w,x=s[w=o[D]][p],y=this._dimValueGetter(g,w,I,D);x[v]=y;var P=c[w];y<P[0]&&(P[0]=y),y>P[1]&&(P[1]=y)}if(!r.pure){var E=u[I];if(g&&null==E)if(null!=g.name)u[I]=E=g.name;else if(null!=e){var N=o[e],R=s[N][p];if(R){E=R[v];var A=h[N].ordinalMeta;A&&A.categories.length&&(E=A.categories[E])}}var S=null==g?null:g.id;null==S&&null!=E&&(_[E]=_[E]||0,S=E,_[E]>0&&(S+="__ec__"+_[E]),_[E]++),null!=S&&(l[I]=S)}}!r.persistent&&r.clean&&r.clean(),this._rawCount=this._count=i,this._extent={},prepareInvertedIndex(this)}},listProto.count=function(){return this._count},listProto.getIndices=function(){var t=this._indices;if(t){var i=t.constructor,e=this._count;if(i===Array){r=new i(e);for(var n=0;n<e;n++)r[n]=t[n]}else r=new i(t.buffer,0,e)}else{var r=new(i=getIndicesCtor(this))(this.count());for(n=0;n<r.length;n++)r[n]=n}return r},listProto.get=function(t,i){if(!(i>=0&&i<this._count))return NaN;var e=this._storage;if(!e[t])return NaN;i=this.getRawIndex(i);var n=Math.floor(i/this._chunkSize),r=i%this._chunkSize;return e[t][n][r]},listProto.getByRawIndex=function(t,i){if(!(i>=0&&i<this._rawCount))return NaN;var e=this._storage[t];if(!e)return NaN;var n=Math.floor(i/this._chunkSize),r=i%this._chunkSize;return e[n][r]},listProto._getFast=function(t,i){var e=Math.floor(i/this._chunkSize),n=i%this._chunkSize;return this._storage[t][e][n]},listProto.getValues=function(t,i){var e=[];zrUtil.isArray(t)||(i=t,t=this.dimensions);for(var n=0,r=t.length;n<r;n++)e.push(this.get(t[n],i));return e},listProto.hasValue=function(t){for(var i=this._dimensionsSummary.dataDimsOnCoord,e=0,n=i.length;e<n;e++)if(isNaN(this.get(i[e],t)))return!1;return!0},listProto.getDataExtent=function(t){t=this.getDimension(t);var i=this._storage[t],e=getInitialExtent();if(!i)return e;var n,r=this.count();if(!this._indices)return this._rawExtent[t].slice();if(n=this._extent[t])return n.slice();for(var s=(n=e)[0],o=n[1],a=0;a<r;a++){var h=this._getFast(t,this.getRawIndex(a));h<s&&(s=h),h>o&&(o=h)}return n=[s,o],this._extent[t]=n,n},listProto.getApproximateExtent=function(t){return t=this.getDimension(t),this._approximateExtent[t]||this.getDataExtent(t)},listProto.setApproximateExtent=function(t,i){i=this.getDimension(i),this._approximateExtent[i]=t.slice()},listProto.getCalculationInfo=function(t){return this._calculationInfo[t]},listProto.setCalculationInfo=function(t,i){isObject(t)?zrUtil.extend(this._calculationInfo,t):this._calculationInfo[t]=i},listProto.getSum=function(t){var i=0;if(this._storage[t])for(var e=0,n=this.count();e<n;e++){var r=this.get(t,e);isNaN(r)||(i+=r)}return i},listProto.getMedian=function(t){var i=[];this.each(t,function(t,e){isNaN(t)||i.push(t)});var e=[].concat(i).sort(function(t,i){return t-i}),n=this.count();return 0===n?0:n%2==1?e[(n-1)/2]:(e[n/2]+e[n/2-1])/2},listProto.rawIndexOf=function(t,i){var e=t&&this._invertedIndicesMap[t];if(__DEV__&&!e)throw new Error("Do not supported yet");var n=e[i];return null==n||isNaN(n)?INDEX_NOT_FOUND:n},listProto.indexOfName=function(t){for(var i=0,e=this.count();i<e;i++)if(this.getName(i)===t)return i;return-1},listProto.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var i=this._indices,e=i[t];if(null!=e&&e<this._count&&e===t)return t;for(var n=0,r=this._count-1;n<=r;){var s=(n+r)/2|0;if(i[s]<t)n=s+1;else{if(!(i[s]>t))return s;r=s-1}}return-1},listProto.indicesOfNearest=function(t,i,e){var n=[];if(!this._storage[t])return n;null==e&&(e=1/0);for(var r=Number.MAX_VALUE,s=-1,o=0,a=this.count();o<a;o++){var h=i-this.get(t,o),u=Math.abs(h);h<=e&&u<=r&&((u<r||h>=0&&s<0)&&(r=u,s=h,n.length=0),n.push(o))}return n},listProto.getRawIndex=getRawIndexWithoutIndices,listProto.getRawDataItem=function(t){if(this._rawData.persistent)return this._rawData.getItem(this.getRawIndex(t));for(var i=[],e=0;e<this.dimensions.length;e++){var n=this.dimensions[e];i.push(this.get(n,t))}return i},listProto.getName=function(t){var i=this.getRawIndex(t);return this._nameList[i]||getRawValueFromStore(this,this._nameDimIdx,i)||""},listProto.getId=function(t){return getId(this,this.getRawIndex(t))},listProto.each=function(t,i,e,n){"use strict";if(this._count){"function"==typeof t&&(n=e,e=i,i=t,t=[]),e=e||n||this,t=zrUtil.map(normalizeDimensions(t),this.getDimension,this),__DEV__&&validateDimensions(this,t);for(var r=t.length,s=0;s<this.count();s++)switch(r){case 0:i.call(e,s);break;case 1:i.call(e,this.get(t[0],s),s);break;case 2:i.call(e,this.get(t[0],s),this.get(t[1],s),s);break;default:for(var o=0,a=[];o<r;o++)a[o]=this.get(t[o],s);a[o]=s,i.apply(e,a)}}},listProto.filterSelf=function(t,i,e,n){"use strict";if(this._count){"function"==typeof t&&(n=e,e=i,i=t,t=[]),e=e||n||this,t=zrUtil.map(normalizeDimensions(t),this.getDimension,this),__DEV__&&validateDimensions(this,t);for(var r=this.count(),s=new(getIndicesCtor(this))(r),o=[],a=t.length,h=0,u=t[0],l=0;l<r;l++){var c,_=this.getRawIndex(l);if(0===a)c=i.call(e,l);else if(1===a){var f=this._getFast(u,_);c=i.call(e,f,l)}else{for(var d=0;d<a;d++)o[d]=this._getFast(u,_);o[d]=l,c=i.apply(e,o)}c&&(s[h++]=_)}return h<r&&(this._indices=s),this._count=h,this._extent={},this.getRawIndex=this._indices?getRawIndexWithIndices:getRawIndexWithoutIndices,this}},listProto.selectRange=function(t){"use strict";if(this._count){var i=[];for(var e in t)t.hasOwnProperty(e)&&i.push(e);__DEV__&&validateDimensions(this,i);var n=i.length;if(n){var r=this.count(),s=new(getIndicesCtor(this))(r),o=0,a=i[0],h=t[a][0],u=t[a][1],l=!1;if(!this._indices){var c=0;if(1===n){for(var _=this._storage[i[0]],f=0;f<this._chunkCount;f++)for(var d=_[f],m=Math.min(this._count-f*this._chunkSize,this._chunkSize),g=0;g<m;g++){((w=d[g])>=h&&w<=u||isNaN(w))&&(s[o++]=c),c++}l=!0}else if(2===n){_=this._storage[a];var I=this._storage[i[1]],p=t[i[1]][0],v=t[i[1]][1];for(f=0;f<this._chunkCount;f++){d=_[f];var D=I[f];for(m=Math.min(this._count-f*this._chunkSize,this._chunkSize),g=0;g<m;g++){var w=d[g],x=D[g];(w>=h&&w<=u||isNaN(w))&&(x>=p&&x<=v||isNaN(x))&&(s[o++]=c),c++}}l=!0}}if(!l)if(1===n)for(g=0;g<r;g++){var y=this.getRawIndex(g);((w=this._getFast(a,y))>=h&&w<=u||isNaN(w))&&(s[o++]=y)}else for(g=0;g<r;g++){var P=!0;for(y=this.getRawIndex(g),f=0;f<n;f++){var E=i[f];((w=this._getFast(e,y))<t[E][0]||w>t[E][1])&&(P=!1)}P&&(s[o++]=this.getRawIndex(g))}return o<r&&(this._indices=s),this._count=o,this._extent={},this.getRawIndex=this._indices?getRawIndexWithIndices:getRawIndexWithoutIndices,this}}},listProto.mapArray=function(t,i,e,n){"use strict";"function"==typeof t&&(n=e,e=i,i=t,t=[]),e=e||n||this;var r=[];return this.each(t,function(){r.push(i&&i.apply(this,arguments))},e),r},listProto.map=function(t,i,e,n){"use strict";e=e||n||this,t=zrUtil.map(normalizeDimensions(t),this.getDimension,this),__DEV__&&validateDimensions(this,t);var r=cloneListForMapAndSample(this,t);r._indices=this._indices,r.getRawIndex=r._indices?getRawIndexWithIndices:getRawIndexWithoutIndices;for(var s=r._storage,o=[],a=this._chunkSize,h=t.length,u=this.count(),l=[],c=r._rawExtent,_=0;_<u;_++){for(var f=0;f<h;f++)l[f]=this.get(t[f],_);l[h]=_;var d=i&&i.apply(e,l);if(null!=d){"object"!=typeof d&&(o[0]=d,d=o);for(var m=this.getRawIndex(_),g=Math.floor(m/a),I=m%a,p=0;p<d.length;p++){var v=t[p],D=d[p],w=c[v],x=s[v];x&&(x[g][I]=D),D<w[0]&&(w[0]=D),D>w[1]&&(w[1]=D)}}}return r},listProto.downSample=function(t,i,e,n){for(var r=cloneListForMapAndSample(this,[t]),s=r._storage,o=[],a=Math.floor(1/i),h=s[t],u=this.count(),l=this._chunkSize,c=r._rawExtent[t],_=new(getIndicesCtor(this))(u),f=0,d=0;d<u;d+=a){a>u-d&&(a=u-d,o.length=a);for(var m=0;m<a;m++){var g=this.getRawIndex(d+m),I=Math.floor(g/l),p=g%l;o[m]=h[I][p]}var v=e(o),D=this.getRawIndex(Math.min(d+n(o,v)||0,u-1)),w=D%l;h[Math.floor(D/l)][w]=v,v<c[0]&&(c[0]=v),v>c[1]&&(c[1]=v),_[f++]=D}return r._count=f,r._indices=_,r.getRawIndex=getRawIndexWithIndices,r},listProto.getItemModel=function(t){var i=this.hostModel;return new Model(this.getRawDataItem(t),i,i&&i.ecModel)},listProto.diff=function(t){var i=this;return new DataDiffer(t?t.getIndices():[],this.getIndices(),function(i){return getId(t,i)},function(t){return getId(i,t)})},listProto.getVisual=function(t){var i=this._visual;return i&&i[t]},listProto.setVisual=function(t,i){if(isObject(t))for(var e in t)t.hasOwnProperty(e)&&this.setVisual(e,t[e]);else this._visual=this._visual||{},this._visual[t]=i},listProto.setLayout=function(t,i){if(isObject(t))for(var e in t)t.hasOwnProperty(e)&&this.setLayout(e,t[e]);else this._layout[t]=i},listProto.getLayout=function(t){return this._layout[t]},listProto.getItemLayout=function(t){return this._itemLayouts[t]},listProto.setItemLayout=function(t,i,e){this._itemLayouts[t]=e?zrUtil.extend(this._itemLayouts[t]||{},i):i},listProto.clearItemLayouts=function(){this._itemLayouts.length=0},listProto.getItemVisual=function(t,i,e){var n=this._itemVisuals[t],r=n&&n[i];return null!=r||e?r:this.getVisual(i)},listProto.setItemVisual=function(t,i,e){var n=this._itemVisuals[t]||{},r=this.hasItemVisual;if(this._itemVisuals[t]=n,isObject(i))for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s],r[s]=!0);else n[i]=e,r[i]=!0},listProto.clearAllVisual=function(){this._visual={},this._itemVisuals=[],this.hasItemVisual={}};var setItemDataAndSeriesIndex=function(t){t.seriesIndex=this.seriesIndex,t.dataIndex=this.dataIndex,t.dataType=this.dataType};listProto.setItemGraphicEl=function(t,i){var e=this.hostModel;i&&(i.dataIndex=t,i.dataType=this.dataType,i.seriesIndex=e&&e.seriesIndex,"group"===i.type&&i.traverse(setItemDataAndSeriesIndex,i)),this._graphicEls[t]=i},listProto.getItemGraphicEl=function(t){return this._graphicEls[t]},listProto.eachItemGraphicEl=function(t,i){zrUtil.each(this._graphicEls,function(e,n){e&&t&&t.call(i,e,n)})},listProto.cloneShallow=function(t){if(!t){var i=zrUtil.map(this.dimensions,this.getDimensionInfo,this);t=new List(i,this.hostModel)}if(t._storage=this._storage,transferProperties(t,this),this._indices){var e=this._indices.constructor;t._indices=new e(this._indices)}else t._indices=null;return t.getRawIndex=t._indices?getRawIndexWithIndices:getRawIndexWithoutIndices,t},listProto.wrapMethod=function(t,i){var e=this[t];"function"==typeof e&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var t=e.apply(this,arguments);return i.apply(this,[t].concat(zrUtil.slice(arguments)))})},listProto.TRANSFERABLE_METHODS=["cloneShallow","downSample","map"],listProto.CHANGABLE_METHODS=["filterSelf","selectRange"];export default List;
//# sourceMappingURL=/sm/18be4d146457d84b54e78c80ef22b56574f5bc86c783482ae88791589d86947f.map