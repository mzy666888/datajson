/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/coord/cartesian/Grid.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../../config";import{isObject,each,map,indexOf,retrieve}from"zrender/src/core/util";import{getLayoutRect}from"../../util/layout";import{createScaleByModel,ifAxisCrossZero,niceScaleExtent,estimateLabelUnionRect}from"../../coord/axisHelper";import Cartesian2D from"./Cartesian2D";import Axis2D from"./Axis2D";import CoordinateSystem from"../../CoordinateSystem";import{getStackedDimension}from"../../data/helper/dataStackHelper";import"./GridModel";function isAxisUsedInTheGrid(e,t,i){return e.getCoordSysModel()===t}function Grid(e,t,i){this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this._initCartesian(e,t,i),this.model=e}var gridProto=Grid.prototype;function fixAxisOnZero(e,t,i,o){i.getAxesOnZeroOf=function(){return n?[n]:[]};var n,r=e[t],s=i.model,a=s.get("axisLine.onZero"),d=s.get("axisLine.onZeroAxisIndex");if(a){if(null!=d)canOnZeroToAxis(r[d])&&(n=r[d]);else for(var c in r)if(r.hasOwnProperty(c)&&canOnZeroToAxis(r[c])&&!o[x(r[c])]){n=r[c];break}n&&(o[x(n)]=!0)}function x(e){return e.dim+"_"+e.index}}function canOnZeroToAxis(e){return e&&"category"!==e.type&&"time"!==e.type&&ifAxisCrossZero(e)}function updateAxisTransform(e,t){var i=e.getExtent(),o=i[0]+i[1];e.toGlobalCoord="x"===e.dim?function(e){return e+t}:function(e){return o-e+t},e.toLocalCoord="x"===e.dim?function(e){return e-t}:function(e){return o-e+t}}gridProto.type="grid",gridProto.axisPointerEnabled=!0,gridProto.getRect=function(){return this._rect},gridProto.update=function(e,t){var i=this._axesMap;this._updateScale(e,this.model),each(i.x,function(e){niceScaleExtent(e.scale,e.model)}),each(i.y,function(e){niceScaleExtent(e.scale,e.model)});var o={};each(i.x,function(e){fixAxisOnZero(i,"y",e,o)}),each(i.y,function(e){fixAxisOnZero(i,"x",e,o)}),this.resize(this.model,t)},gridProto.resize=function(e,t,i){var o=getLayoutRect(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()});this._rect=o;var n=this._axesList;function r(){each(n,function(e){var t=e.isHorizontal(),i=t?[0,o.width]:[0,o.height],n=e.inverse?1:0;e.setExtent(i[n],i[1-n]),updateAxisTransform(e,t?o.x:o.y)})}r(),!i&&e.get("containLabel")&&(each(n,function(e){if(!e.model.get("axisLabel.inside")){var t=estimateLabelUnionRect(e);if(t){var i=e.isHorizontal()?"height":"width",n=e.model.get("axisLabel.margin");o[i]-=t[i]+n,"top"===e.position?o.y+=t.height+n:"left"===e.position&&(o.x+=t.width+n)}}}),r())},gridProto.getAxis=function(e,t){var i=this._axesMap[e];if(null!=i){if(null==t)for(var o in i)if(i.hasOwnProperty(o))return i[o];return i[t]}},gridProto.getAxes=function(){return this._axesList.slice()},gridProto.getCartesian=function(e,t){if(null!=e&&null!=t){var i="x"+e+"y"+t;return this._coordsMap[i]}isObject(e)&&(t=e.yAxisIndex,e=e.xAxisIndex);for(var o=0,n=this._coordsList;o<n.length;o++)if(n[o].getAxis("x").index===e||n[o].getAxis("y").index===t)return n[o]},gridProto.getCartesians=function(){return this._coordsList.slice()},gridProto.convertToPixel=function(e,t,i){var o=this._findConvertTarget(e,t);return o.cartesian?o.cartesian.dataToPoint(i):o.axis?o.axis.toGlobalCoord(o.axis.dataToCoord(i)):null},gridProto.convertFromPixel=function(e,t,i){var o=this._findConvertTarget(e,t);return o.cartesian?o.cartesian.pointToData(i):o.axis?o.axis.coordToData(o.axis.toLocalCoord(i)):null},gridProto._findConvertTarget=function(e,t){var i,o,n=t.seriesModel,r=t.xAxisModel||n&&n.getReferringComponents("xAxis")[0],s=t.yAxisModel||n&&n.getReferringComponents("yAxis")[0],a=t.gridModel,d=this._coordsList;if(n)i=n.coordinateSystem,indexOf(d,i)<0&&(i=null);else if(r&&s)i=this.getCartesian(r.componentIndex,s.componentIndex);else if(r)o=this.getAxis("x",r.componentIndex);else if(s)o=this.getAxis("y",s.componentIndex);else if(a){a.coordinateSystem===this&&(i=this._coordsList[0])}return{cartesian:i,axis:o}},gridProto.containPoint=function(e){var t=this._coordsList[0];if(t)return t.containPoint(e)},gridProto._initCartesian=function(e,t,i){var o={left:!1,right:!1,top:!1,bottom:!1},n={x:{},y:{}},r={x:0,y:0};if(t.eachComponent("xAxis",s("x"),this),t.eachComponent("yAxis",s("y"),this),!r.x||!r.y)return this._axesMap={},void(this._axesList=[]);function s(i){return function(s,a){if(isAxisUsedInTheGrid(s,e,t)){var d=s.get("position");"x"===i?"top"!==d&&"bottom"!==d&&(d=o.bottom?"top":"bottom"):"left"!==d&&"right"!==d&&(d=o.left?"right":"left"),o[d]=!0;var c=new Axis2D(i,createScaleByModel(s),[0,0],s.get("type"),d),x="category"===c.type;c.onBand=x&&s.get("boundaryGap"),c.inverse=s.get("inverse"),s.axis=c,c.model=s,c.grid=this,c.index=a,this._axesList.push(c),n[i][a]=c,r[i]++}}}this._axesMap=n,each(n.x,function(t,i){each(n.y,function(o,n){var r="x"+i+"y"+n,s=new Cartesian2D(r);s.grid=this,s.model=e,this._coordsMap[r]=s,this._coordsList.push(s),s.addAxis(t),s.addAxis(o)},this)},this)},gridProto._updateScale=function(e,t){function i(e,t,i){each(e.mapDimension(t.dim,!0),function(i){t.scale.unionExtentFromData(e,getStackedDimension(e,i))})}each(this._axesList,function(e){e.scale.setExtent(1/0,-1/0)}),e.eachSeries(function(o){if(isCartesian2D(o)){var n=findAxesModels(o,e),r=n[0],s=n[1];if(!isAxisUsedInTheGrid(r,t,e)||!isAxisUsedInTheGrid(s,t,e))return;var a=this.getCartesian(r.componentIndex,s.componentIndex),d=o.getData(),c=a.getAxis("x"),x=a.getAxis("y");"list"===d.type&&(i(d,c,o),i(d,x,o))}},this)},gridProto.getTooltipAxes=function(e){var t=[],i=[];return each(this.getCartesians(),function(o){var n=null!=e&&"auto"!==e?o.getAxis(e):o.getBaseAxis(),r=o.getOtherAxis(n);indexOf(t,n)<0&&t.push(n),indexOf(i,r)<0&&i.push(r)}),{baseAxes:t,otherAxes:i}};var axesTypes=["xAxis","yAxis"];function findAxesModels(e,t){return map(axesTypes,function(t){var i=e.getReferringComponents(t)[0];if(__DEV__&&!i)throw new Error(t+' "'+retrieve(e.get(t+"Index"),e.get(t+"Id"),0)+'" not found');return i})}function isCartesian2D(e){return"cartesian2d"===e.get("coordinateSystem")}Grid.create=function(e,t){var i=[];return e.eachComponent("grid",function(o,n){var r=new Grid(o,e,t);r.name="grid_"+n,r.resize(o,t,!0),o.coordinateSystem=r,i.push(r)}),e.eachSeries(function(t){if(isCartesian2D(t)){var i=findAxesModels(t,e),o=i[0],n=i[1],r=o.getCoordSysModel();if(__DEV__){if(!r)throw new Error('Grid "'+retrieve(o.get("gridIndex"),o.get("gridId"),0)+'" not found');if(o.getCoordSysModel()!==n.getCoordSysModel())throw new Error("xAxis and yAxis must use the same grid")}var s=r.coordinateSystem;t.coordinateSystem=s.getCartesian(o.componentIndex,n.componentIndex)}}),i},Grid.dimensions=Grid.prototype.dimensions=Cartesian2D.prototype.dimensions,CoordinateSystem.register("cartesian2d",Grid);export default Grid;
//# sourceMappingURL=/sm/e41944bd8913ccb73a4dc971f6a27909576f9098f7a16818e7d3c0ede84ae6b9.map