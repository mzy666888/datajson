/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/graphic.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__DEV__}from"../config";import*as echarts from"../echarts";import*as zrUtil from"zrender/src/core/util";import*as modelUtil from"../util/model";import*as graphicUtil from"../util/graphic";import*as layoutUtil from"../util/layout";import{parsePercent}from"../util/number";var _nonShapeGraphicElements={path:null,compoundPath:null,group:graphicUtil.Group,image:graphicUtil.Image,text:graphicUtil.Text};echarts.registerPreprocessor(function(e){var t=e.graphic;zrUtil.isArray(t)?t[0]&&t[0].elements?e.graphic=[e.graphic[0]]:e.graphic=[{elements:t}]:t&&!t.elements&&(e.graphic=[{elements:[t]}])});var GraphicModel=echarts.extendComponentModel({type:"graphic",defaultOption:{elements:[],parentId:null},_elOptionsToUpdate:null,mergeOption:function(e){var t=this.option.elements;this.option.elements=null,GraphicModel.superApply(this,"mergeOption",arguments),this.option.elements=t},optionUpdated:function(e,t){var i=this.option,n=(t?i:e).elements,r=i.elements=t?[]:i.elements,a=[];this._flatten(n,a);var o=modelUtil.mappingToExists(r,a);modelUtil.makeIdAndName(o);var l=this._elOptionsToUpdate=[];zrUtil.each(o,function(e,t){var i=e.option;__DEV__&&zrUtil.assert(zrUtil.isObject(i)||e.exist,"Empty graphic option definition"),i&&(l.push(i),setKeyInfoToNewElOption(e,i),mergeNewElOptionToExist(r,t,i),setLayoutInfoToExist(r[t],i))},this);for(var p=r.length-1;p>=0;p--)null==r[p]?r.splice(p,1):delete r[p].$action},_flatten:function(e,t,i){zrUtil.each(e,function(e){if(e){i&&(e.parentOption=i),t.push(e);var n=e.children;"group"===e.type&&n&&this._flatten(n,t,e),delete e.children}},this)},useElOptionsToUpdate:function(){var e=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,e}});function createEl(e,t,i,n){var r=i.type;__DEV__&&zrUtil.assert(r,"graphic type MUST be set");var a=_nonShapeGraphicElements.hasOwnProperty(r)?_nonShapeGraphicElements[r]:graphicUtil.getShapeClass(r);__DEV__&&zrUtil.assert(a,"graphic type can not be found");var o=new a(i);t.add(o),n.set(e,o),o.__ecGraphicId=e}function removeEl(e,t){var i=e&&e.parent;i&&("group"===e.type&&e.traverse(function(e){removeEl(e,t)}),t.removeKey(e.__ecGraphicId),i.remove(e))}function getCleanedElOption(e){return e=zrUtil.extend({},e),zrUtil.each(["id","parentId","$action","hv","bounding"].concat(layoutUtil.LOCATION_PARAMS),function(t){delete e[t]}),e}function isSetLoc(e,t){var i;return zrUtil.each(t,function(t){null!=e[t]&&"auto"!==e[t]&&(i=!0)}),i}function setKeyInfoToNewElOption(e,t){var i=e.exist;if(t.id=e.keyInfo.id,!t.type&&i&&(t.type=i.type),null==t.parentId){var n=t.parentOption;n?t.parentId=n.id:i&&(t.parentId=i.parentId)}t.parentOption=null}function mergeNewElOptionToExist(e,t,i){var n=zrUtil.extend({},i),r=e[t],a=i.$action||"merge";if("merge"===a)if(r){if(__DEV__){var o=i.type;zrUtil.assert(!o||r.type===o,'Please set $action: "replace" to change `type`')}zrUtil.merge(r,n,!0),layoutUtil.mergeLayoutParam(r,n,{ignoreSize:!0}),layoutUtil.copyLayoutParams(i,r)}else e[t]=n;else"replace"===a?e[t]=n:"remove"===a&&r&&(e[t]=null)}function setLayoutInfoToExist(e,t){e&&(e.hv=t.hv=[isSetLoc(t,["left","right"]),isSetLoc(t,["top","bottom"])],"group"===e.type&&(null==e.width&&(e.width=t.width=0),null==e.height&&(e.height=t.height=0)))}function setEventData(e,t,i){var n=e.eventData;e.silent||e.ignore||n||(n=e.eventData={componentType:"graphic",componentIndex:t.componentIndex,name:e.name}),n&&(n.info=e.info)}echarts.extendComponentView({type:"graphic",init:function(e,t){this._elMap=zrUtil.createHashMap(),this._lastGraphicModel},render:function(e,t,i){e!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=e,this._updateElements(e),this._relocate(e,i)},_updateElements:function(e){var t=e.useElOptionsToUpdate();if(t){var i=this._elMap,n=this.group;zrUtil.each(t,function(t){var r=t.$action,a=t.id,o=i.get(a),l=t.parentId,p=null!=l?i.get(l):n,h=t.style;"text"===t.type&&h&&(t.hv&&t.hv[1]&&(h.textVerticalAlign=h.textBaseline=null),!h.hasOwnProperty("textFill")&&h.fill&&(h.textFill=h.fill),!h.hasOwnProperty("textStroke")&&h.stroke&&(h.textStroke=h.stroke));var s=getCleanedElOption(t);__DEV__&&o&&zrUtil.assert(p===o.parent,"Changing parent is not supported."),r&&"merge"!==r?"replace"===r?(removeEl(o,i),createEl(a,p,s,i)):"remove"===r&&removeEl(o,i):o?o.attr(s):createEl(a,p,s,i);var c=i.get(a);c&&(c.__ecGraphicWidthOption=t.width,c.__ecGraphicHeightOption=t.height,setEventData(c,e,t))})}},_relocate:function(e,t){for(var i=e.option.elements,n=this.group,r=this._elMap,a=t.getWidth(),o=t.getHeight(),l=0;l<i.length;l++){var p=i[l];if((s=r.get(p.id))&&s.isGroup){var h=(c=s.parent)===n;s.__ecGraphicWidth=parsePercent(s.__ecGraphicWidthOption,h?a:c.__ecGraphicWidth)||0,s.__ecGraphicHeight=parsePercent(s.__ecGraphicHeightOption,h?o:c.__ecGraphicHeight)||0}}for(l=i.length-1;l>=0;l--){var s;p=i[l];if(s=r.get(p.id)){var c,u=(c=s.parent)===n?{width:a,height:o}:{width:c.__ecGraphicWidth,height:c.__ecGraphicHeight};layoutUtil.positionElement(s,p,u,null,{hv:p.hv,boundingMode:p.bounding})}}},_clear:function(){var e=this._elMap;e.each(function(t){removeEl(t,e)}),this._elMap=zrUtil.createHashMap()},dispose:function(){this._clear()}});
//# sourceMappingURL=/sm/ef0a4fd74cce1e88994559016082f543ecba20e07956b6d219ccf290bbaa29ab.map