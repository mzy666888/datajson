/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/tooltip/TooltipView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as echarts from"../../echarts";import*as zrUtil from"zrender/src/core/util";import env from"zrender/src/core/env";import TooltipContent from"./TooltipContent";import TooltipRichContent from"./TooltipRichContent";import*as formatUtil from"../../util/format";import*as numberUtil from"../../util/number";import*as graphic from"../../util/graphic";import findPointFromSeries from"../axisPointer/findPointFromSeries";import*as layoutUtil from"../../util/layout";import Model from"../../model/Model";import*as globalListener from"../axisPointer/globalListener";import*as axisHelper from"../../coord/axisHelper";import*as axisPointerViewHelper from"../axisPointer/viewHelper";import{getTooltipRenderMode}from"../../util/model";var bind=zrUtil.bind,each=zrUtil.each,parsePercent=numberUtil.parsePercent,proxyRect=new graphic.Rect({shape:{x:-1,y:-1,width:2,height:2}});export default echarts.extendComponentView({type:"tooltip",init:function(t,e){if(!env.node){var i,o=t.getComponent("tooltip").get("renderMode");this._renderMode=getTooltipRenderMode(o),"html"===this._renderMode?(i=new TooltipContent(e.getDom(),e),this._newLine="<br/>"):(i=new TooltipRichContent(e),this._newLine="\n"),this._tooltipContent=i}},render:function(t,e,i){if(!env.node){this.group.removeAll(),this._tooltipModel=t,this._ecModel=e,this._api=i,this._lastDataByCoordSys=null,this._alwaysShowContent=t.get("alwaysShowContent");var o=this._tooltipContent;o.update(),o.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow()}},_initGlobalListener:function(){var t=this._tooltipModel.get("triggerOn");globalListener.register("itemTooltip",this._api,bind(function(e,i,o){"none"!==t&&(t.indexOf(e)>=0?this._tryShow(i,o):"leave"===e&&this._hide(o))},this))},_keepShow:function(){var t=this._tooltipModel,e=this._ecModel,i=this._api;if(null!=this._lastX&&null!=this._lastY&&"none"!==t.get("triggerOn")){var o=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!i.isDisposed()&&o.manuallyShowTip(t,e,i,{x:o._lastX,y:o._lastY})})}},manuallyShowTip:function(t,e,i,o){if(o.from!==this.uid&&!env.node){var n=makeDispatchAction(o,i);this._ticket="";var s=o.dataByCoordSys;if(o.tooltip&&null!=o.x&&null!=o.y){var a=proxyRect;a.position=[o.x,o.y],a.update(),a.tooltip=o.tooltip,this._tryShow({offsetX:o.x,offsetY:o.y,target:a},n)}else if(s)this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,event:{},dataByCoordSys:o.dataByCoordSys,tooltipOption:o.tooltipOption},n);else if(null!=o.seriesIndex){if(this._manuallyAxisShowTip(t,e,i,o))return;var r=findPointFromSeries(o,e),l=r.point[0],h=r.point[1];null!=l&&null!=h&&this._tryShow({offsetX:l,offsetY:h,position:o.position,target:r.el,event:{}},n)}else null!=o.x&&null!=o.y&&(i.dispatchAction({type:"updateAxisPointer",x:o.x,y:o.y}),this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,target:i.getZr().findHover(o.x,o.y).target,event:{}},n))}},manuallyHideTip:function(t,e,i,o){var n=this._tooltipContent;!this._alwaysShowContent&&this._tooltipModel&&n.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=null,o.from!==this.uid&&this._hide(makeDispatchAction(o,i))},_manuallyAxisShowTip:function(t,e,i,o){var n=o.seriesIndex,s=o.dataIndex,a=e.getComponent("axisPointer").coordSysAxesInfo;if(null!=n&&null!=s&&null!=a){var r=e.getSeriesByIndex(n);if(r)if("axis"===(t=buildTooltipModel([r.getData().getItemModel(s),r,(r.coordinateSystem||{}).model,t])).get("trigger"))return i.dispatchAction({type:"updateAxisPointer",seriesIndex:n,dataIndex:s,position:o.position}),!0}},_tryShow:function(t,e){var i=t.target;if(this._tooltipModel){this._lastX=t.offsetX,this._lastY=t.offsetY;var o=t.dataByCoordSys;o&&o.length?this._showAxisTooltip(o,t):i&&null!=i.dataIndex?(this._lastDataByCoordSys=null,this._showSeriesItemTooltip(t,i,e)):i&&i.tooltip?(this._lastDataByCoordSys=null,this._showComponentItemTooltip(t,i,e)):(this._lastDataByCoordSys=null,this._hide(e))}},_showOrMove:function(t,e){var i=t.get("showDelay");e=zrUtil.bind(e,this),clearTimeout(this._showTimout),i>0?this._showTimout=setTimeout(e,i):e()},_showAxisTooltip:function(t,e){var i=this._ecModel,o=this._tooltipModel,n=[e.offsetX,e.offsetY],s=[],a=[],r=buildTooltipModel([e.tooltipOption,o]),l=this._renderMode,h=this._newLine,d={};each(t,function(t){each(t.dataByAxis,function(t){var e=i.getComponent(t.axisDim+"Axis",t.axisIndex),o=t.value,n=[];if(e&&null!=o){var r=axisPointerViewHelper.getValueLabel(o,e.axis,i,t.seriesDataIndices,t.valueLabelOpt);zrUtil.each(t.seriesDataIndices,function(s){var h=i.getSeriesByIndex(s.seriesIndex),p=s.dataIndexInside,f=h&&h.getDataParams(p);if(f.axisDim=t.axisDim,f.axisIndex=t.axisIndex,f.axisType=t.axisType,f.axisId=t.axisId,f.axisValue=axisHelper.getAxisRawValue(e.axis,o),f.axisValueLabel=r,f){a.push(f);var u,c=h.formatTooltip(p,!0,null,l);if(zrUtil.isObject(c)){u=c.html;var m=c.markers;zrUtil.merge(d,m)}else u=c;n.push(u)}});var p=r;"html"!==l?s.push(n.join(h)):s.push((p?formatUtil.encodeHTML(p)+h:"")+n.join(h))}})},this),s.reverse(),s=s.join(this._newLine+this._newLine);var p=e.position;this._showOrMove(r,function(){this._updateContentNotChangedOnAxis(t)?this._updatePosition(r,p,n[0],n[1],this._tooltipContent,a):this._showTooltipContent(r,s,a,Math.random(),n[0],n[1],p,void 0,d)})},_showSeriesItemTooltip:function(t,e,i){var o=this._ecModel,n=e.seriesIndex,s=o.getSeriesByIndex(n),a=e.dataModel||s,r=e.dataIndex,l=e.dataType,h=a.getData(),d=buildTooltipModel([h.getItemModel(r),a,s&&(s.coordinateSystem||{}).model,this._tooltipModel]),p=d.get("trigger");if(null==p||"item"===p){var f,u,c=a.getDataParams(r,l),m=a.formatTooltip(r,!1,l,this._renderMode);zrUtil.isObject(m)?(f=m.html,u=m.markers):(f=m,u=null);var g="item_"+a.name+"_"+r;this._showOrMove(d,function(){this._showTooltipContent(d,f,c,g,t.offsetX,t.offsetY,t.position,t.target,u)}),i({type:"showTip",dataIndexInside:r,dataIndex:h.getRawIndex(r),seriesIndex:n,from:this.uid})}},_showComponentItemTooltip:function(t,e,i){var o=e.tooltip;if("string"==typeof o){o={content:o,formatter:o}}var n=new Model(o,this._tooltipModel,this._ecModel),s=n.get("content"),a=Math.random();this._showOrMove(n,function(){this._showTooltipContent(n,s,n.get("formatterParams")||{},a,t.offsetX,t.offsetY,t.position,e)}),i({type:"showTip",from:this.uid})},_showTooltipContent:function(t,e,i,o,n,s,a,r,l){if(this._ticket="",t.get("showContent")&&t.get("show")){var h=this._tooltipContent,d=t.get("formatter");a=a||t.get("position");var p=e;if(d&&"string"==typeof d)p=formatUtil.formatTpl(d,i,!0);else if("function"==typeof d){var f=bind(function(e,o){e===this._ticket&&(h.setContent(o,l,t),this._updatePosition(t,a,n,s,h,i,r))},this);this._ticket=o,p=d(i,o,f)}h.setContent(p,l,t),h.show(t),this._updatePosition(t,a,n,s,h,i,r)}},_updatePosition:function(t,e,i,o,n,s,a){var r=this._api.getWidth(),l=this._api.getHeight();e=e||t.get("position");var h=n.getSize(),d=t.get("align"),p=t.get("verticalAlign"),f=a&&a.getBoundingRect().clone();if(a&&f.applyTransform(a.transform),"function"==typeof e&&(e=e([i,o],s,n.el,f,{viewSize:[r,l],contentSize:h.slice()})),zrUtil.isArray(e))i=parsePercent(e[0],r),o=parsePercent(e[1],l);else if(zrUtil.isObject(e)){e.width=h[0],e.height=h[1];var u=layoutUtil.getLayoutRect(e,{width:r,height:l});i=u.x,o=u.y,d=null,p=null}else if("string"==typeof e&&a){i=(c=calcTooltipPosition(e,f,h))[0],o=c[1]}else{var c;i=(c=refixTooltipPosition(i,o,n,r,l,d?null:20,p?null:20))[0],o=c[1]}(d&&(i-=isCenterAlign(d)?h[0]/2:"right"===d?h[0]:0),p&&(o-=isCenterAlign(p)?h[1]/2:"bottom"===p?h[1]:0),t.get("confine"))&&(i=(c=confineTooltipPosition(i,o,n,r,l))[0],o=c[1]);n.moveTo(i,o)},_updateContentNotChangedOnAxis:function(t){var e=this._lastDataByCoordSys,i=!!e&&e.length===t.length;return i&&each(e,function(e,o){var n=e.dataByAxis||{},s=(t[o]||{}).dataByAxis||[];(i&=n.length===s.length)&&each(n,function(t,e){var o=s[e]||{},n=t.seriesDataIndices||[],a=o.seriesDataIndices||[];(i&=t.value===o.value&&t.axisType===o.axisType&&t.axisId===o.axisId&&n.length===a.length)&&each(n,function(t,e){var o=a[e];i&=t.seriesIndex===o.seriesIndex&&t.dataIndex===o.dataIndex})})}),this._lastDataByCoordSys=t,!!i},_hide:function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},dispose:function(t,e){env.node||(this._tooltipContent.hide(),globalListener.unregister("itemTooltip",e))}});function buildTooltipModel(t){for(var e=t.pop();t.length;){var i=t.pop();i&&(Model.isInstance(i)&&(i=i.get("tooltip",!0)),"string"==typeof i&&(i={formatter:i}),e=new Model(i,e,e.ecModel))}return e}function makeDispatchAction(t,e){return t.dispatchAction||zrUtil.bind(e.dispatchAction,e)}function refixTooltipPosition(t,e,i,o,n,s,a){var r=i.getOuterSize(),l=r.width,h=r.height;return null!=s&&(t+l+s>o?t-=l+s:t+=s),null!=a&&(e+h+a>n?e-=h+a:e+=a),[t,e]}function confineTooltipPosition(t,e,i,o,n){var s=i.getOuterSize(),a=s.width,r=s.height;return t=Math.min(t+a,o)-a,e=Math.min(e+r,n)-r,[t=Math.max(t,0),e=Math.max(e,0)]}function calcTooltipPosition(t,e,i){var o=i[0],n=i[1],s=0,a=0,r=e.width,l=e.height;switch(t){case"inside":s=e.x+r/2-o/2,a=e.y+l/2-n/2;break;case"top":s=e.x+r/2-o/2,a=e.y-n-5;break;case"bottom":s=e.x+r/2-o/2,a=e.y+l+5;break;case"left":s=e.x-o-5,a=e.y+l/2-n/2;break;case"right":s=e.x+r+5,a=e.y+l/2-n/2}return[s,a]}function isCenterAlign(t){return"center"===t||"middle"===t}
//# sourceMappingURL=/sm/397e9cb45d0a42f8c89a03845cce69ca67041fc8f99ad5f8bb877a2044799e6a.map