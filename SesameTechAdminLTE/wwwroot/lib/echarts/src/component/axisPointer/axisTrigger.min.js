/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/axisPointer/axisTrigger.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import{makeInner}from"../../util/model";import*as modelHelper from"./modelHelper";import findPointFromSeries from"./findPointFromSeries";var each=zrUtil.each,curry=zrUtil.curry,inner=makeInner();export default function(e,a,i){var n=e.currTrigger,t=[e.x,e.y],o=e,s=e.dispatchAction||zrUtil.bind(i.dispatchAction,i),r=a.getComponent("axisPointer").coordSysAxesInfo;if(r){illegalPoint(t)&&(t=findPointFromSeries({seriesIndex:o.seriesIndex,dataIndex:o.dataIndex},a).point);var l=illegalPoint(t),d=o.axesInfo,c=r.axesInfo,p="leave"===n||illegalPoint(t),u={},x={},h={list:[],map:{}},m={showPointer:curry(showPointer,x),showTooltip:curry(showTooltip,h)};each(r.coordSysMap,function(e,a){var i=l||e.containPoint(t);each(r.coordSysAxesInfo[a],function(e,a){var n=e.axis,o=findInputAxisInfo(d,e);if(!p&&i&&(!d||o)){var s=o&&o.value;null!=s||l||(s=n.pointToData(t)),null!=s&&processOnAxis(e,s,m,!1,u)}})});var f={};return each(c,function(e,a){var i=e.linkGroup;i&&!x[a]&&each(i.axesInfo,function(a,n){var t=x[n];if(a!==e&&t){var o=t.value;i.mapper&&(o=e.axis.scale.parse(i.mapper(o,makeMapperParam(a),makeMapperParam(e)))),f[e.key]=o}})}),each(f,function(e,a){processOnAxis(c[a],e,m,!0,u)}),updateModelActually(x,c,u),dispatchTooltipActually(h,t,e,s),dispatchHighDownActually(c,s,i),u}}function processOnAxis(e,a,i,n,t){var o=e.axis;if(!o.scale.isBlank()&&o.containData(a))if(e.involveSeries){var s=buildPayloadsBySeries(a,e),r=s.payloadBatch,l=s.snapToValue;r[0]&&null==t.seriesIndex&&zrUtil.extend(t,r[0]),!n&&e.snap&&o.containData(l)&&null!=l&&(a=l),i.showPointer(e,a,r,t),i.showTooltip(e,s,l)}else i.showPointer(e,a)}function buildPayloadsBySeries(e,a){var i=a.axis,n=i.dim,t=e,o=[],s=Number.MAX_VALUE,r=-1;return each(a.seriesModels,function(a,l){var d,c,p=a.getData().mapDimension(n,!0);if(a.getAxisTooltipData){var u=a.getAxisTooltipData(p,e,i);c=u.dataIndices,d=u.nestestValue}else{if(!(c=a.getData().indicesOfNearest(p[0],e,"category"===i.type?.5:null)).length)return;d=a.getData().get(p[0],c[0])}if(null!=d&&isFinite(d)){var x=e-d,h=Math.abs(x);h<=s&&((h<s||x>=0&&r<0)&&(s=h,r=x,t=d,o.length=0),each(c,function(e){o.push({seriesIndex:a.seriesIndex,dataIndexInside:e,dataIndex:a.getData().getRawIndex(e)})}))}}),{payloadBatch:o,snapToValue:t}}function showPointer(e,a,i,n){e[a.key]={value:i,payloadBatch:n}}function showTooltip(e,a,i,n){var t=i.payloadBatch,o=a.axis,s=o.model,r=a.axisPointerModel;if(a.triggerTooltip&&t.length){var l=a.coordSys.model,d=modelHelper.makeKey(l),c=e.map[d];c||(c=e.map[d]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},e.list.push(c)),c.dataByAxis.push({axisDim:o.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:n,valueLabelOpt:{precision:r.get("label.precision"),formatter:r.get("label.formatter")},seriesDataIndices:t.slice()})}}function updateModelActually(e,a,i){var n=i.axesInfo=[];each(a,function(a,i){var t=a.axisPointerModel.option,o=e[i];o?(!a.useHandle&&(t.status="show"),t.value=o.value,t.seriesDataIndices=(o.payloadBatch||[]).slice()):!a.useHandle&&(t.status="hide"),"show"===t.status&&n.push({axisDim:a.axis.dim,axisIndex:a.axis.model.componentIndex,value:t.value})})}function dispatchTooltipActually(e,a,i,n){if(!illegalPoint(a)&&e.list.length){var t=((e.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};n({type:"showTip",escapeConnect:!0,x:a[0],y:a[1],tooltipOption:i.tooltipOption,position:i.position,dataIndexInside:t.dataIndexInside,dataIndex:t.dataIndex,seriesIndex:t.seriesIndex,dataByCoordSys:e.list})}else n({type:"hideTip"})}function dispatchHighDownActually(e,a,i){var n=i.getZr(),t=inner(n).axisPointerLastHighlights||{},o=inner(n).axisPointerLastHighlights={};each(e,function(e,a){var i=e.axisPointerModel.option;"show"===i.status&&each(i.seriesDataIndices,function(e){var a=e.seriesIndex+" | "+e.dataIndex;o[a]=e})});var s=[],r=[];zrUtil.each(t,function(e,a){!o[a]&&r.push(e)}),zrUtil.each(o,function(e,a){!t[a]&&s.push(e)}),r.length&&i.dispatchAction({type:"downplay",escapeConnect:!0,batch:r}),s.length&&i.dispatchAction({type:"highlight",escapeConnect:!0,batch:s})}function findInputAxisInfo(e,a){for(var i=0;i<(e||[]).length;i++){var n=e[i];if(a.axis.dim===n.axisDim&&a.axis.model.componentIndex===n.axisIndex)return n}}function makeMapperParam(e){var a=e.axis.model,i={},n=i.axisDim=e.axis.dim;return i.axisIndex=i[n+"AxisIndex"]=a.componentIndex,i.axisName=i[n+"AxisName"]=a.name,i.axisId=i[n+"AxisId"]=a.id,i}function illegalPoint(e){return!e||null==e[0]||isNaN(e[0])||null==e[1]||isNaN(e[1])}
//# sourceMappingURL=/sm/d701db05a6218a95907da5a7b3cf5d63265d632b317dfd9c66e9b62f743afffd.map