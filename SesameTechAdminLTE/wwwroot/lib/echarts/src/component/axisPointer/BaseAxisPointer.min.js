/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/axisPointer/BaseAxisPointer.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import*as clazzUtil from"../../util/clazz";import*as graphic from"../../util/graphic";import*as axisPointerModelHelper from"./modelHelper";import*as eventTool from"zrender/src/core/event";import*as throttleUtil from"../../util/throttle";import{makeInner}from"../../util/model";var inner=makeInner(),clone=zrUtil.clone,bind=zrUtil.bind;function BaseAxisPointer(){}function updateProps(t,e,i,a){propsEqual(inner(i).lastProp,a)||(inner(i).lastProp=a,e?graphic.updateProps(i,a,t):(i.stopAnimation(),i.attr(a)))}function propsEqual(t,e){if(zrUtil.isObject(t)&&zrUtil.isObject(e)){var i=!0;return zrUtil.each(e,function(e,a){i=i&&propsEqual(t[a],e)}),!!i}return t===e}function updateLabelShowHide(t,e){t[e.get("label.show")?"show":"hide"]()}function getHandleTransProps(t){return{position:t.position.slice(),rotation:t.rotation||0}}function updateMandatoryProps(t,e,i){var a=e.get("z"),n=e.get("zlevel");t&&t.traverse(function(t){"group"!==t.type&&(null!=a&&(t.z=a),null!=n&&(t.zlevel=n),t.silent=i)})}BaseAxisPointer.prototype={_group:null,_lastGraphicKey:null,_handle:null,_dragging:!1,_lastValue:null,_lastStatus:null,_payloadInfo:null,animationThreshold:15,render:function(t,e,i,a){var n=e.get("value"),o=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=i,a||this._lastValue!==n||this._lastStatus!==o){this._lastValue=n,this._lastStatus=o;var r=this._group,l=this._handle;if(!o||"hide"===o)return r&&r.hide(),void(l&&l.hide());r&&r.show(),l&&l.show();var s={};this.makeElOption(s,n,t,e,i);var d=s.graphicKey;d!==this._lastGraphicKey&&this.clear(i),this._lastGraphicKey=d;var h=this._moveAnimation=this.determineAnimation(t,e);if(r){var p=zrUtil.curry(updateProps,e,h);this.updatePointerEl(r,s,p,e),this.updateLabelEl(r,s,p,e)}else r=this._group=new graphic.Group,this.createPointerEl(r,s,t,e),this.createLabelEl(r,s,t,e),i.getZr().add(r);updateMandatoryProps(r,e,!0),this._renderHandle(n)}},remove:function(t){this.clear(t)},dispose:function(t){this.clear(t)},determineAnimation:function(t,e){var i=e.get("animation"),a=t.axis,n="category"===a.type,o=e.get("snap");if(!o&&!n)return!1;if("auto"===i||null==i){var r=this.animationThreshold;if(n&&a.getBandWidth()>r)return!0;if(o){var l=axisPointerModelHelper.getAxisInfo(t).seriesDataCount,s=a.getExtent();return Math.abs(s[0]-s[1])/l>r}return!1}return!0===i},makeElOption:function(t,e,i,a,n){},createPointerEl:function(t,e,i,a){var n=e.pointer;if(n){var o=inner(t).pointerEl=new graphic[n.type](clone(e.pointer));t.add(o)}},createLabelEl:function(t,e,i,a){if(e.label){var n=inner(t).labelEl=new graphic.Rect(clone(e.label));t.add(n),updateLabelShowHide(n,a)}},updatePointerEl:function(t,e,i){var a=inner(t).pointerEl;a&&e.pointer&&(a.setStyle(e.pointer.style),i(a,{shape:e.pointer.shape}))},updateLabelEl:function(t,e,i,a){var n=inner(t).labelEl;n&&(n.setStyle(e.label.style),i(n,{shape:e.label.shape,position:e.label.position}),updateLabelShowHide(n,a))},_renderHandle:function(t){if(!this._dragging&&this.updateHandleTransform){var e,i=this._axisPointerModel,a=this._api.getZr(),n=this._handle,o=i.getModel("handle"),r=i.get("status");if(!o.get("show")||!r||"hide"===r)return n&&a.remove(n),void(this._handle=null);this._handle||(e=!0,n=this._handle=graphic.createIcon(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(t){eventTool.stop(t.event)},onmousedown:bind(this._onHandleDragMove,this,0,0),drift:bind(this._onHandleDragMove,this),ondragend:bind(this._onHandleDragEnd,this)}),a.add(n)),updateMandatoryProps(n,i,!1);n.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var l=o.get("size");zrUtil.isArray(l)||(l=[l,l]),n.attr("scale",[l[0]/2,l[1]/2]),throttleUtil.createOrUpdate(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,e)}},_moveHandleToValue:function(t,e){updateProps(this._axisPointerModel,!e&&this._moveAnimation,this._handle,getHandleTransProps(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},_onHandleDragMove:function(t,e){var i=this._handle;if(i){this._dragging=!0;var a=this.updateHandleTransform(getHandleTransProps(i),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=a,i.stopAnimation(),i.attr(getHandleTransProps(a)),inner(i).lastProp=null,this._doDispatchAxisPointer()}},_doDispatchAxisPointer:function(){if(this._handle){var t=this._payloadInfo,e=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:e.axis.dim,axisIndex:e.componentIndex}]})}},_onHandleDragEnd:function(t){if(this._dragging=!1,this._handle){var e=this._axisPointerModel.get("value");this._moveHandleToValue(e),this._api.dispatchAction({type:"hideTip"})}},getHandleTransform:null,updateHandleTransform:null,clear:function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),i=this._group,a=this._handle;e&&i&&(this._lastGraphicKey=null,i&&e.remove(i),a&&e.remove(a),this._group=null,this._handle=null,this._payloadInfo=null)},doClear:function(){},buildLabel:function(t,e,i){return{x:t[i=i||0],y:t[1-i],width:e[i],height:e[1-i]}}},BaseAxisPointer.prototype.constructor=BaseAxisPointer,clazzUtil.enableClassExtend(BaseAxisPointer);export default BaseAxisPointer;
//# sourceMappingURL=/sm/4e77917e6706ee9ed5845bd5c0c80220e33f00f09aa6d0e5e62538c65162b27f.map