/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/visualMap/ContinuousView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import LinearGradient from"zrender/src/graphic/LinearGradient";import*as eventTool from"zrender/src/core/event";import VisualMapView from"./VisualMapView";import*as graphic from"../../util/graphic";import*as numberUtil from"../../util/number";import sliderMove from"../helper/sliderMove";import*as helper from"./helper";import*as modelUtil from"../../util/model";var linearMap=numberUtil.linearMap,each=zrUtil.each,mathMin=Math.min,mathMax=Math.max,HOVER_LINK_SIZE=12,HOVER_LINK_OUT=6,ContinuousView=VisualMapView.extend({type:"visualMap.continuous",init:function(){ContinuousView.superApply(this,"init",arguments),this._shapes={},this._dataInterval=[],this._handleEnds=[],this._orient,this._useHandle,this._hoverLinkDataIndices=[],this._dragging,this._hovering},doRender:function(e,t,i,a){a&&"selectDataRange"===a.type&&a.from===this.uid||this._buildView()},_buildView:function(){this.group.removeAll();var e=this.visualMapModel,t=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(t);var i=e.get("text");this._renderEndsText(t,i,0),this._renderEndsText(t,i,1),this._updateView(!0),this.renderBackground(t),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(t)},_renderEndsText:function(e,t,i){if(t){var a=t[1-i];a=null!=a?a+"":"";var r=this.visualMapModel,o=r.get("textGap"),n=r.itemSize,s=this._shapes.barGroup,l=this._applyTransform([n[0]/2,0===i?-o:n[1]+o],s),h=this._applyTransform(0===i?"bottom":"top",s),d=this._orient,p=this.visualMapModel.textStyleModel;this.group.add(new graphic.Text({style:{x:l[0],y:l[1],textVerticalAlign:"horizontal"===d?"middle":h,textAlign:"horizontal"===d?h:"center",text:a,textFont:p.getFont(),textFill:p.getTextColor()}}))}},_renderBar:function(e){var t=this.visualMapModel,i=this._shapes,a=t.itemSize,r=this._orient,o=this._useHandle,n=helper.getItemAlign(t,this.api,a),s=i.barGroup=this._createBarGroup(n);s.add(i.outOfRange=createPolygon()),s.add(i.inRange=createPolygon(null,o?getCursor(this._orient):null,zrUtil.bind(this._dragHandle,this,"all",!1),zrUtil.bind(this._dragHandle,this,"all",!0)));var l=t.textStyleModel.getTextRect("国"),h=mathMax(l.width,l.height);o&&(i.handleThumbs=[],i.handleLabels=[],i.handleLabelPoints=[],this._createHandle(s,0,a,h,r,n),this._createHandle(s,1,a,h,r,n)),this._createIndicator(s,a,h,r),e.add(s)},_createHandle:function(e,t,i,a,r){var o=zrUtil.bind(this._dragHandle,this,t,!1),n=zrUtil.bind(this._dragHandle,this,t,!0),s=createPolygon(createHandlePoints(t,a),getCursor(this._orient),o,n);s.position[0]=i[0],e.add(s);var l=this.visualMapModel.textStyleModel,h=new graphic.Text({draggable:!0,drift:o,onmousemove:function(e){eventTool.stop(e.event)},ondragend:n,style:{x:0,y:0,text:"",textFont:l.getFont(),textFill:l.getTextColor()}});this.group.add(h);var d=["horizontal"===r?a/2:1.5*a,"horizontal"===r?0===t?-1.5*a:1.5*a:0===t?-a/2:a/2],p=this._shapes;p.handleThumbs[t]=s,p.handleLabelPoints[t]=d,p.handleLabels[t]=h},_createIndicator:function(e,t,i,a){var r=createPolygon([[0,0]],"move");r.position[0]=t[0],r.attr({invisible:!0,silent:!0}),e.add(r);var o=this.visualMapModel.textStyleModel,n=new graphic.Text({silent:!0,invisible:!0,style:{x:0,y:0,text:"",textFont:o.getFont(),textFill:o.getTextColor()}});this.group.add(n);var s=["horizontal"===a?i/2:HOVER_LINK_OUT+3,0],l=this._shapes;l.indicator=r,l.indicatorLabel=n,l.indicatorLabelPoint=s},_dragHandle:function(e,t,i,a){if(this._useHandle){if(this._dragging=!t,!t){var r=this._applyTransform([i,a],this._shapes.barGroup,!0);this._updateInterval(e,r[1]),this._updateView()}t===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),t?!this._hovering&&this._clearHoverLinkToSeries():useHoverLinkOnHandle(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},_resetInterval:function(){var e=this.visualMapModel,t=this._dataInterval=e.getSelected(),i=e.getExtent(),a=[0,e.itemSize[1]];this._handleEnds=[linearMap(t[0],i,a,!0),linearMap(t[1],i,a,!0)]},_updateInterval:function(e,t){t=t||0;var i=this.visualMapModel,a=this._handleEnds,r=[0,i.itemSize[1]];sliderMove(t,a,r,e,0);var o=i.getExtent();this._dataInterval=[linearMap(a[0],r,o,!0),linearMap(a[1],r,o,!0)]},_updateView:function(e){var t=this.visualMapModel,i=t.getExtent(),a=this._shapes,r=[0,t.itemSize[1]],o=e?r:this._handleEnds,n=this._createBarVisual(this._dataInterval,i,o,"inRange"),s=this._createBarVisual(i,i,r,"outOfRange");a.inRange.setStyle({fill:n.barColor,opacity:n.opacity}).setShape("points",n.barPoints),a.outOfRange.setStyle({fill:s.barColor,opacity:s.opacity}).setShape("points",s.barPoints),this._updateHandle(o,n)},_createBarVisual:function(e,t,i,a){var r={forceState:a,convertOpacityToAlpha:!0},o=this._makeColorGradient(e,r),n=[this.getControllerVisual(e[0],"symbolSize",r),this.getControllerVisual(e[1],"symbolSize",r)],s=this._createBarPoints(i,n);return{barColor:new LinearGradient(0,0,0,1,o),barPoints:s,handlesColor:[o[0].color,o[o.length-1].color]}},_makeColorGradient:function(e,t){var i=[],a=(e[1]-e[0])/100;i.push({color:this.getControllerVisual(e[0],"color",t),offset:0});for(var r=1;r<100;r++){var o=e[0]+a*r;if(o>e[1])break;i.push({color:this.getControllerVisual(o,"color",t),offset:r/100})}return i.push({color:this.getControllerVisual(e[1],"color",t),offset:1}),i},_createBarPoints:function(e,t){var i=this.visualMapModel.itemSize;return[[i[0]-t[0],e[0]],[i[0],e[0]],[i[0],e[1]],[i[0]-t[1],e[1]]]},_createBarGroup:function(e){var t=this._orient,i=this.visualMapModel.get("inverse");return new graphic.Group("horizontal"!==t||i?"horizontal"===t&&i?{scale:"bottom"===e?[-1,1]:[1,1],rotation:-Math.PI/2}:"vertical"!==t||i?{scale:"left"===e?[1,1]:[-1,1]}:{scale:"left"===e?[1,-1]:[-1,-1]}:{scale:"bottom"===e?[1,1]:[-1,1],rotation:Math.PI/2})},_updateHandle:function(e,t){if(this._useHandle){var i=this._shapes,a=this.visualMapModel,r=i.handleThumbs,o=i.handleLabels;each([0,1],function(n){var s=r[n];s.setStyle("fill",t.handlesColor[n]),s.position[1]=e[n];var l=graphic.applyTransform(i.handleLabelPoints[n],graphic.getTransform(s,this.group));o[n].setStyle({x:l[0],y:l[1],text:a.formatValueText(this._dataInterval[n]),textVerticalAlign:"middle",textAlign:this._applyTransform("horizontal"===this._orient?0===n?"bottom":"top":"left",i.barGroup)})},this)}},_showIndicator:function(e,t,i,a){var r=this.visualMapModel,o=r.getExtent(),n=r.itemSize,s=[0,n[1]],l=linearMap(e,o,s,!0),h=this._shapes,d=h.indicator;if(d){d.position[1]=l,d.attr("invisible",!1),d.setShape("points",createIndicatorPoints(!!i,a,l,n[1]));var p=this.getControllerVisual(e,"color",{convertOpacityToAlpha:!0});d.setStyle("fill",p);var u=graphic.applyTransform(h.indicatorLabelPoint,graphic.getTransform(d,this.group)),c=h.indicatorLabel;c.attr("invisible",!1);var v=this._applyTransform("left",h.barGroup),_=this._orient;c.setStyle({text:(i||"")+r.formatValueText(t),textVerticalAlign:"horizontal"===_?v:"middle",textAlign:"horizontal"===_?"center":v,x:u[0],y:u[1]})}},_enableHoverLinkToSeries:function(){var e=this;this._shapes.barGroup.on("mousemove",function(t){if(e._hovering=!0,!e._dragging){var i=e.visualMapModel.itemSize,a=e._applyTransform([t.offsetX,t.offsetY],e._shapes.barGroup,!0,!0);a[1]=mathMin(mathMax(0,a[1]),i[1]),e._doHoverLinkToSeries(a[1],0<=a[0]&&a[0]<=i[0])}}).on("mouseout",function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()})},_enableHoverLinkFromSeries:function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},_doHoverLinkToSeries:function(e,t){var i=this.visualMapModel,a=i.itemSize;if(i.option.hoverLink){var r=[0,a[1]],o=i.getExtent();e=mathMin(mathMax(r[0],e),r[1]);var n=getHalfHoverLinkSize(i,o,r),s=[e-n,e+n],l=linearMap(e,r,o,!0),h=[linearMap(s[0],r,o,!0),linearMap(s[1],r,o,!0)];s[0]<r[0]&&(h[0]=-1/0),s[1]>r[1]&&(h[1]=1/0),t&&(h[0]===-1/0?this._showIndicator(l,h[1],"< ",n):h[1]===1/0?this._showIndicator(l,h[0],"> ",n):this._showIndicator(l,l,"≈ ",n));var d=this._hoverLinkDataIndices,p=[];(t||useHoverLinkOnHandle(i))&&(p=this._hoverLinkDataIndices=i.findTargetDataIndices(h));var u=modelUtil.compressBatches(d,p);this._dispatchHighDown("downplay",helper.makeHighDownBatch(u[0],i)),this._dispatchHighDown("highlight",helper.makeHighDownBatch(u[1],i))}},_hoverLinkFromSeriesMouseOver:function(e){var t=e.target,i=this.visualMapModel;if(t&&null!=t.dataIndex){var a=this.ecModel.getSeriesByIndex(t.seriesIndex);if(i.isTargetSeries(a)){var r=a.getData(t.dataType),o=r.get(i.getDataDimension(r),t.dataIndex,!0);isNaN(o)||this._showIndicator(o,o)}}},_hideIndicator:function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0)},_clearHoverLinkToSeries:function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",helper.makeHighDownBatch(e,this.visualMapModel)),e.length=0},_clearHoverLinkFromSeries:function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},_applyTransform:function(e,t,i,a){var r=graphic.getTransform(t,a?null:this.group);return graphic[zrUtil.isArray(e)?"applyTransform":"transformDirection"](e,r,i)},_dispatchHighDown:function(e,t){t&&t.length&&this.api.dispatchAction({type:e,batch:t})},dispose:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},remove:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()}});function createPolygon(e,t,i,a){return new graphic.Polygon({shape:{points:e},draggable:!!i,cursor:t,drift:i,onmousemove:function(e){eventTool.stop(e.event)},ondragend:a})}function createHandlePoints(e,t){return 0===e?[[0,0],[t,0],[t,-t]]:[[0,0],[t,0],[t,t]]}function createIndicatorPoints(e,t,i,a){return e?[[0,-mathMin(t,mathMax(i,0))],[HOVER_LINK_OUT,0],[0,mathMin(t,mathMax(a-i,0))]]:[[0,0],[5,-5],[5,5]]}function getHalfHoverLinkSize(e,t,i){var a=HOVER_LINK_SIZE/2,r=e.get("hoverLinkDataSize");return r&&(a=linearMap(r,t,i,!0)/2),a}function useHoverLinkOnHandle(e){var t=e.get("hoverLinkOnHandle");return!!(null==t?e.get("realtime"):t)}function getCursor(e){return"vertical"===e?"ns-resize":"ew-resize"}export default ContinuousView;
//# sourceMappingURL=/sm/e168837907d08619945a0c902151d822f0347957618d9805a9f840cbc0c93afc.map