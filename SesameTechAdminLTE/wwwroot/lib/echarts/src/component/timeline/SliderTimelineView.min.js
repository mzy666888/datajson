/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/timeline/SliderTimelineView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import BoundingRect from"zrender/src/core/BoundingRect";import*as matrix from"zrender/src/core/matrix";import*as graphic from"../../util/graphic";import*as layout from"../../util/layout";import TimelineView from"./TimelineView";import TimelineAxis from"./TimelineAxis";import{createSymbol}from"../../util/symbol";import*as axisHelper from"../../coord/axisHelper";import*as numberUtil from"../../util/number";import{encodeHTML}from"../../util/format";var bind=zrUtil.bind,each=zrUtil.each,PI=Math.PI;export default TimelineView.extend({type:"timeline.slider",init:function(t,e){this.api=e,this._axis,this._viewRect,this._timer,this._currentPointer,this._mainGroup,this._labelGroup},render:function(t,e,i,o){if(this.model=t,this.api=i,this.ecModel=e,this.group.removeAll(),t.get("show",!0)){var n=this._layout(t,i),r=this._createGroup("mainGroup"),a=this._createGroup("labelGroup"),l=this._axis=this._createAxis(n,t);t.formatTooltip=function(t){return encodeHTML(l.scale.getLabel(t))},each(["AxisLine","AxisTick","Control","CurrentPointer"],function(e){this["_render"+e](n,r,l,t)},this),this._renderAxisLabel(n,a,l,t),this._position(n,t)}this._doPlayStop()},remove:function(){this._clearTimer(),this.group.removeAll()},dispose:function(){this._clearTimer()},_layout:function(t,e){var i=t.get("label.position"),o=t.get("orient"),n=getViewRect(t,e);null==i||"auto"===i?i="horizontal"===o?n.y+n.height/2<e.getHeight()/2?"-":"+":n.x+n.width/2<e.getWidth()/2?"+":"-":isNaN(i)&&(i={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[o][i]);var r,a,l,s,c={horizontal:"center",vertical:i>=0||"+"===i?"left":"right"},h={horizontal:i>=0||"+"===i?"top":"bottom",vertical:"middle"},g={horizontal:0,vertical:PI/2},m="vertical"===o?n.height:n.width,d=t.getModel("controlStyle"),u=d.get("show",!0),p=u?d.get("itemSize"):0,f=u?d.get("itemGap"):0,y=p+f,v=t.get("label.rotate")||0;v=v*PI/180;var _=d.get("position",!0),x=u&&d.get("showPlayBtn",!0),b=u&&d.get("showPrevBtn",!0),T=u&&d.get("showNextBtn",!0),S=0,P=m;return"left"===_||"bottom"===_?(x&&(r=[0,0],S+=y),b&&(a=[S,0],S+=y),T&&(l=[P-p,0],P-=y)):(x&&(r=[P-p,0],P-=y),b&&(a=[0,0],S+=y),T&&(l=[P-p,0],P-=y)),s=[S,P],t.get("inverse")&&s.reverse(),{viewRect:n,mainLength:m,orient:o,rotation:g[o],labelRotation:v,labelPosOpt:i,labelAlign:t.get("label.align")||c[o],labelBaseline:t.get("label.verticalAlign")||t.get("label.baseline")||h[o],playPosition:r,prevBtnPosition:a,nextBtnPosition:l,axisExtent:s,controlSize:p,controlGap:f}},_position:function(t,e){var i=this._mainGroup,o=this._labelGroup,n=t.viewRect;if("vertical"===t.orient){var r=matrix.create(),a=n.x,l=n.y+n.height;matrix.translate(r,r,[-a,-l]),matrix.rotate(r,r,-PI/2),matrix.translate(r,r,[a,l]),(n=n.clone()).applyTransform(r)}var s=f(n),c=f(i.getBoundingRect()),h=f(o.getBoundingRect()),g=i.position,m=o.position;m[0]=g[0]=s[0][0];var d,u=t.labelPosOpt;isNaN(u)?(y(g,c,s,1,d="+"===u?0:1),y(m,h,s,1,1-d)):(y(g,c,s,1,d=u>=0?0:1),m[1]=g[1]+u);function p(t){var e=t.position;t.origin=[s[0][0]-e[0],s[1][0]-e[1]]}function f(t){return[[t.x,t.x+t.width],[t.y,t.y+t.height]]}function y(t,e,i,o,n){t[o]+=i[o][n]-e[o][n]}i.attr("position",g),o.attr("position",m),i.rotation=o.rotation=t.rotation,p(i),p(o)},_createAxis:function(t,e){var i=e.getData(),o=e.get("axisType"),n=axisHelper.createScaleByModel(e,o);n.getTicks=function(){return i.mapArray(["value"],function(t){return t})};var r=i.getDataExtent("value");n.setExtent(r[0],r[1]),n.niceTicks();var a=new TimelineAxis("value",n,t.axisExtent,o);return a.model=e,a},_createGroup:function(t){var e=this["_"+t]=new graphic.Group;return this.group.add(e),e},_renderAxisLine:function(t,e,i,o){var n=i.getExtent();o.get("lineStyle.show")&&e.add(new graphic.Line({shape:{x1:n[0],y1:0,x2:n[1],y2:0},style:zrUtil.extend({lineCap:"round"},o.getModel("lineStyle").getLineStyle()),silent:!0,z2:1}))},_renderAxisTick:function(t,e,i,o){var n=o.getData(),r=i.scale.getTicks();each(r,function(t){var r=i.dataToCoord(t),a=n.getItemModel(t),l=a.getModel("itemStyle"),s=a.getModel("emphasis.itemStyle"),c={position:[r,0],onclick:bind(this._changeTimeline,this,t)},h=giveSymbol(a,l,e,c);graphic.setHoverStyle(h,s.getItemStyle()),a.get("tooltip")?(h.dataIndex=t,h.dataModel=o):h.dataIndex=h.dataModel=null},this)},_renderAxisLabel:function(t,e,i,o){if(i.getLabelModel().get("show")){var n=o.getData(),r=i.getViewLabels();each(r,function(o){var r=o.tickValue,a=n.getItemModel(r),l=a.getModel("label"),s=a.getModel("emphasis.label"),c=i.dataToCoord(o.tickValue),h=new graphic.Text({position:[c,0],rotation:t.labelRotation-t.rotation,onclick:bind(this._changeTimeline,this,r),silent:!1});graphic.setTextStyle(h.style,l,{text:o.formattedLabel,textAlign:t.labelAlign,textVerticalAlign:t.labelBaseline}),e.add(h),graphic.setHoverStyle(h,graphic.setTextStyle({},s))},this)}},_renderControl:function(t,e,i,o){var n=t.controlSize,r=t.rotation,a=o.getModel("controlStyle").getItemStyle(),l=o.getModel("emphasis.controlStyle").getItemStyle(),s=[0,-n/2,n,n],c=o.getPlayState(),h=o.get("inverse",!0);function g(t,i,c,h){if(t){var g=makeIcon(o,i,s,{position:t,origin:[n/2,0],rotation:h?-r:0,rectHover:!0,style:a,onclick:c});e.add(g),graphic.setHoverStyle(g,l)}}g(t.nextBtnPosition,"controlStyle.nextIcon",bind(this._changeTimeline,this,h?"-":"+")),g(t.prevBtnPosition,"controlStyle.prevIcon",bind(this._changeTimeline,this,h?"+":"-")),g(t.playPosition,"controlStyle."+(c?"stopIcon":"playIcon"),bind(this._handlePlayClick,this,!c),!0)},_renderCurrentPointer:function(t,e,i,o){var n=o.getData(),r=o.getCurrentIndex(),a=n.getItemModel(r).getModel("checkpointStyle"),l=this,s={onCreate:function(t){t.draggable=!0,t.drift=bind(l._handlePointerDrag,l),t.ondragend=bind(l._handlePointerDragend,l),pointerMoveTo(t,r,i,o,!0)},onUpdate:function(t){pointerMoveTo(t,r,i,o)}};this._currentPointer=giveSymbol(a,a,this._mainGroup,{},this._currentPointer,s)},_handlePlayClick:function(t){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:t,from:this.uid})},_handlePointerDrag:function(t,e,i){this._clearTimer(),this._pointerChangeTimeline([i.offsetX,i.offsetY])},_handlePointerDragend:function(t){this._pointerChangeTimeline([t.offsetX,t.offsetY],!0)},_pointerChangeTimeline:function(t,e){var i=this._toAxisCoord(t)[0],o=this._axis,n=numberUtil.asc(o.getExtent().slice());i>n[1]&&(i=n[1]),i<n[0]&&(i=n[0]),this._currentPointer.position[0]=i,this._currentPointer.dirty();var r=this._findNearestTick(i),a=this.model;(e||r!==a.getCurrentIndex()&&a.get("realtime"))&&this._changeTimeline(r)},_doPlayStop:function(){this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(bind(function(){var t=this.model;this._changeTimeline(t.getCurrentIndex()+(t.get("rewind",!0)?-1:1))},this),this.model.get("playInterval")))},_toAxisCoord:function(t){var e=this._mainGroup.getLocalTransform();return graphic.applyTransform(t,e,!0)},_findNearestTick:function(t){var e,i=this.model.getData(),o=1/0,n=this._axis;return i.each(["value"],function(i,r){var a=n.dataToCoord(i),l=Math.abs(a-t);l<o&&(o=l,e=r)}),e},_clearTimer:function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},_changeTimeline:function(t){var e=this.model.getCurrentIndex();"+"===t?t=e+1:"-"===t&&(t=e-1),this.api.dispatchAction({type:"timelineChange",currentIndex:t,from:this.uid})}});function getViewRect(t,e){return layout.getLayoutRect(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()},t.get("padding"))}function makeIcon(t,e,i,o){return graphic.makePath(t.get(e).replace(/^path:\/\//,""),zrUtil.clone(o||{}),new BoundingRect(i[0],i[1],i[2],i[3]),"center")}function giveSymbol(t,e,i,o,n,r){var a=e.get("color");if(n)n.setColor(a),i.add(n),r&&r.onUpdate(n);else{var l=t.get("symbol");(n=createSymbol(l,-1,-1,2,2,a)).setStyle("strokeNoScale",!0),i.add(n),r&&r.onCreate(n)}var s=e.getItemStyle(["color","symbol","symbolSize"]);n.setStyle(s),o=zrUtil.merge({rectHover:!0,z2:100},o,!0);var c=t.get("symbolSize");(c=c instanceof Array?c.slice():[+c,+c])[0]/=2,c[1]/=2,o.scale=c;var h=t.get("symbolOffset");if(h){var g=o.position=o.position||[0,0];g[0]+=numberUtil.parsePercent(h[0],c[0]),g[1]+=numberUtil.parsePercent(h[1],c[1])}var m=t.get("symbolRotate");return o.rotation=(m||0)*Math.PI/180||0,n.attr(o),n.updateTransform(),n}function pointerMoveTo(t,e,i,o,n){if(!t.dragging){var r=o.getModel("checkpointStyle"),a=i.dataToCoord(o.getData().get(["value"],e));n||!r.get("animation",!0)?t.attr({position:[a,0]}):(t.stopAnimation(!0),t.animateTo({position:[a,0]},r.get("animationDuration",!0),r.get("animationEasing",!0)))}}
//# sourceMappingURL=/sm/faa14cd69339d842bf7087b3e189f452f593549f44dc52d16bbd3587a757d3ee.map