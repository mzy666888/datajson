/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/helper/MapDraw.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import RoamController from"./RoamController";import*as roamHelper from"../../component/helper/roamHelper";import{onIrrelevantElement}from"../../component/helper/cursorHelper";import*as graphic from"../../util/graphic";import geoSourceManager from"../../coord/geo/geoSourceManager";import{getUID}from"../../util/component";function getFixedItemStyle(e){var o=e.getItemStyle(),t=e.get("areaColor");return null!=t&&(o.fill=t),o}function updateMapSelectHandler(e,o,t,r,a){t.off("click"),t.off("mousedown"),o.get("selectedMode")&&(t.on("mousedown",function(){e._mouseDownFlag=!0}),t.on("click",function(n){if(e._mouseDownFlag){e._mouseDownFlag=!1;for(var i=n.target;!i.__regions;)i=i.parent;if(i){var l={type:("geo"===o.mainType?"geo":"map")+"ToggleSelect",batch:zrUtil.map(i.__regions,function(e){return{name:e.name,from:a.uid}})};l[o.mainType+"Id"]=o.id,r.dispatchAction(l),updateMapSelected(o,t)}}}))}function updateMapSelected(e,o){o.eachChild(function(o){zrUtil.each(o.__regions,function(t){o.trigger(e.isSelected(t.name)?"emphasis":"normal")})})}function MapDraw(e,o){var t=new graphic.Group;this.uid=getUID("ec_map_draw"),this._controller=new RoamController(e.getZr()),this._controllerHost={target:o?t:null},this.group=t,this._updateGroup=o,this._mouseDownFlag,this._mapName,this._initialized,t.add(this._regionsGroup=new graphic.Group),t.add(this._backgroundGroup=new graphic.Group)}MapDraw.prototype={constructor:MapDraw,draw:function(e,o,t,r,a){var n="geo"===e.mainType,i=e.getData&&e.getData();n&&o.eachComponent({mainType:"series",subType:"map"},function(o){i||o.getHostGeoModel()!==e||(i=o.getData())});var l=e.coordinateSystem;this._updateBackground(l);var s=this._regionsGroup,p=this.group;l._roamTransformable.transform&&(p.transform=l._roamTransformable.transform.slice(),p.decomposeTransform());var m=l._rawTransformable.scale,c=l._rawTransformable.position;s.removeAll();var g=["itemStyle"],h=["emphasis","itemStyle"],u=["label"],d=["emphasis","label"],f=zrUtil.createHashMap();zrUtil.each(l.regions,function(o){var t=f.get(o.name)||f.set(o.name,new graphic.Group),r=new graphic.CompoundPath({segmentIgnoreThreshold:1,shape:{paths:[]}});t.add(r);var a,l=(U=e.getRegionModel(o.name)||e).getModel(g),_=U.getModel(h),v=getFixedItemStyle(l),y=getFixedItemStyle(_),w=U.getModel(u),S=U.getModel(d);if(i){a=i.indexOfName(o.name);var M=i.getItemVisual(a,"color",!0);M&&(v.fill=M)}var x=function(e){return[e[0]*m[0]+c[0],e[1]*m[1]+c[1]]};zrUtil.each(o.geometries,function(e){if("polygon"===e.type){for(var o=[],t=0;t<e.exterior.length;++t)o.push(x(e.exterior[t]));r.shape.paths.push(new graphic.Polygon({segmentIgnoreThreshold:1,shape:{points:o}}));for(t=0;t<(e.interiors?e.interiors.length:0);++t){for(var a=e.interiors[t],n=(o=[],0);n<a.length;++n)o.push(x(a[n]));r.shape.paths.push(new graphic.Polygon({segmentIgnoreThreshold:1,shape:{points:o}}))}}}),r.setStyle(v),r.style.strokeNoScale=!0,r.culling=!0;var I=w.get("show"),T=S.get("show"),D=i&&isNaN(i.get(i.mapDimension("value"),a)),z=i&&i.getItemLayout(a);if(n||D&&(I||T)||z&&z.showLabel){var G,b=n?o.name:a;(!i||a>=0)&&(G=e);var H=new graphic.Text({position:x(o.center.slice()),scale:[1/p.scale[0],1/p.scale[1]],z2:10,silent:!0});graphic.setLabelStyle(H.style,H.hoverStyle={},w,S,{labelFetcher:G,labelDataIndex:b,defaultText:o.name,useInsideStyle:!1},{textAlign:"center",textVerticalAlign:"middle"}),t.add(H)}if(i)i.setItemGraphicEl(a,t);else{var U=e.getRegionModel(o.name);r.eventData={componentType:"geo",componentIndex:e.componentIndex,geoIndex:e.componentIndex,name:o.name,region:U&&U.option||{}}}(t.__regions||(t.__regions=[])).push(o),t.highDownSilentOnTouch=!!e.get("selectedMode"),graphic.setHoverStyle(t,y),s.add(t)}),this._updateController(e,o,t),updateMapSelectHandler(this,e,s,t,r),updateMapSelected(e,s)},remove:function(){this._regionsGroup.removeAll(),this._backgroundGroup.removeAll(),this._controller.dispose(),this._mapName&&geoSourceManager.removeGraphic(this._mapName,this.uid),this._mapName=null,this._controllerHost={}},_updateBackground:function(e){var o=e.map;this._mapName!==o&&zrUtil.each(geoSourceManager.makeGraphic(o,this.uid),function(e){this._backgroundGroup.add(e)},this),this._mapName=o},_updateController:function(e,o,t){var r=e.coordinateSystem,a=this._controller,n=this._controllerHost;n.zoomLimit=e.get("scaleLimit"),n.zoom=r.getZoom(),a.enable(e.get("roam")||!1);var i=e.mainType;function l(){var o={type:"geoRoam",componentType:i};return o[i+"Id"]=e.id,o}a.off("pan").on("pan",function(e){this._mouseDownFlag=!1,roamHelper.updateViewOnPan(n,e.dx,e.dy),t.dispatchAction(zrUtil.extend(l(),{dx:e.dx,dy:e.dy}))},this),a.off("zoom").on("zoom",function(e){if(this._mouseDownFlag=!1,roamHelper.updateViewOnZoom(n,e.scale,e.originX,e.originY),t.dispatchAction(zrUtil.extend(l(),{zoom:e.scale,originX:e.originX,originY:e.originY})),this._updateGroup){var o=this.group.scale;this._regionsGroup.traverse(function(e){"text"===e.type&&e.attr("scale",[1/o[0],1/o[1]])})}},this),a.setPointerChecker(function(o,a,n){return r.getViewRectAfterRoam().contain(a,n)&&!onIrrelevantElement(o,t,e)})}};export default MapDraw;
//# sourceMappingURL=/sm/646b555ca3cb2f9d3fb0c7f276b5260280bed93b7d8128b3f3c1638aee9b9d54.map