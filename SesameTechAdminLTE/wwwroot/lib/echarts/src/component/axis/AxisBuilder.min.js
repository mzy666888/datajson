/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/axis/AxisBuilder.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{retrieve,defaults,extend,each}from"zrender/src/core/util";import*as formatUtil from"../../util/format";import*as graphic from"../../util/graphic";import Model from"../../model/Model";import{isRadianAroundZero,remRadian}from"../../util/number";import{createSymbol}from"../../util/symbol";import*as matrixUtil from"zrender/src/core/matrix";import{applyTransform as v2ApplyTransform}from"zrender/src/core/vector";import{shouldShowAllLabels}from"../../coord/axisHelper";var PI=Math.PI,AxisBuilder=function(e,t){this.opt=t,this.axisModel=e,defaults(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0}),this.group=new graphic.Group;var i=new graphic.Group({position:t.position.slice(),rotation:t.rotation});i.updateTransform(),this._transform=i.transform,this._dumbGroup=i};AxisBuilder.prototype={constructor:AxisBuilder,hasBuilder:function(e){return!!builders[e]},add:function(e){builders[e].call(this)},getGroup:function(){return this.group}};var builders={axisLine:function(){var e=this.opt,t=this.axisModel;if(t.get("axisLine.show")){var i=this.axisModel.axis.getExtent(),a=this._transform,r=[i[0],0],n=[i[1],0];a&&(v2ApplyTransform(r,r,a),v2ApplyTransform(n,n,a));var o=extend({lineCap:"round"},t.getModel("axisLine.lineStyle").getLineStyle());this.group.add(new graphic.Line({anid:"line",subPixelOptimize:!0,shape:{x1:r[0],y1:r[1],x2:n[0],y2:n[1]},style:o,strokeContainThreshold:e.strokeContainThreshold||5,silent:!0,z2:1}));var l=t.get("axisLine.symbol"),s=t.get("axisLine.symbolSize"),g=t.get("axisLine.symbolOffset")||0;if("number"==typeof g&&(g=[g,g]),null!=l){"string"==typeof l&&(l=[l,l]),"string"!=typeof s&&"number"!=typeof s||(s=[s,s]);var d=s[0],u=s[1];each([{rotate:e.rotation+Math.PI/2,offset:g[0],r:0},{rotate:e.rotation-Math.PI/2,offset:g[1],r:Math.sqrt((r[0]-n[0])*(r[0]-n[0])+(r[1]-n[1])*(r[1]-n[1]))}],function(t,i){if("none"!==l[i]&&null!=l[i]){var a=createSymbol(l[i],-d/2,-u/2,d,u,o.stroke,!0),n=t.r+t.offset,s=[r[0]+n*Math.cos(e.rotation),r[1]-n*Math.sin(e.rotation)];a.attr({rotation:t.rotate,position:s,silent:!0,z2:11}),this.group.add(a)}},this)}}},axisTickLabel:function(){var e=this.axisModel,t=this.opt,i=buildAxisTick(this,e,t);fixMinMaxLabelShow(e,buildAxisLabel(this,e,t),i)},axisName:function(){var e=this.opt,t=this.axisModel,i=retrieve(e.axisName,t.get("name"));if(i){var a,r,n=t.get("nameLocation"),o=e.nameDirection,l=t.getModel("nameTextStyle"),s=t.get("nameGap")||0,g=this.axisModel.axis.getExtent(),d=g[0]>g[1]?-1:1,u=["start"===n?g[0]-d*s:"end"===n?g[1]+d*s:(g[0]+g[1])/2,isNameLocationCenter(n)?e.labelOffset+o*s:0],m=t.get("nameRotate");null!=m&&(m=m*PI/180),isNameLocationCenter(n)?a=innerTextLayout(e.rotation,null!=m?m:e.rotation,o):(a=endTextLayout(e,n,m||0,g),null!=(r=e.axisNameAvailableWidth)&&(r=Math.abs(r/Math.sin(a.rotation)),!isFinite(r)&&(r=null)));var x=l.getFont(),c=t.get("nameTruncate",!0)||{},p=c.ellipsis,f=retrieve(e.nameTruncateMaxWidth,c.maxWidth,r),h=null!=p&&null!=f?formatUtil.truncateText(i,f,x,p,{minChar:2,placeholder:c.placeholder}):i,v=t.get("tooltip",!0),b=t.mainType,y={componentType:b,name:i,$vars:["name"]};y[b+"Index"]=t.componentIndex;var T=new graphic.Text({anid:"name",__fullText:i,__truncatedText:h,position:u,rotation:a.rotation,silent:isLabelSilent(t),z2:1,tooltip:v&&v.show?extend({content:i,formatter:function(){return i},formatterParams:y},v):null});graphic.setTextStyle(T.style,l,{text:h,textFont:x,textFill:l.getTextColor()||t.get("axisLine.lineStyle.color"),textAlign:l.get("align")||a.textAlign,textVerticalAlign:l.get("verticalAlign")||a.textVerticalAlign}),t.get("triggerEvent")&&(T.eventData=makeAxisEventDataBase(t),T.eventData.targetType="axisName",T.eventData.name=i),this._dumbGroup.add(T),T.updateTransform(),this.group.add(T),T.decomposeTransform()}}},makeAxisEventDataBase=AxisBuilder.makeAxisEventDataBase=function(e){var t={componentType:e.mainType,componentIndex:e.componentIndex};return t[e.mainType+"Index"]=e.componentIndex,t},innerTextLayout=AxisBuilder.innerTextLayout=function(e,t,i){var a,r,n=remRadian(t-e);return isRadianAroundZero(n)?(r=i>0?"top":"bottom",a="center"):isRadianAroundZero(n-PI)?(r=i>0?"bottom":"top",a="center"):(r="middle",a=n>0&&n<PI?i>0?"right":"left":i>0?"left":"right"),{rotation:n,textAlign:a,textVerticalAlign:r}};function endTextLayout(e,t,i,a){var r,n,o=remRadian(i-e.rotation),l=a[0]>a[1],s="start"===t&&!l||"start"!==t&&l;return isRadianAroundZero(o-PI/2)?(n=s?"bottom":"top",r="center"):isRadianAroundZero(o-1.5*PI)?(n=s?"top":"bottom",r="center"):(n="middle",r=o<1.5*PI&&o>PI/2?s?"left":"right":s?"right":"left"),{rotation:o,textAlign:r,textVerticalAlign:n}}var isLabelSilent=AxisBuilder.isLabelSilent=function(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)};function fixMinMaxLabelShow(e,t,i){if(!shouldShowAllLabels(e.axis)){var a=e.get("axisLabel.showMinLabel"),r=e.get("axisLabel.showMaxLabel");i=i||[];var n=(t=t||[])[0],o=t[1],l=t[t.length-1],s=t[t.length-2],g=i[0],d=i[1],u=i[i.length-1],m=i[i.length-2];!1===a?(ignoreEl(n),ignoreEl(g)):isTwoLabelOverlapped(n,o)&&(a?(ignoreEl(o),ignoreEl(d)):(ignoreEl(n),ignoreEl(g))),!1===r?(ignoreEl(l),ignoreEl(u)):isTwoLabelOverlapped(s,l)&&(r?(ignoreEl(s),ignoreEl(m)):(ignoreEl(l),ignoreEl(u)))}}function ignoreEl(e){e&&(e.ignore=!0)}function isTwoLabelOverlapped(e,t,i){var a=e&&e.getBoundingRect().clone(),r=t&&t.getBoundingRect().clone();if(a&&r){var n=matrixUtil.identity([]);return matrixUtil.rotate(n,n,-e.rotation),a.applyTransform(matrixUtil.mul([],n,e.getLocalTransform())),r.applyTransform(matrixUtil.mul([],n,t.getLocalTransform())),a.intersect(r)}}function isNameLocationCenter(e){return"middle"===e||"center"===e}function buildAxisTick(e,t,i){var a=t.axis;if(t.get("axisTick.show")&&!a.scale.isBlank()){for(var r=t.getModel("axisTick"),n=r.getModel("lineStyle"),o=r.get("length"),l=a.getTicksCoords(),s=[],g=[],d=e._transform,u=[],m=0;m<l.length;m++){var x=l[m].coord;s[0]=x,s[1]=0,g[0]=x,g[1]=i.tickDirection*o,d&&(v2ApplyTransform(s,s,d),v2ApplyTransform(g,g,d));var c=new graphic.Line({anid:"tick_"+l[m].tickValue,subPixelOptimize:!0,shape:{x1:s[0],y1:s[1],x2:g[0],y2:g[1]},style:defaults(n.getLineStyle(),{stroke:t.get("axisLine.lineStyle.color")}),z2:2,silent:!0});e.group.add(c),u.push(c)}return u}}function buildAxisLabel(e,t,i){var a=t.axis;if(retrieve(i.axisLabelShow,t.get("axisLabel.show"))&&!a.scale.isBlank()){var r=t.getModel("axisLabel"),n=r.get("margin"),o=a.getViewLabels(),l=(retrieve(i.labelRotate,r.get("rotate"))||0)*PI/180,s=innerTextLayout(i.rotation,l,i.labelDirection),g=t.getCategories&&t.getCategories(!0),d=[],u=isLabelSilent(t),m=t.get("triggerEvent");return each(o,function(o,l){var x=o.tickValue,c=o.formattedLabel,p=o.rawLabel,f=r;g&&g[x]&&g[x].textStyle&&(f=new Model(g[x].textStyle,r,t.ecModel));var h=f.getTextColor()||t.get("axisLine.lineStyle.color"),v=[a.dataToCoord(x),i.labelOffset+i.labelDirection*n],b=new graphic.Text({anid:"label_"+x,position:v,rotation:s.rotation,silent:u,z2:10});graphic.setTextStyle(b.style,f,{text:c,textAlign:f.getShallow("align",!0)||s.textAlign,textVerticalAlign:f.getShallow("verticalAlign",!0)||f.getShallow("baseline",!0)||s.textVerticalAlign,textFill:"function"==typeof h?h("category"===a.type?p:"value"===a.type?x+"":x,l):h}),m&&(b.eventData=makeAxisEventDataBase(t),b.eventData.targetType="axisLabel",b.eventData.value=p),e._dumbGroup.add(b),b.updateTransform(),d.push(b),e.group.add(b),b.decomposeTransform()}),d}}export default AxisBuilder;
//# sourceMappingURL=/sm/8887d0c0c19fc761a465fc74ff45a0ac1b655dc9f34373daddd787635377c7fd.map