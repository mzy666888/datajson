/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/component/dataZoom/SliderZoomView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import*as eventTool from"zrender/src/core/event";import*as graphic from"../../util/graphic";import*as throttle from"../../util/throttle";import DataZoomView from"./DataZoomView";import*as numberUtil from"../../util/number";import*as layout from"../../util/layout";import sliderMove from"../helper/sliderMove";var Rect=graphic.Rect,linearMap=numberUtil.linearMap,asc=numberUtil.asc,bind=zrUtil.bind,each=zrUtil.each,DEFAULT_LOCATION_EDGE_GAP=7,DEFAULT_FRAME_BORDER_WIDTH=1,DEFAULT_FILLER_SIZE=30,HORIZONTAL="horizontal",VERTICAL="vertical",LABEL_GAP=5,SHOW_DATA_SHADOW_SERIES_TYPE=["line","bar","candlestick","scatter"],SliderZoomView=DataZoomView.extend({type:"dataZoom.slider",init:function(t,e){this._displayables={},this._orient,this._range,this._handleEnds,this._size,this._handleWidth,this._handleHeight,this._location,this._dragging,this._dataShadowInfo,this.api=e},render:function(t,e,i,a){SliderZoomView.superApply(this,"render",arguments),throttle.createOrUpdate(this,"_dispatchZoomAction",this.dataZoomModel.get("throttle"),"fixRate"),this._orient=t.get("orient"),!1!==this.dataZoomModel.get("show")?(a&&"dataZoom"===a.type&&a.from===this.uid||this._buildView(),this._updateView()):this.group.removeAll()},remove:function(){SliderZoomView.superApply(this,"remove",arguments),throttle.clear(this,"_dispatchZoomAction")},dispose:function(){SliderZoomView.superApply(this,"dispose",arguments),throttle.clear(this,"_dispatchZoomAction")},_buildView:function(){var t=this.group;t.removeAll(),this._resetLocation(),this._resetInterval();var e=this._displayables.barGroup=new graphic.Group;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(e),this._positionGroup()},_resetLocation:function(){var t=this.dataZoomModel,e=this.api,i=this._findCoordRect(),a={width:e.getWidth(),height:e.getHeight()},o=this._orient===HORIZONTAL?{right:a.width-i.x-i.width,top:a.height-DEFAULT_FILLER_SIZE-DEFAULT_LOCATION_EDGE_GAP,width:i.width,height:DEFAULT_FILLER_SIZE}:{right:DEFAULT_LOCATION_EDGE_GAP,top:i.y,width:DEFAULT_FILLER_SIZE,height:i.height},s=layout.getLayoutParams(t.option);zrUtil.each(["right","top","width","height"],function(t){"ph"===s[t]&&(s[t]=o[t])});var n=layout.getLayoutRect(s,a,t.padding);this._location={x:n.x,y:n.y},this._size=[n.width,n.height],this._orient===VERTICAL&&this._size.reverse()},_positionGroup:function(){var t=this.group,e=this._location,i=this._orient,a=this.dataZoomModel.getFirstTargetAxisModel(),o=a&&a.get("inverse"),s=this._displayables.barGroup,n=(this._dataShadowInfo||{}).otherAxisInverse;s.attr(i!==HORIZONTAL||o?i===HORIZONTAL&&o?{scale:n?[-1,1]:[-1,-1]}:i!==VERTICAL||o?{scale:n?[-1,-1]:[-1,1],rotation:Math.PI/2}:{scale:n?[1,-1]:[1,1],rotation:Math.PI/2}:{scale:n?[1,1]:[1,-1]});var r=t.getBoundingRect([s]);t.attr("position",[e.x-r.x,e.y-r.y])},_getViewExtent:function(){return[0,this._size[0]]},_renderBackground:function(){var t=this.dataZoomModel,e=this._size,i=this._displayables.barGroup;i.add(new Rect({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:t.get("backgroundColor")},z2:-40})),i.add(new Rect({shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:"transparent"},z2:0,onclick:zrUtil.bind(this._onClickPanelClick,this)}))},_renderDataShadow:function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(t){var e=this._size,i=t.series,a=i.getRawData(),o=i.getShadowDim?i.getShadowDim():t.otherDim;if(null!=o){var s=a.getDataExtent(o),n=.3*(s[1]-s[0]);s=[s[0]-n,s[1]+n];var r,h=[0,e[1]],l=[0,e[0]],d=[[e[0],0],[0,0]],g=[],c=l[1]/(a.count()-1),_=0,p=Math.round(a.count()/e[0]);a.each([o],function(t,e){if(p>0&&e%p)_+=c;else{var i=null==t||isNaN(t)||""===t,a=i?0:linearMap(t,s,h,!0);i&&!r&&e?(d.push([d[d.length-1][0],0]),g.push([g[g.length-1][0],0])):!i&&r&&(d.push([_,0]),g.push([_,0])),d.push([_,a]),g.push([_,a]),_+=c,r=i}});var u=this.dataZoomModel;this._displayables.barGroup.add(new graphic.Polygon({shape:{points:d},style:zrUtil.defaults({fill:u.get("dataBackgroundColor")},u.getModel("dataBackground.areaStyle").getAreaStyle()),silent:!0,z2:-20})),this._displayables.barGroup.add(new graphic.Polyline({shape:{points:g},style:u.getModel("dataBackground.lineStyle").getLineStyle(),silent:!0,z2:-19}))}}},_prepareDataShadowInfo:function(){var t=this.dataZoomModel,e=t.get("showDataShadow");if(!1!==e){var i,a=this.ecModel;return t.eachTargetAxis(function(o,s){var n=t.getAxisProxy(o.name,s).getTargetSeriesModels();zrUtil.each(n,function(t){if(!(i||!0!==e&&zrUtil.indexOf(SHOW_DATA_SHADOW_SERIES_TYPE,t.get("type"))<0)){var n,r=a.getComponent(o.axis,s).axis,h=getOtherDim(o.name),l=t.coordinateSystem;null!=h&&l.getOtherAxis&&(n=l.getOtherAxis(r).inverse),h=t.getData().mapDimension(h),i={thisAxis:r,series:t,thisDim:o.name,otherDim:h,otherAxisInverse:n}}},this)},this),i}},_renderHandle:function(){var t=this._displayables,e=t.handles=[],i=t.handleLabels=[],a=this._displayables.barGroup,o=this._size,s=this.dataZoomModel;a.add(t.filler=new Rect({draggable:!0,cursor:getCursor(this._orient),drift:bind(this._onDragMove,this,"all"),onmousemove:function(t){eventTool.stop(t.event)},ondragstart:bind(this._showDataInfo,this,!0),ondragend:bind(this._onDragEnd,this),onmouseover:bind(this._showDataInfo,this,!0),onmouseout:bind(this._showDataInfo,this,!1),style:{fill:s.get("fillerColor"),textPosition:"inside"}})),a.add(new Rect({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:o[0],height:o[1]},style:{stroke:s.get("dataBackgroundColor")||s.get("borderColor"),lineWidth:DEFAULT_FRAME_BORDER_WIDTH,fill:"rgba(0,0,0,0)"}})),each([0,1],function(t){var o=graphic.createIcon(s.get("handleIcon"),{cursor:getCursor(this._orient),draggable:!0,drift:bind(this._onDragMove,this,t),onmousemove:function(t){eventTool.stop(t.event)},ondragend:bind(this._onDragEnd,this),onmouseover:bind(this._showDataInfo,this,!0),onmouseout:bind(this._showDataInfo,this,!1)},{x:-1,y:0,width:2,height:2}),n=o.getBoundingRect();this._handleHeight=numberUtil.parsePercent(s.get("handleSize"),this._size[1]),this._handleWidth=n.width/n.height*this._handleHeight,o.setStyle(s.getModel("handleStyle").getItemStyle());var r=s.get("handleColor");null!=r&&(o.style.fill=r),a.add(e[t]=o);var h=s.textStyleModel;this.group.add(i[t]=new graphic.Text({silent:!0,invisible:!0,style:{x:0,y:0,text:"",textVerticalAlign:"middle",textAlign:"center",textFill:h.getTextColor(),textFont:h.getFont()},z2:10}))},this)},_resetInterval:function(){var t=this._range=this.dataZoomModel.getPercentRange(),e=this._getViewExtent();this._handleEnds=[linearMap(t[0],[0,100],e,!0),linearMap(t[1],[0,100],e,!0)]},_updateInterval:function(t,e){var i=this.dataZoomModel,a=this._handleEnds,o=this._getViewExtent(),s=i.findRepresentativeAxisProxy().getMinMaxSpan(),n=[0,100];sliderMove(e,a,o,i.get("zoomLock")?"all":t,null!=s.minSpan?linearMap(s.minSpan,n,o,!0):null,null!=s.maxSpan?linearMap(s.maxSpan,n,o,!0):null);var r=this._range,h=this._range=asc([linearMap(a[0],o,n,!0),linearMap(a[1],o,n,!0)]);return!r||r[0]!==h[0]||r[1]!==h[1]},_updateView:function(t){var e=this._displayables,i=this._handleEnds,a=asc(i.slice()),o=this._size;each([0,1],function(t){var a=e.handles[t],s=this._handleHeight;a.attr({scale:[s/2,s/2],position:[i[t],o[1]/2-s/2]})},this),e.filler.setShape({x:a[0],y:0,width:a[1]-a[0],height:o[1]}),this._updateDataInfo(t)},_updateDataInfo:function(t){var e=this.dataZoomModel,i=this._displayables,a=i.handleLabels,o=this._orient,s=["",""];if(e.get("showDetail")){var n=e.findRepresentativeAxisProxy();if(n){var r=n.getAxisModel().axis,h=this._range,l=t?n.calculateDataWindow({start:h[0],end:h[1]}).valueWindow:n.getDataValueWindow();s=[this._formatLabel(l[0],r),this._formatLabel(l[1],r)]}}var d=asc(this._handleEnds.slice());function g(t){var e=graphic.getTransform(i.handles[t].parent,this.group),n=graphic.transformDirection(0===t?"right":"left",e),r=this._handleWidth/2+LABEL_GAP,h=graphic.applyTransform([d[t]+(0===t?-r:r),this._size[1]/2],e);a[t].setStyle({x:h[0],y:h[1],textVerticalAlign:o===HORIZONTAL?"middle":n,textAlign:o===HORIZONTAL?n:"center",text:s[t]})}g.call(this,0),g.call(this,1)},_formatLabel:function(t,e){var i=this.dataZoomModel,a=i.get("labelFormatter"),o=i.get("labelPrecision");null!=o&&"auto"!==o||(o=e.getPixelPrecision());var s=null==t||isNaN(t)?"":"category"===e.type||"time"===e.type?e.scale.getLabel(Math.round(t)):t.toFixed(Math.min(o,20));return zrUtil.isFunction(a)?a(t,s):zrUtil.isString(a)?a.replace("{value}",s):s},_showDataInfo:function(t){t=this._dragging||t;var e=this._displayables.handleLabels;e[0].attr("invisible",!t),e[1].attr("invisible",!t)},_onDragMove:function(t,e,i){this._dragging=!0;var a=this._displayables.barGroup.getLocalTransform(),o=graphic.applyTransform([e,i],a,!0),s=this._updateInterval(t,o[0]),n=this.dataZoomModel.get("realtime");this._updateView(!n),s&&n&&this._dispatchZoomAction()},_onDragEnd:function(){this._dragging=!1,this._showDataInfo(!1),!this.dataZoomModel.get("realtime")&&this._dispatchZoomAction()},_onClickPanelClick:function(t){var e=this._size,i=this._displayables.barGroup.transformCoordToLocal(t.offsetX,t.offsetY);if(!(i[0]<0||i[0]>e[0]||i[1]<0||i[1]>e[1])){var a=this._handleEnds,o=(a[0]+a[1])/2,s=this._updateInterval("all",i[0]-o);this._updateView(),s&&this._dispatchZoomAction()}},_dispatchZoomAction:function(){var t=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,start:t[0],end:t[1]})},_findCoordRect:function(){var t;if(each(this.getTargetCoordInfo(),function(e){if(!t&&e.length){var i=e[0].model.coordinateSystem;t=i.getRect&&i.getRect()}}),!t){var e=this.api.getWidth(),i=this.api.getHeight();t={x:.2*e,y:.2*i,width:.6*e,height:.6*i}}return t}});function getOtherDim(t){return{x:"y",y:"x",radius:"angle",angle:"radius"}[t]}function getCursor(t){return"vertical"===t?"ns-resize":"ew-resize"}export default SliderZoomView;
//# sourceMappingURL=/sm/18fbeee37d72b5f8ff7029d8371b463397c5f886f4108f7c3b683b3a3929ed65.map