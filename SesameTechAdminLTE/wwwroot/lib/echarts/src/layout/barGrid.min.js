/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/src/layout/barGrid.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as zrUtil from"zrender/src/core/util";import{parsePercent}from"../util/number";import{isDimensionStacked}from"../data/helper/dataStackHelper";import createRenderPlanner from"../chart/helper/createRenderPlanner";var STACK_PREFIX="__ec_stack_",LARGE_BAR_MIN_WIDTH=.5,LargeArr="undefined"!=typeof Float32Array?Float32Array:Array;function getSeriesStackId(t){return t.get("stack")||STACK_PREFIX+t.seriesIndex}function getAxisKey(t){return t.dim+t.index}export function getLayoutOnAxis(t){var e=[],a=t.axis;if("category"===a.type){for(var r=a.getBandWidth(),i=0;i<t.count;i++)e.push(zrUtil.defaults({bandWidth:r,axisKey:"axis0",stackId:STACK_PREFIX+i},t));var n=doCalBarWidthAndOffset(e),o=[];for(i=0;i<t.count;i++){var s=n.axis0[STACK_PREFIX+i];s.offsetCenter=s.offset+s.width/2,o.push(s)}return o}}export function prepareLayoutBarSeries(t,e){var a=[];return e.eachSeriesByType(t,function(t){isOnCartesian(t)&&!isInLargeMode(t)&&a.push(t)}),a}function getValueAxesMinGaps(t){var e={};zrUtil.each(t,function(t){var a=t.coordinateSystem.getBaseAxis();if("time"===a.type||"value"===a.type)for(var r=t.getData(),i=a.dim+"_"+a.index,n=r.mapDimension(a.dim),o=0,s=r.count();o<s;++o){var d=r.get(n,o);e[i]?e[i].push(d):e[i]=[d]}});var a=[];for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(i){i.sort(function(t,e){return t-e});for(var n=null,o=1;o<i.length;++o){var s=i[o]-i[o-1];s>0&&(n=null===n?s:Math.min(n,s))}a[r]=n}}return a}export function makeColumnLayout(t){var e=getValueAxesMinGaps(t),a=[];return zrUtil.each(t,function(t){var r,i=t.coordinateSystem.getBaseAxis(),n=i.getExtent();if("category"===i.type)r=i.getBandWidth();else if("value"===i.type||"time"===i.type){var o=i.dim+"_"+i.index,s=e[o],d=Math.abs(n[1]-n[0]),u=i.scale.getExtent(),h=Math.abs(u[1]-u[0]);r=s?d/h*s:d}else{var c=t.getData();r=Math.abs(n[1]-n[0])/c.count()}var l=parsePercent(t.get("barWidth"),r),p=parsePercent(t.get("barMaxWidth"),r),g=parsePercent(t.get("barMinWidth")||1,r),f=t.get("barGap"),m=t.get("barCategoryGap");a.push({bandWidth:r,barWidth:l,barMaxWidth:p,barMinWidth:g,barGap:f,barCategoryGap:m,axisKey:getAxisKey(i),stackId:getSeriesStackId(t)})}),doCalBarWidthAndOffset(a)}function doCalBarWidthAndOffset(t){var e={};zrUtil.each(t,function(t,a){var r=t.axisKey,i=t.bandWidth,n=e[r]||{bandWidth:i,remainedWidth:i,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},o=n.stacks;e[r]=n;var s=t.stackId;o[s]||n.autoWidthCount++,o[s]=o[s]||{width:0,maxWidth:0};var d=t.barWidth;d&&!o[s].width&&(o[s].width=d,d=Math.min(n.remainedWidth,d),n.remainedWidth-=d);var u=t.barMaxWidth;u&&(o[s].maxWidth=u);var h=t.barMinWidth;h&&(o[s].minWidth=h);var c=t.barGap;null!=c&&(n.gap=c);var l=t.barCategoryGap;null!=l&&(n.categoryGap=l)});var a={};return zrUtil.each(e,function(t,e){a[e]={};var r=t.stacks,i=t.bandWidth,n=parsePercent(t.categoryGap,i),o=parsePercent(t.gap,1),s=t.remainedWidth,d=t.autoWidthCount,u=(s-n)/(d+(d-1)*o);u=Math.max(u,0),zrUtil.each(r,function(t){var e=t.maxWidth,a=t.minWidth;if(t.width){r=t.width;e&&(r=Math.min(r,e)),a&&(r=Math.max(r,a)),t.width=r,s-=r,d--}else{var r=u;e&&e<r&&(r=Math.min(e,s)),a&&a>r&&(r=a),r!==u&&(t.width=r,s-=r,d--)}}),u=(s-n)/(d+(d-1)*o),u=Math.max(u,0);var h,c=0;zrUtil.each(r,function(t,e){t.width||(t.width=u),h=t,c+=t.width*(1+o)}),h&&(c-=h.width*o);var l=-c/2;zrUtil.each(r,function(t,r){a[e][r]=a[e][r]||{bandWidth:i,offset:l,width:t.width},l+=t.width*(1+o)})}),a}export function retrieveColumnLayout(t,e,a){if(t&&e){var r=t[getAxisKey(e)];return null!=r&&null!=a&&(r=r[getSeriesStackId(a)]),r}}export function layout(t,e){var a=prepareLayoutBarSeries(t,e),r=makeColumnLayout(a),i={},n={};zrUtil.each(a,function(t){var e=t.getData(),a=t.coordinateSystem,o=a.getBaseAxis(),s=getSeriesStackId(t),d=r[getAxisKey(o)][s],u=d.offset,h=d.width,c=a.getOtherAxis(o),l=t.get("barMinHeight")||0;i[s]=i[s]||[],n[s]=n[s]||[],e.setLayout({bandWidth:d.bandWidth,offset:u,size:h});for(var p=e.mapDimension(c.dim),g=e.mapDimension(o.dim),f=isDimensionStacked(e,p),m=c.isHorizontal(),y=getValueAxisStart(o,c,f),v=0,x=e.count();v<x;v++){var W=e.get(p,v),A=e.get(g,v);if(!isNaN(W)&&!isNaN(A)){var b,S,M,C,I,w=W>=0?"p":"n",L=y;if(f&&(i[s][A]||(i[s][A]={p:y,n:y}),L=i[s][A][w]),m)b=L,S=(I=a.dataToPoint([W,A]))[1]+u,M=I[0]-y,C=h,Math.abs(M)<l&&(M=(M<0?-1:1)*l),f&&(i[s][A][w]+=M);else b=(I=a.dataToPoint([A,W]))[0]+u,S=L,M=h,C=I[1]-y,Math.abs(C)<l&&(C=(C<=0?-1:1)*l),f&&(i[s][A][w]+=C);e.setItemLayout(v,{x:b,y:S,width:M,height:C})}}},this)}export var largeLayout={seriesType:"bar",plan:createRenderPlanner(),reset:function(t){if(isOnCartesian(t)&&isInLargeMode(t)){var e=t.getData(),a=t.coordinateSystem,r=a.getBaseAxis(),i=a.getOtherAxis(r),n=e.mapDimension(i.dim),o=e.mapDimension(r.dim),s=i.isHorizontal(),d=s?0:1,u=retrieveColumnLayout(makeColumnLayout([t]),r,t).width;return u>LARGE_BAR_MIN_WIDTH||(u=LARGE_BAR_MIN_WIDTH),{progress:function(t,e){var h,c=t.count,l=new LargeArr(2*c),p=new LargeArr(c),g=[],f=[],m=0,y=0;for(;null!=(h=t.next());)f[d]=e.get(n,h),f[1-d]=e.get(o,h),g=a.dataToPoint(f,null,g),l[m++]=g[0],l[m++]=g[1],p[y++]=h;e.setLayout({largePoints:l,largeDataIndices:p,barWidth:u,valueAxisStart:getValueAxisStart(r,i,!1),valueAxisHorizontal:s})}}}}};function isOnCartesian(t){return t.coordinateSystem&&"cartesian2d"===t.coordinateSystem.type}function isInLargeMode(t){return t.pipelineContext&&t.pipelineContext.large}function getValueAxisStart(t,e,a){return e.toGlobalCoord(e.dataToCoord("log"===e.type?1:0))}
//# sourceMappingURL=/sm/4bd6260ca907e90926dc4209be2b496009cbfc09090599e9eff624550dfc9160.map