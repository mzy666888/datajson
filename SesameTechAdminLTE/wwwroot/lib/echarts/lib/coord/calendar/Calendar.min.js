/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/coord/calendar/Calendar.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),layout=require("../../util/layout"),numberUtil=require("../../util/number"),CoordinateSystem=require("../../CoordinateSystem"),PROXIMATE_ONE_DAY=864e5;function Calendar(t,e,i){this._model=t}function doConvert(t,e,i,n){var r=i.calendarModel,a=i.seriesModel,s=r?r.coordinateSystem:a?a.coordinateSystem:null;return s===this?s[t](n):null}Calendar.prototype={constructor:Calendar,type:"calendar",dimensions:["time","value"],getDimensionsInfo:function(){return[{name:"time",type:"time"},"value"]},getRangeInfo:function(){return this._rangeInfo},getModel:function(){return this._model},getRect:function(){return this._rect},getCellWidth:function(){return this._sw},getCellHeight:function(){return this._sh},getOrient:function(){return this._orient},getFirstDayOfWeek:function(){return this._firstDayOfWeek},getDateInfo:function(t){var e=(t=numberUtil.parseDate(t)).getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;var n=t.getDate();n=n<10?"0"+n:n;var r=t.getDay();return{y:e,m:i,d:n,day:r=Math.abs((r+7-this.getFirstDayOfWeek())%7),time:t.getTime(),formatedDate:e+"-"+i+"-"+n,date:t}},getNextNDay:function(t,e){return 0===(e=e||0)?this.getDateInfo(t):((t=new Date(this.getDateInfo(t).time)).setDate(t.getDate()+e),this.getDateInfo(t))},update:function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var i=this._rangeInfo.weeks||1,n=["width","height"],r=this._model.get("cellSize").slice(),a=this._model.getBoxLayoutParams(),s="horizontal"===this._orient?[i,7]:[7,i];zrUtil.each([0,1],function(t){d(r,t)&&(a[n[t]]=r[t]*s[t])});var o={width:e.getWidth(),height:e.getHeight()},h=this._rect=layout.getLayoutRect(a,o);function d(t,e){return null!=t[e]&&"auto"!==t[e]}zrUtil.each([0,1],function(t){d(r,t)||(r[t]=h[n[t]]/s[t])}),this._sw=r[0],this._sh=r[1]},dataToPoint:function(t,e){zrUtil.isArray(t)&&(t=t[0]),null==e&&(e=!0);var i=this.getDateInfo(t),n=this._rangeInfo,r=i.formatedDate;if(e&&!(i.time>=n.start.time&&i.time<n.end.time+PROXIMATE_ONE_DAY))return[NaN,NaN];var a=i.day,s=this._getRangeInfo([n.start.time,r]).nthWeek;return"vertical"===this._orient?[this._rect.x+a*this._sw+this._sw/2,this._rect.y+s*this._sh+this._sh/2]:[this._rect.x+s*this._sw+this._sw/2,this._rect.y+a*this._sh+this._sh/2]},pointToData:function(t){var e=this.pointToDate(t);return e&&e.time},dataToRect:function(t,e){var i=this.dataToPoint(t,e);return{contentShape:{x:i[0]-(this._sw-this._lineWidth)/2,y:i[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:i,tl:[i[0]-this._sw/2,i[1]-this._sh/2],tr:[i[0]+this._sw/2,i[1]-this._sh/2],br:[i[0]+this._sw/2,i[1]+this._sh/2],bl:[i[0]-this._sw/2,i[1]+this._sh/2]}},pointToDate:function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,i=Math.floor((t[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return"vertical"===this._orient?this._getDateByWeeksAndDay(i,e-1,n):this._getDateByWeeksAndDay(e,i-1,n)},convertToPixel:zrUtil.curry(doConvert,"dataToPoint"),convertFromPixel:zrUtil.curry(doConvert,"pointToData"),_initRangeOption:function(){var t=this._model.get("range"),e=t;if(zrUtil.isArray(e)&&1===e.length&&(e=e[0]),/^\d{4}$/.test(e)&&(t=[e+"-01-01",e+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(e)){var i=this.getDateInfo(e),n=i.date;n.setMonth(n.getMonth()+1);var r=this.getNextNDay(n,-1);t=[i.formatedDate,r.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(e)&&(t=[e,e]);var a=this._getRangeInfo(t);return a.start.time>a.end.time&&t.reverse(),t},_getRangeInfo:function(t){var e;(t=[this.getDateInfo(t[0]),this.getDateInfo(t[1])])[0].time>t[1].time&&(e=!0,t.reverse());var i=Math.floor(t[1].time/PROXIMATE_ONE_DAY)-Math.floor(t[0].time/PROXIMATE_ONE_DAY)+1,n=new Date(t[0].time),r=n.getDate(),a=t[1].date.getDate();if(n.setDate(r+i-1),n.getDate()!==a)for(var s=n.getTime()-t[1].time>0?1:-1;n.getDate()!==a&&(n.getTime()-t[1].time)*s>0;)i-=s,n.setDate(r+i-1);var o=Math.floor((i+t[0].day+6)/7),h=e?1-o:o-1;return e&&t.reverse(),{range:[t[0].formatedDate,t[1].formatedDate],start:t[0],end:t[1],allDay:i,weeks:o,nthWeek:h,fweek:t[0].day,lweek:t[1].day}},_getDateByWeeksAndDay:function(t,e,i){var n=this._getRangeInfo(i);if(t>n.weeks||0===t&&e<n.fweek||t===n.weeks&&e>n.lweek)return!1;var r=7*(t-1)-n.fweek+e,a=new Date(n.start.time);return a.setDate(n.start.d+r),this.getDateInfo(a)}},Calendar.dimensions=Calendar.prototype.dimensions,Calendar.getDimensionsInfo=Calendar.prototype.getDimensionsInfo,Calendar.create=function(t,e){var i=[];return t.eachComponent("calendar",function(n){var r=new Calendar(n,t,e);i.push(r),n.coordinateSystem=r}),t.eachSeries(function(t){"calendar"===t.get("coordinateSystem")&&(t.coordinateSystem=i[t.get("calendarIndex")||0])}),i},CoordinateSystem.register("calendar",Calendar);var _default=Calendar;module.exports=_default;
//# sourceMappingURL=/sm/344c2e85fbbe26ae37c4f41a76f77f867b0e66b0fdef5c079df06bede55c2b4c.map