/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/component/timeline/SliderTimelineView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),BoundingRect=require("zrender/lib/core/BoundingRect"),matrix=require("zrender/lib/core/matrix"),graphic=require("../../util/graphic"),layout=require("../../util/layout"),TimelineView=require("./TimelineView"),TimelineAxis=require("./TimelineAxis"),_symbol=require("../../util/symbol"),createSymbol=_symbol.createSymbol,axisHelper=require("../../coord/axisHelper"),numberUtil=require("../../util/number"),_format=require("../../util/format"),encodeHTML=_format.encodeHTML,bind=zrUtil.bind,each=zrUtil.each,PI=Math.PI,_default=TimelineView.extend({type:"timeline.slider",init:function(e,t){this.api=t,this._axis,this._viewRect,this._timer,this._currentPointer,this._mainGroup,this._labelGroup},render:function(e,t,i,n){if(this.model=e,this.api=i,this.ecModel=t,this.group.removeAll(),e.get("show",!0)){var o=this._layout(e,i),r=this._createGroup("mainGroup"),a=this._createGroup("labelGroup"),l=this._axis=this._createAxis(o,e);e.formatTooltip=function(e){return encodeHTML(l.scale.getLabel(e))},each(["AxisLine","AxisTick","Control","CurrentPointer"],function(t){this["_render"+t](o,r,l,e)},this),this._renderAxisLabel(o,a,l,e),this._position(o,e)}this._doPlayStop()},remove:function(){this._clearTimer(),this.group.removeAll()},dispose:function(){this._clearTimer()},_layout:function(e,t){var i=e.get("label.position"),n=e.get("orient"),o=getViewRect(e,t);null==i||"auto"===i?i="horizontal"===n?o.y+o.height/2<t.getHeight()/2?"-":"+":o.x+o.width/2<t.getWidth()/2?"+":"-":isNaN(i)&&(i={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[n][i]);var r,a,l,s,c={horizontal:"center",vertical:i>=0||"+"===i?"left":"right"},h={horizontal:i>=0||"+"===i?"top":"bottom",vertical:"middle"},g={horizontal:0,vertical:PI/2},d="vertical"===n?o.height:o.width,u=e.getModel("controlStyle"),m=u.get("show",!0),p=m?u.get("itemSize"):0,y=m?u.get("itemGap"):0,f=p+y,v=e.get("label.rotate")||0;v=v*PI/180;var _=u.get("position",!0),b=m&&u.get("showPlayBtn",!0),x=m&&u.get("showPrevBtn",!0),T=m&&u.get("showNextBtn",!0),S=0,P=d;return"left"===_||"bottom"===_?(b&&(r=[0,0],S+=f),x&&(a=[S,0],S+=f),T&&(l=[P-p,0],P-=f)):(b&&(r=[P-p,0],P-=f),x&&(a=[0,0],S+=f),T&&(l=[P-p,0],P-=f)),s=[S,P],e.get("inverse")&&s.reverse(),{viewRect:o,mainLength:d,orient:n,rotation:g[n],labelRotation:v,labelPosOpt:i,labelAlign:e.get("label.align")||c[n],labelBaseline:e.get("label.verticalAlign")||e.get("label.baseline")||h[n],playPosition:r,prevBtnPosition:a,nextBtnPosition:l,axisExtent:s,controlSize:p,controlGap:y}},_position:function(e,t){var i=this._mainGroup,n=this._labelGroup,o=e.viewRect;if("vertical"===e.orient){var r=matrix.create(),a=o.x,l=o.y+o.height;matrix.translate(r,r,[-a,-l]),matrix.rotate(r,r,-PI/2),matrix.translate(r,r,[a,l]),(o=o.clone()).applyTransform(r)}var s=y(o),c=y(i.getBoundingRect()),h=y(n.getBoundingRect()),g=i.position,d=n.position;d[0]=g[0]=s[0][0];var u,m=e.labelPosOpt;isNaN(m)?(f(g,c,s,1,u="+"===m?0:1),f(d,h,s,1,1-u)):(f(g,c,s,1,u=m>=0?0:1),d[1]=g[1]+m);function p(e){var t=e.position;e.origin=[s[0][0]-t[0],s[1][0]-t[1]]}function y(e){return[[e.x,e.x+e.width],[e.y,e.y+e.height]]}function f(e,t,i,n,o){e[n]+=i[n][o]-t[n][o]}i.attr("position",g),n.attr("position",d),i.rotation=n.rotation=e.rotation,p(i),p(n)},_createAxis:function(e,t){var i=t.getData(),n=t.get("axisType"),o=axisHelper.createScaleByModel(t,n);o.getTicks=function(){return i.mapArray(["value"],function(e){return e})};var r=i.getDataExtent("value");o.setExtent(r[0],r[1]),o.niceTicks();var a=new TimelineAxis("value",o,e.axisExtent,n);return a.model=t,a},_createGroup:function(e){var t=this["_"+e]=new graphic.Group;return this.group.add(t),t},_renderAxisLine:function(e,t,i,n){var o=i.getExtent();n.get("lineStyle.show")&&t.add(new graphic.Line({shape:{x1:o[0],y1:0,x2:o[1],y2:0},style:zrUtil.extend({lineCap:"round"},n.getModel("lineStyle").getLineStyle()),silent:!0,z2:1}))},_renderAxisTick:function(e,t,i,n){var o=n.getData(),r=i.scale.getTicks();each(r,function(e){var r=i.dataToCoord(e),a=o.getItemModel(e),l=a.getModel("itemStyle"),s=a.getModel("emphasis.itemStyle"),c={position:[r,0],onclick:bind(this._changeTimeline,this,e)},h=giveSymbol(a,l,t,c);graphic.setHoverStyle(h,s.getItemStyle()),a.get("tooltip")?(h.dataIndex=e,h.dataModel=n):h.dataIndex=h.dataModel=null},this)},_renderAxisLabel:function(e,t,i,n){if(i.getLabelModel().get("show")){var o=n.getData(),r=i.getViewLabels();each(r,function(n){var r=n.tickValue,a=o.getItemModel(r),l=a.getModel("label"),s=a.getModel("emphasis.label"),c=i.dataToCoord(n.tickValue),h=new graphic.Text({position:[c,0],rotation:e.labelRotation-e.rotation,onclick:bind(this._changeTimeline,this,r),silent:!1});graphic.setTextStyle(h.style,l,{text:n.formattedLabel,textAlign:e.labelAlign,textVerticalAlign:e.labelBaseline}),t.add(h),graphic.setHoverStyle(h,graphic.setTextStyle({},s))},this)}},_renderControl:function(e,t,i,n){var o=e.controlSize,r=e.rotation,a=n.getModel("controlStyle").getItemStyle(),l=n.getModel("emphasis.controlStyle").getItemStyle(),s=[0,-o/2,o,o],c=n.getPlayState(),h=n.get("inverse",!0);function g(e,i,c,h){if(e){var g=makeIcon(n,i,s,{position:e,origin:[o/2,0],rotation:h?-r:0,rectHover:!0,style:a,onclick:c});t.add(g),graphic.setHoverStyle(g,l)}}g(e.nextBtnPosition,"controlStyle.nextIcon",bind(this._changeTimeline,this,h?"-":"+")),g(e.prevBtnPosition,"controlStyle.prevIcon",bind(this._changeTimeline,this,h?"+":"-")),g(e.playPosition,"controlStyle."+(c?"stopIcon":"playIcon"),bind(this._handlePlayClick,this,!c),!0)},_renderCurrentPointer:function(e,t,i,n){var o=n.getData(),r=n.getCurrentIndex(),a=o.getItemModel(r).getModel("checkpointStyle"),l=this,s={onCreate:function(e){e.draggable=!0,e.drift=bind(l._handlePointerDrag,l),e.ondragend=bind(l._handlePointerDragend,l),pointerMoveTo(e,r,i,n,!0)},onUpdate:function(e){pointerMoveTo(e,r,i,n)}};this._currentPointer=giveSymbol(a,a,this._mainGroup,{},this._currentPointer,s)},_handlePlayClick:function(e){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:e,from:this.uid})},_handlePointerDrag:function(e,t,i){this._clearTimer(),this._pointerChangeTimeline([i.offsetX,i.offsetY])},_handlePointerDragend:function(e){this._pointerChangeTimeline([e.offsetX,e.offsetY],!0)},_pointerChangeTimeline:function(e,t){var i=this._toAxisCoord(e)[0],n=this._axis,o=numberUtil.asc(n.getExtent().slice());i>o[1]&&(i=o[1]),i<o[0]&&(i=o[0]),this._currentPointer.position[0]=i,this._currentPointer.dirty();var r=this._findNearestTick(i),a=this.model;(t||r!==a.getCurrentIndex()&&a.get("realtime"))&&this._changeTimeline(r)},_doPlayStop:function(){this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(bind(function(){var e=this.model;this._changeTimeline(e.getCurrentIndex()+(e.get("rewind",!0)?-1:1))},this),this.model.get("playInterval")))},_toAxisCoord:function(e){var t=this._mainGroup.getLocalTransform();return graphic.applyTransform(e,t,!0)},_findNearestTick:function(e){var t,i=this.model.getData(),n=1/0,o=this._axis;return i.each(["value"],function(i,r){var a=o.dataToCoord(i),l=Math.abs(a-e);l<n&&(n=l,t=r)}),t},_clearTimer:function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},_changeTimeline:function(e){var t=this.model.getCurrentIndex();"+"===e?e=t+1:"-"===e&&(e=t-1),this.api.dispatchAction({type:"timelineChange",currentIndex:e,from:this.uid})}});function getViewRect(e,t){return layout.getLayoutRect(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()},e.get("padding"))}function makeIcon(e,t,i,n){return graphic.makePath(e.get(t).replace(/^path:\/\//,""),zrUtil.clone(n||{}),new BoundingRect(i[0],i[1],i[2],i[3]),"center")}function giveSymbol(e,t,i,n,o,r){var a=t.get("color");if(o)o.setColor(a),i.add(o),r&&r.onUpdate(o);else{var l=e.get("symbol");(o=createSymbol(l,-1,-1,2,2,a)).setStyle("strokeNoScale",!0),i.add(o),r&&r.onCreate(o)}var s=t.getItemStyle(["color","symbol","symbolSize"]);o.setStyle(s),n=zrUtil.merge({rectHover:!0,z2:100},n,!0);var c=e.get("symbolSize");(c=c instanceof Array?c.slice():[+c,+c])[0]/=2,c[1]/=2,n.scale=c;var h=e.get("symbolOffset");if(h){var g=n.position=n.position||[0,0];g[0]+=numberUtil.parsePercent(h[0],c[0]),g[1]+=numberUtil.parsePercent(h[1],c[1])}var d=e.get("symbolRotate");return n.rotation=(d||0)*Math.PI/180||0,o.attr(n),o.updateTransform(),o}function pointerMoveTo(e,t,i,n,o){if(!e.dragging){var r=n.getModel("checkpointStyle"),a=i.dataToCoord(n.getData().get(["value"],t));o||!r.get("animation",!0)?e.attr({position:[a,0]}):(e.stopAnimation(!0),e.animateTo({position:[a,0]},r.get("animationDuration",!0),r.get("animationEasing",!0)))}}module.exports=_default;
//# sourceMappingURL=/sm/a0c349a766e4b805ffa057b06e348d4a4638d0daa18066ac4a6dbba404d2b3b6.map