/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/component/visualMap/ContinuousView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),LinearGradient=require("zrender/lib/graphic/LinearGradient"),eventTool=require("zrender/lib/core/event"),VisualMapView=require("./VisualMapView"),graphic=require("../../util/graphic"),numberUtil=require("../../util/number"),sliderMove=require("../helper/sliderMove"),helper=require("./helper"),modelUtil=require("../../util/model"),linearMap=numberUtil.linearMap,each=zrUtil.each,mathMin=Math.min,mathMax=Math.max,HOVER_LINK_SIZE=12,HOVER_LINK_OUT=6,ContinuousView=VisualMapView.extend({type:"visualMap.continuous",init:function(){ContinuousView.superApply(this,"init",arguments),this._shapes={},this._dataInterval=[],this._handleEnds=[],this._orient,this._useHandle,this._hoverLinkDataIndices=[],this._dragging,this._hovering},doRender:function(e,t,i,a){a&&"selectDataRange"===a.type&&a.from===this.uid||this._buildView()},_buildView:function(){this.group.removeAll();var e=this.visualMapModel,t=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(t);var i=e.get("text");this._renderEndsText(t,i,0),this._renderEndsText(t,i,1),this._updateView(!0),this.renderBackground(t),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(t)},_renderEndsText:function(e,t,i){if(t){var a=t[1-i];a=null!=a?a+"":"";var r=this.visualMapModel,n=r.get("textGap"),o=r.itemSize,s=this._shapes.barGroup,l=this._applyTransform([o[0]/2,0===i?-n:o[1]+n],s),h=this._applyTransform(0===i?"bottom":"top",s),d=this._orient,u=this.visualMapModel.textStyleModel;this.group.add(new graphic.Text({style:{x:l[0],y:l[1],textVerticalAlign:"horizontal"===d?"middle":h,textAlign:"horizontal"===d?h:"center",text:a,textFont:u.getFont(),textFill:u.getTextColor()}}))}},_renderBar:function(e){var t=this.visualMapModel,i=this._shapes,a=t.itemSize,r=this._orient,n=this._useHandle,o=helper.getItemAlign(t,this.api,a),s=i.barGroup=this._createBarGroup(o);s.add(i.outOfRange=createPolygon()),s.add(i.inRange=createPolygon(null,n?getCursor(this._orient):null,zrUtil.bind(this._dragHandle,this,"all",!1),zrUtil.bind(this._dragHandle,this,"all",!0)));var l=t.textStyleModel.getTextRect("国"),h=mathMax(l.width,l.height);n&&(i.handleThumbs=[],i.handleLabels=[],i.handleLabelPoints=[],this._createHandle(s,0,a,h,r,o),this._createHandle(s,1,a,h,r,o)),this._createIndicator(s,a,h,r),e.add(s)},_createHandle:function(e,t,i,a,r){var n=zrUtil.bind(this._dragHandle,this,t,!1),o=zrUtil.bind(this._dragHandle,this,t,!0),s=createPolygon(createHandlePoints(t,a),getCursor(this._orient),n,o);s.position[0]=i[0],e.add(s);var l=this.visualMapModel.textStyleModel,h=new graphic.Text({draggable:!0,drift:n,onmousemove:function(e){eventTool.stop(e.event)},ondragend:o,style:{x:0,y:0,text:"",textFont:l.getFont(),textFill:l.getTextColor()}});this.group.add(h);var d=["horizontal"===r?a/2:1.5*a,"horizontal"===r?0===t?-1.5*a:1.5*a:0===t?-a/2:a/2],u=this._shapes;u.handleThumbs[t]=s,u.handleLabelPoints[t]=d,u.handleLabels[t]=h},_createIndicator:function(e,t,i,a){var r=createPolygon([[0,0]],"move");r.position[0]=t[0],r.attr({invisible:!0,silent:!0}),e.add(r);var n=this.visualMapModel.textStyleModel,o=new graphic.Text({silent:!0,invisible:!0,style:{x:0,y:0,text:"",textFont:n.getFont(),textFill:n.getTextColor()}});this.group.add(o);var s=["horizontal"===a?i/2:HOVER_LINK_OUT+3,0],l=this._shapes;l.indicator=r,l.indicatorLabel=o,l.indicatorLabelPoint=s},_dragHandle:function(e,t,i,a){if(this._useHandle){if(this._dragging=!t,!t){var r=this._applyTransform([i,a],this._shapes.barGroup,!0);this._updateInterval(e,r[1]),this._updateView()}t===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),t?!this._hovering&&this._clearHoverLinkToSeries():useHoverLinkOnHandle(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},_resetInterval:function(){var e=this.visualMapModel,t=this._dataInterval=e.getSelected(),i=e.getExtent(),a=[0,e.itemSize[1]];this._handleEnds=[linearMap(t[0],i,a,!0),linearMap(t[1],i,a,!0)]},_updateInterval:function(e,t){t=t||0;var i=this.visualMapModel,a=this._handleEnds,r=[0,i.itemSize[1]];sliderMove(t,a,r,e,0);var n=i.getExtent();this._dataInterval=[linearMap(a[0],r,n,!0),linearMap(a[1],r,n,!0)]},_updateView:function(e){var t=this.visualMapModel,i=t.getExtent(),a=this._shapes,r=[0,t.itemSize[1]],n=e?r:this._handleEnds,o=this._createBarVisual(this._dataInterval,i,n,"inRange"),s=this._createBarVisual(i,i,r,"outOfRange");a.inRange.setStyle({fill:o.barColor,opacity:o.opacity}).setShape("points",o.barPoints),a.outOfRange.setStyle({fill:s.barColor,opacity:s.opacity}).setShape("points",s.barPoints),this._updateHandle(n,o)},_createBarVisual:function(e,t,i,a){var r={forceState:a,convertOpacityToAlpha:!0},n=this._makeColorGradient(e,r),o=[this.getControllerVisual(e[0],"symbolSize",r),this.getControllerVisual(e[1],"symbolSize",r)],s=this._createBarPoints(i,o);return{barColor:new LinearGradient(0,0,0,1,n),barPoints:s,handlesColor:[n[0].color,n[n.length-1].color]}},_makeColorGradient:function(e,t){var i=[],a=(e[1]-e[0])/100;i.push({color:this.getControllerVisual(e[0],"color",t),offset:0});for(var r=1;r<100;r++){var n=e[0]+a*r;if(n>e[1])break;i.push({color:this.getControllerVisual(n,"color",t),offset:r/100})}return i.push({color:this.getControllerVisual(e[1],"color",t),offset:1}),i},_createBarPoints:function(e,t){var i=this.visualMapModel.itemSize;return[[i[0]-t[0],e[0]],[i[0],e[0]],[i[0],e[1]],[i[0]-t[1],e[1]]]},_createBarGroup:function(e){var t=this._orient,i=this.visualMapModel.get("inverse");return new graphic.Group("horizontal"!==t||i?"horizontal"===t&&i?{scale:"bottom"===e?[-1,1]:[1,1],rotation:-Math.PI/2}:"vertical"!==t||i?{scale:"left"===e?[1,1]:[-1,1]}:{scale:"left"===e?[1,-1]:[-1,-1]}:{scale:"bottom"===e?[1,1]:[-1,1],rotation:Math.PI/2})},_updateHandle:function(e,t){if(this._useHandle){var i=this._shapes,a=this.visualMapModel,r=i.handleThumbs,n=i.handleLabels;each([0,1],function(o){var s=r[o];s.setStyle("fill",t.handlesColor[o]),s.position[1]=e[o];var l=graphic.applyTransform(i.handleLabelPoints[o],graphic.getTransform(s,this.group));n[o].setStyle({x:l[0],y:l[1],text:a.formatValueText(this._dataInterval[o]),textVerticalAlign:"middle",textAlign:this._applyTransform("horizontal"===this._orient?0===o?"bottom":"top":"left",i.barGroup)})},this)}},_showIndicator:function(e,t,i,a){var r=this.visualMapModel,n=r.getExtent(),o=r.itemSize,s=[0,o[1]],l=linearMap(e,n,s,!0),h=this._shapes,d=h.indicator;if(d){d.position[1]=l,d.attr("invisible",!1),d.setShape("points",createIndicatorPoints(!!i,a,l,o[1]));var u=this.getControllerVisual(e,"color",{convertOpacityToAlpha:!0});d.setStyle("fill",u);var c=graphic.applyTransform(h.indicatorLabelPoint,graphic.getTransform(d,this.group)),p=h.indicatorLabel;p.attr("invisible",!1);var v=this._applyTransform("left",h.barGroup),_=this._orient;p.setStyle({text:(i||"")+r.formatValueText(t),textVerticalAlign:"horizontal"===_?v:"middle",textAlign:"horizontal"===_?"center":v,x:c[0],y:c[1]})}},_enableHoverLinkToSeries:function(){var e=this;this._shapes.barGroup.on("mousemove",function(t){if(e._hovering=!0,!e._dragging){var i=e.visualMapModel.itemSize,a=e._applyTransform([t.offsetX,t.offsetY],e._shapes.barGroup,!0,!0);a[1]=mathMin(mathMax(0,a[1]),i[1]),e._doHoverLinkToSeries(a[1],0<=a[0]&&a[0]<=i[0])}}).on("mouseout",function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()})},_enableHoverLinkFromSeries:function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},_doHoverLinkToSeries:function(e,t){var i=this.visualMapModel,a=i.itemSize;if(i.option.hoverLink){var r=[0,a[1]],n=i.getExtent();e=mathMin(mathMax(r[0],e),r[1]);var o=getHalfHoverLinkSize(i,n,r),s=[e-o,e+o],l=linearMap(e,r,n,!0),h=[linearMap(s[0],r,n,!0),linearMap(s[1],r,n,!0)];s[0]<r[0]&&(h[0]=-1/0),s[1]>r[1]&&(h[1]=1/0),t&&(h[0]===-1/0?this._showIndicator(l,h[1],"< ",o):h[1]===1/0?this._showIndicator(l,h[0],"> ",o):this._showIndicator(l,l,"≈ ",o));var d=this._hoverLinkDataIndices,u=[];(t||useHoverLinkOnHandle(i))&&(u=this._hoverLinkDataIndices=i.findTargetDataIndices(h));var c=modelUtil.compressBatches(d,u);this._dispatchHighDown("downplay",helper.makeHighDownBatch(c[0],i)),this._dispatchHighDown("highlight",helper.makeHighDownBatch(c[1],i))}},_hoverLinkFromSeriesMouseOver:function(e){var t=e.target,i=this.visualMapModel;if(t&&null!=t.dataIndex){var a=this.ecModel.getSeriesByIndex(t.seriesIndex);if(i.isTargetSeries(a)){var r=a.getData(t.dataType),n=r.get(i.getDataDimension(r),t.dataIndex,!0);isNaN(n)||this._showIndicator(n,n)}}},_hideIndicator:function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0)},_clearHoverLinkToSeries:function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",helper.makeHighDownBatch(e,this.visualMapModel)),e.length=0},_clearHoverLinkFromSeries:function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},_applyTransform:function(e,t,i,a){var r=graphic.getTransform(t,a?null:this.group);return graphic[zrUtil.isArray(e)?"applyTransform":"transformDirection"](e,r,i)},_dispatchHighDown:function(e,t){t&&t.length&&this.api.dispatchAction({type:e,batch:t})},dispose:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},remove:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()}});function createPolygon(e,t,i,a){return new graphic.Polygon({shape:{points:e},draggable:!!i,cursor:t,drift:i,onmousemove:function(e){eventTool.stop(e.event)},ondragend:a})}function createHandlePoints(e,t){return 0===e?[[0,0],[t,0],[t,-t]]:[[0,0],[t,0],[t,t]]}function createIndicatorPoints(e,t,i,a){return e?[[0,-mathMin(t,mathMax(i,0))],[HOVER_LINK_OUT,0],[0,mathMin(t,mathMax(a-i,0))]]:[[0,0],[5,-5],[5,5]]}function getHalfHoverLinkSize(e,t,i){var a=HOVER_LINK_SIZE/2,r=e.get("hoverLinkDataSize");return r&&(a=linearMap(r,t,i,!0)/2),a}function useHoverLinkOnHandle(e){var t=e.get("hoverLinkOnHandle");return!!(null==t?e.get("realtime"):t)}function getCursor(e){return"vertical"===e?"ns-resize":"ew-resize"}var _default=ContinuousView;module.exports=_default;
//# sourceMappingURL=/sm/5a6a62fd8c084b95f8aa373b8095d00ea24c4e463ddd446031780be335780ae3.map