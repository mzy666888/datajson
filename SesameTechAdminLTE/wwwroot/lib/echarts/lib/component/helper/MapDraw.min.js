/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/component/helper/MapDraw.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),RoamController=require("./RoamController"),roamHelper=require("../../component/helper/roamHelper"),_cursorHelper=require("../../component/helper/cursorHelper"),onIrrelevantElement=_cursorHelper.onIrrelevantElement,graphic=require("../../util/graphic"),geoSourceManager=require("../../coord/geo/geoSourceManager"),_component=require("../../util/component"),getUID=_component.getUID;function getFixedItemStyle(e){var t=e.getItemStyle(),o=e.get("areaColor");return null!=o&&(t.fill=o),t}function updateMapSelectHandler(e,t,o,r,a){o.off("click"),o.off("mousedown"),t.get("selectedMode")&&(o.on("mousedown",function(){e._mouseDownFlag=!0}),o.on("click",function(n){if(e._mouseDownFlag){e._mouseDownFlag=!1;for(var i=n.target;!i.__regions;)i=i.parent;if(i){var l={type:("geo"===t.mainType?"geo":"map")+"ToggleSelect",batch:zrUtil.map(i.__regions,function(e){return{name:e.name,from:a.uid}})};l[t.mainType+"Id"]=t.id,r.dispatchAction(l),updateMapSelected(t,o)}}}))}function updateMapSelected(e,t){t.eachChild(function(t){zrUtil.each(t.__regions,function(o){t.trigger(e.isSelected(o.name)?"emphasis":"normal")})})}function MapDraw(e,t){var o=new graphic.Group;this.uid=getUID("ec_map_draw"),this._controller=new RoamController(e.getZr()),this._controllerHost={target:t?o:null},this.group=o,this._updateGroup=t,this._mouseDownFlag,this._mapName,this._initialized,o.add(this._regionsGroup=new graphic.Group),o.add(this._backgroundGroup=new graphic.Group)}MapDraw.prototype={constructor:MapDraw,draw:function(e,t,o,r,a){var n="geo"===e.mainType,i=e.getData&&e.getData();n&&t.eachComponent({mainType:"series",subType:"map"},function(t){i||t.getHostGeoModel()!==e||(i=t.getData())});var l=e.coordinateSystem;this._updateBackground(l);var s=this._regionsGroup,p=this.group;l._roamTransformable.transform&&(p.transform=l._roamTransformable.transform.slice(),p.decomposeTransform());var c=l._rawTransformable.scale,m=l._rawTransformable.position;s.removeAll();var g=["itemStyle"],u=["emphasis","itemStyle"],h=["label"],d=["emphasis","label"],f=zrUtil.createHashMap();zrUtil.each(l.regions,function(t){var o=f.get(t.name)||f.set(t.name,new graphic.Group),r=new graphic.CompoundPath({segmentIgnoreThreshold:1,shape:{paths:[]}});o.add(r);var a,l=(U=e.getRegionModel(t.name)||e).getModel(g),_=U.getModel(u),v=getFixedItemStyle(l),y=getFixedItemStyle(_),w=U.getModel(h),S=U.getModel(d);if(i){a=i.indexOfName(t.name);var I=i.getItemVisual(a,"color",!0);I&&(v.fill=I)}var M=function(e){return[e[0]*c[0]+m[0],e[1]*c[1]+m[1]]};zrUtil.each(t.geometries,function(e){if("polygon"===e.type){for(var t=[],o=0;o<e.exterior.length;++o)t.push(M(e.exterior[o]));r.shape.paths.push(new graphic.Polygon({segmentIgnoreThreshold:1,shape:{points:t}}));for(o=0;o<(e.interiors?e.interiors.length:0);++o){for(var a=e.interiors[o],n=(t=[],0);n<a.length;++n)t.push(M(a[n]));r.shape.paths.push(new graphic.Polygon({segmentIgnoreThreshold:1,shape:{points:t}}))}}}),r.setStyle(v),r.style.strokeNoScale=!0,r.culling=!0;var x=w.get("show"),D=S.get("show"),T=i&&isNaN(i.get(i.mapDimension("value"),a)),b=i&&i.getItemLayout(a);if(n||T&&(x||D)||b&&b.showLabel){var z,G=n?t.name:a;(!i||a>=0)&&(z=e);var H=new graphic.Text({position:M(t.center.slice()),scale:[1/p.scale[0],1/p.scale[1]],z2:10,silent:!0});graphic.setLabelStyle(H.style,H.hoverStyle={},w,S,{labelFetcher:z,labelDataIndex:G,defaultText:t.name,useInsideStyle:!1},{textAlign:"center",textVerticalAlign:"middle"}),o.add(H)}if(i)i.setItemGraphicEl(a,o);else{var U=e.getRegionModel(t.name);r.eventData={componentType:"geo",componentIndex:e.componentIndex,geoIndex:e.componentIndex,name:t.name,region:U&&U.option||{}}}(o.__regions||(o.__regions=[])).push(t),o.highDownSilentOnTouch=!!e.get("selectedMode"),graphic.setHoverStyle(o,y),s.add(o)}),this._updateController(e,t,o),updateMapSelectHandler(this,e,s,o,r),updateMapSelected(e,s)},remove:function(){this._regionsGroup.removeAll(),this._backgroundGroup.removeAll(),this._controller.dispose(),this._mapName&&geoSourceManager.removeGraphic(this._mapName,this.uid),this._mapName=null,this._controllerHost={}},_updateBackground:function(e){var t=e.map;this._mapName!==t&&zrUtil.each(geoSourceManager.makeGraphic(t,this.uid),function(e){this._backgroundGroup.add(e)},this),this._mapName=t},_updateController:function(e,t,o){var r=e.coordinateSystem,a=this._controller,n=this._controllerHost;n.zoomLimit=e.get("scaleLimit"),n.zoom=r.getZoom(),a.enable(e.get("roam")||!1);var i=e.mainType;function l(){var t={type:"geoRoam",componentType:i};return t[i+"Id"]=e.id,t}a.off("pan").on("pan",function(e){this._mouseDownFlag=!1,roamHelper.updateViewOnPan(n,e.dx,e.dy),o.dispatchAction(zrUtil.extend(l(),{dx:e.dx,dy:e.dy}))},this),a.off("zoom").on("zoom",function(e){if(this._mouseDownFlag=!1,roamHelper.updateViewOnZoom(n,e.scale,e.originX,e.originY),o.dispatchAction(zrUtil.extend(l(),{zoom:e.scale,originX:e.originX,originY:e.originY})),this._updateGroup){var t=this.group.scale;this._regionsGroup.traverse(function(e){"text"===e.type&&e.attr("scale",[1/t[0],1/t[1]])})}},this),a.setPointerChecker(function(t,a,n){return r.getViewRectAfterRoam().contain(a,n)&&!onIrrelevantElement(t,o,e)})}};var _default=MapDraw;module.exports=_default;
//# sourceMappingURL=/sm/f66805c6f6e1f90d4ae7b688c6c742d4357082a45383470bb2bf7c6afd793f36.map