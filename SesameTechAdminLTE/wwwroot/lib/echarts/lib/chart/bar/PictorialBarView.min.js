/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/bar/PictorialBarView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var echarts=require("../../echarts"),zrUtil=require("zrender/lib/core/util"),graphic=require("../../util/graphic"),_symbol=require("../../util/symbol"),createSymbol=_symbol.createSymbol,_number=require("../../util/number"),parsePercent=_number.parsePercent,isNumeric=_number.isNumeric,_helper=require("./helper"),setLabel=_helper.setLabel,BAR_BORDER_WIDTH_QUERY=["itemStyle","borderWidth"],LAYOUT_ATTRS=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],pathForLineWidth=new graphic.Circle,BarView=echarts.extendChartView({type:"pictorialBar",render:function(e,t,a){var i=this.group,r=e.getData(),o=this._data,n=e.coordinateSystem,l=!!n.getBaseAxis().isHorizontal(),s=n.grid.getRect(),c={ecSize:{width:a.getWidth(),height:a.getHeight()},seriesModel:e,coordSys:n,coordSysExtent:[[s.x,s.x+s.width],[s.y,s.y+s.height]],isHorizontal:l,valueDim:LAYOUT_ATTRS[+l],categoryDim:LAYOUT_ATTRS[1-l]};return r.diff(o).add(function(e){if(r.hasValue(e)){var t=getItemModel(r,e),a=getSymbolMeta(r,e,t,c),o=createBar(r,c,a);r.setItemGraphicEl(e,o),i.add(o),updateCommon(o,c,a)}}).update(function(e,t){var a=o.getItemGraphicEl(t);if(r.hasValue(e)){var n=getItemModel(r,e),l=getSymbolMeta(r,e,n,c),s=getShapeStr(r,l);a&&s!==a.__pictorialShapeStr&&(i.remove(a),r.setItemGraphicEl(e,null),a=null),a?updateBar(a,c,l):a=createBar(r,c,l,!0),r.setItemGraphicEl(e,a),a.__pictorialSymbolMeta=l,i.add(a),updateCommon(a,c,l)}else i.remove(a)}).remove(function(e){var t=o.getItemGraphicEl(e);t&&removeBar(o,e,t.__pictorialSymbolMeta.animationModel,t)}).execute(),this._data=r,this.group},dispose:zrUtil.noop,remove:function(e,t){var a=this.group,i=this._data;e.get("animation")?i&&i.eachItemGraphicEl(function(t){removeBar(i,t.dataIndex,e,t)}):a.removeAll()}});function getSymbolMeta(e,t,a,i){var r=e.getItemLayout(t),o=a.get("symbolRepeat"),n=a.get("symbolClip"),l=a.get("symbolPosition")||"start",s=(a.get("symbolRotate")||0)*Math.PI/180||0,c=a.get("symbolPatternSize")||2,p=a.isAnimationEnabled(),d={dataIndex:t,layout:r,itemModel:a,symbolType:e.getItemVisual(t,"symbol")||"circle",color:e.getItemVisual(t,"color"),symbolClip:n,symbolRepeat:o,symbolRepeatDirection:a.get("symbolRepeatDirection"),symbolPatternSize:c,rotation:s,animationModel:p?a:null,hoverAnimation:p&&a.get("hoverAnimation"),z2:a.getShallow("z",!0)||0};prepareBarLength(a,o,r,i,d),prepareSymbolSize(e,t,r,o,n,d.boundingLength,d.pxSign,c,i,d),prepareLineWidth(a,d.symbolScale,s,i,d);var m=d.symbolSize,u=a.get("symbolOffset");return zrUtil.isArray(u)&&(u=[parsePercent(u[0],m[0]),parsePercent(u[1],m[1])]),prepareLayoutInfo(a,m,r,o,n,u,l,d.valueLineWidth,d.boundingLength,d.repeatCutLength,i,d),d}function prepareBarLength(e,t,a,i,r){var o,n=i.valueDim,l=e.get("symbolBoundingData"),s=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis()),c=s.toGlobalCoord(s.dataToCoord(0)),p=1-+(a[n.wh]<=0);if(zrUtil.isArray(l)){var d=[convertToCoordOnAxis(s,l[0])-c,convertToCoordOnAxis(s,l[1])-c];d[1]<d[0]&&d.reverse(),o=d[p]}else o=null!=l?convertToCoordOnAxis(s,l)-c:t?i.coordSysExtent[n.index][p]-c:a[n.wh];r.boundingLength=o,t&&(r.repeatCutLength=a[n.wh]),r.pxSign=o>0?1:o<0?-1:0}function convertToCoordOnAxis(e,t){return e.toGlobalCoord(e.dataToCoord(e.scale.parse(t)))}function prepareSymbolSize(e,t,a,i,r,o,n,l,s,c){var p=s.valueDim,d=s.categoryDim,m=Math.abs(a[d.wh]),u=e.getItemVisual(t,"symbolSize");zrUtil.isArray(u)?u=u.slice():(null==u&&(u="100%"),u=[u,u]),u[d.index]=parsePercent(u[d.index],m),u[p.index]=parsePercent(u[p.index],i?m:Math.abs(o)),c.symbolSize=u,(c.symbolScale=[u[0]/l,u[1]/l])[p.index]*=(s.isHorizontal?-1:1)*n}function prepareLineWidth(e,t,a,i,r){var o=e.get(BAR_BORDER_WIDTH_QUERY)||0;o&&(pathForLineWidth.attr({scale:t.slice(),rotation:a}),pathForLineWidth.updateTransform(),o/=pathForLineWidth.getLineScale(),o*=t[i.valueDim.index]),r.valueLineWidth=o}function prepareLayoutInfo(e,t,a,i,r,o,n,l,s,c,p,d){var m=p.categoryDim,u=p.valueDim,h=d.pxSign,g=Math.max(t[u.index]+l,0),y=g;if(i){var b=Math.abs(s),S=zrUtil.retrieve(e.get("symbolMargin"),"15%")+"",_=!1;S.lastIndexOf("!")===S.length-1&&(_=!0,S=S.slice(0,S.length-1)),S=parsePercent(S,t[u.index]);var v=Math.max(g+2*S,0),f=_?0:2*S,x=isNumeric(i),P=x?i:toIntTimes((b+f)/v);v=g+2*(S=(b-P*g)/2/(_?P:P-1)),f=_?0:2*S,x||"fixed"===i||(P=c?toIntTimes((Math.abs(c)+f)/v):0),y=P*v-f,d.repeatTimes=P,d.symbolMargin=S}var A=h*(y/2),M=d.pathPosition=[];M[m.index]=a[m.wh]/2,M[u.index]="start"===n?A:"end"===n?s-A:s/2,o&&(M[0]+=o[0],M[1]+=o[1]);var R=d.bundlePosition=[];R[m.index]=a[m.xy],R[u.index]=a[u.xy];var I=d.barRectShape=zrUtil.extend({},a);I[u.wh]=h*Math.max(Math.abs(a[u.wh]),Math.abs(M[u.index]+A)),I[m.wh]=a[m.wh];var B=d.clipShape={};B[m.xy]=-a[m.xy],B[m.wh]=p.ecSize[m.wh],B[u.xy]=0,B[u.wh]=a[u.wh]}function createPath(e){var t=e.symbolPatternSize,a=createSymbol(e.symbolType,-t/2,-t/2,t,t,e.color);return a.attr({culling:!0}),"image"!==a.type&&a.setStyle({strokeNoScale:!0}),a}function createOrUpdateRepeatSymbols(e,t,a,i){var r=e.__pictorialBundle,o=a.symbolSize,n=a.valueLineWidth,l=a.pathPosition,s=t.valueDim,c=a.repeatTimes||0,p=0,d=o[t.valueDim.index]+n+2*a.symbolMargin;for(eachPath(e,function(e){e.__pictorialAnimationIndex=p,e.__pictorialRepeatTimes=c,p<c?updateAttr(e,null,h(p),a,i):updateAttr(e,null,{scale:[0,0]},a,i,function(){r.remove(e)}),updateHoverAnimation(e,a),p++});p<c;p++){var m=createPath(a);m.__pictorialAnimationIndex=p,m.__pictorialRepeatTimes=c,r.add(m);var u=h(p);updateAttr(m,{position:u.position,scale:[0,0]},{scale:u.scale,rotation:u.rotation},a,i),m.on("mouseover",g).on("mouseout",y),updateHoverAnimation(m,a)}function h(e){var t=l.slice(),i=a.pxSign,r=e;return("start"===a.symbolRepeatDirection?i>0:i<0)&&(r=c-1-e),t[s.index]=d*(r-c/2+.5)+l[s.index],{position:t,scale:a.symbolScale.slice(),rotation:a.rotation}}function g(){eachPath(e,function(e){e.trigger("emphasis")})}function y(){eachPath(e,function(e){e.trigger("normal")})}}function createOrUpdateSingleSymbol(e,t,a,i){var r=e.__pictorialBundle,o=e.__pictorialMainPath;o?updateAttr(o,null,{position:a.pathPosition.slice(),scale:a.symbolScale.slice(),rotation:a.rotation},a,i):(o=e.__pictorialMainPath=createPath(a),r.add(o),updateAttr(o,{position:a.pathPosition.slice(),scale:[0,0],rotation:a.rotation},{scale:a.symbolScale.slice()},a,i),o.on("mouseover",function(){this.trigger("emphasis")}).on("mouseout",function(){this.trigger("normal")})),updateHoverAnimation(o,a)}function createOrUpdateBarRect(e,t,a){var i=zrUtil.extend({},t.barRectShape),r=e.__pictorialBarRect;r?updateAttr(r,null,{shape:i},t,a):(r=e.__pictorialBarRect=new graphic.Rect({z2:2,shape:i,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),e.add(r))}function createOrUpdateClip(e,t,a,i){if(a.symbolClip){var r=e.__pictorialClipPath,o=zrUtil.extend({},a.clipShape),n=t.valueDim,l=a.animationModel,s=a.dataIndex;if(r)graphic.updateProps(r,{shape:o},l,s);else{o[n.wh]=0,r=new graphic.Rect({shape:o}),e.__pictorialBundle.setClipPath(r),e.__pictorialClipPath=r;var c={};c[n.wh]=a.clipShape[n.wh],graphic[i?"updateProps":"initProps"](r,{shape:c},l,s)}}}function getItemModel(e,t){var a=e.getItemModel(t);return a.getAnimationDelayParams=getAnimationDelayParams,a.isAnimationEnabled=isAnimationEnabled,a}function getAnimationDelayParams(e){return{index:e.__pictorialAnimationIndex,count:e.__pictorialRepeatTimes}}function isAnimationEnabled(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function updateHoverAnimation(e,t){e.off("emphasis").off("normal");var a=t.symbolScale.slice();t.hoverAnimation&&e.on("emphasis",function(){this.animateTo({scale:[1.1*a[0],1.1*a[1]]},400,"elasticOut")}).on("normal",function(){this.animateTo({scale:a.slice()},400,"elasticOut")})}function createBar(e,t,a,i){var r=new graphic.Group,o=new graphic.Group;return r.add(o),r.__pictorialBundle=o,o.attr("position",a.bundlePosition.slice()),a.symbolRepeat?createOrUpdateRepeatSymbols(r,t,a):createOrUpdateSingleSymbol(r,t,a),createOrUpdateBarRect(r,a,i),createOrUpdateClip(r,t,a,i),r.__pictorialShapeStr=getShapeStr(e,a),r.__pictorialSymbolMeta=a,r}function updateBar(e,t,a){var i=a.animationModel,r=a.dataIndex,o=e.__pictorialBundle;graphic.updateProps(o,{position:a.bundlePosition.slice()},i,r),a.symbolRepeat?createOrUpdateRepeatSymbols(e,t,a,!0):createOrUpdateSingleSymbol(e,t,a,!0),createOrUpdateBarRect(e,a,!0),createOrUpdateClip(e,t,a,!0)}function removeBar(e,t,a,i){var r=i.__pictorialBarRect;r&&(r.style.text=null);var o=[];eachPath(i,function(e){o.push(e)}),i.__pictorialMainPath&&o.push(i.__pictorialMainPath),i.__pictorialClipPath&&(a=null),zrUtil.each(o,function(e){graphic.updateProps(e,{scale:[0,0]},a,t,function(){i.parent&&i.parent.remove(i)})}),e.setItemGraphicEl(t,null)}function getShapeStr(e,t){return[e.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function eachPath(e,t,a){zrUtil.each(e.__pictorialBundle.children(),function(i){i!==e.__pictorialBarRect&&t.call(a,i)})}function updateAttr(e,t,a,i,r,o){t&&e.attr(t),i.symbolClip&&!r?a&&e.attr(a):a&&graphic[r?"updateProps":"initProps"](e,a,i.animationModel,i.dataIndex,o)}function updateCommon(e,t,a){var i=a.color,r=a.dataIndex,o=a.itemModel,n=o.getModel("itemStyle").getItemStyle(["color"]),l=o.getModel("emphasis.itemStyle").getItemStyle(),s=o.getShallow("cursor");eachPath(e,function(e){e.setColor(i),e.setStyle(zrUtil.defaults({fill:i,opacity:a.opacity},n)),graphic.setHoverStyle(e,l),s&&(e.cursor=s),e.z2=a.z2});var c={},p=t.valueDim.posDesc[+(a.boundingLength>0)],d=e.__pictorialBarRect;setLabel(d.style,c,o,i,t.seriesModel,r,p),graphic.setHoverStyle(d,c)}function toIntTimes(e){var t=Math.round(e);return Math.abs(e-t)<1e-4?t:Math.ceil(e)}var _default=BarView;module.exports=_default;
//# sourceMappingURL=/sm/76348910b1a2e00136ea4ae28aa06989fae4f70a3432dac74fb3256ae95577fc.map