/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/treemap/treemapLayout.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),BoundingRect=require("zrender/lib/core/BoundingRect"),_number=require("../../util/number"),parsePercent=_number.parsePercent,MAX_SAFE_INTEGER=_number.MAX_SAFE_INTEGER,layout=require("../../util/layout"),helper=require("../helper/treeHelper"),mathMax=Math.max,mathMin=Math.min,retrieveValue=zrUtil.retrieve,each=zrUtil.each,PATH_BORDER_WIDTH=["itemStyle","borderWidth"],PATH_GAP_WIDTH=["itemStyle","gapWidth"],PATH_UPPER_LABEL_SHOW=["upperLabel","show"],PATH_UPPER_LABEL_HEIGHT=["upperLabel","height"],_default={seriesType:"treemap",reset:function(e,t,r,a){var i=r.getWidth(),n=r.getHeight(),o=e.option,u=layout.getLayoutRect(e.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()}),h=o.size||[],l=parsePercent(retrieveValue(u.width,h[0]),i),g=parsePercent(retrieveValue(u.height,h[1]),n),s=a&&a.type,d=helper.retrieveTargetInfo(a,["treemapZoomToNode","treemapRootToNode"],e),v="treemapRender"===s||"treemapMove"===s?a.rootRect:null,f=e.getViewRoot(),c=helper.getPathToRoot(f);if("treemapMove"!==s){var p="treemapZoomToNode"===s?estimateRootSize(e,d,f,l,g):v?[v.width,v.height]:[l,g],y=o.sort;y&&"asc"!==y&&"desc"!==y&&(y="desc");var m={squareRatio:o.squareRatio,sort:y,leafDepth:o.leafDepth};f.hostTree.clearLayouts();var L={x:0,y:0,width:p[0],height:p[1],area:p[0]*p[1]};f.setLayout(L),squarify(f,m,!1,0);L=f.getLayout();each(c,function(e,t){var r=(c[t+1]||f).getValue();e.setLayout(zrUtil.extend({dataExtent:[r,r],borderWidth:0,upperHeight:0},L))})}var R=e.getData().tree.root;R.setLayout(calculateRootPosition(u,v,d),!0),e.setLayoutInfo(u),prunning(R,new BoundingRect(-u.x,-u.y,i,n),c,f,0)}};function squarify(e,t,r,a){var i,n;if(!e.isRemoved()){var o=e.getLayout();i=o.width,n=o.height;var u=(v=e.getModel()).get(PATH_BORDER_WIDTH),h=v.get(PATH_GAP_WIDTH)/2,l=getUpperLabelHeight(v),g=Math.max(u,l),s=u-h,d=g-h,v=e.getModel();e.setLayout({borderWidth:u,upperHeight:g,upperLabelHeight:l},!0);var f=(i=mathMax(i-2*s,0))*(n=mathMax(n-s-d,0)),c=initChildren(e,v,f,t,r,a);if(c.length){var p={x:s,y:d,width:i,height:n},y=mathMin(i,n),m=1/0,L=[];L.area=0;for(var R=0,_=c.length;R<_;){var x=c[R];L.push(x),L.area+=x.getLayout().area;var T=worst(L,y,t.squareRatio);T<=m?(R++,m=T):(L.area-=L.pop().getLayout().area,position(L,y,p,h,!1),y=mathMin(p.width,p.height),L.length=L.area=0,m=1/0)}if(L.length&&position(L,y,p,h,!0),!r){var E=v.get("childrenVisibleMin");null!=E&&f<E&&(r=!0)}for(R=0,_=c.length;R<_;R++)squarify(c[R],t,r,a+1)}}}function initChildren(e,t,r,a,i,n){var o=e.children||[],u=a.sort;"asc"!==u&&"desc"!==u&&(u=null);var h=null!=a.leafDepth&&a.leafDepth<=n;if(i&&!h)return e.viewChildren=[];sort(o=zrUtil.filter(o,function(e){return!e.isRemoved()}),u);var l=statistic(t,o,u);if(0===l.sum)return e.viewChildren=[];if(l.sum=filterByThreshold(t,r,l.sum,u,o),0===l.sum)return e.viewChildren=[];for(var g=0,s=o.length;g<s;g++){var d=o[g].getValue()/l.sum*r;o[g].setLayout({area:d})}return h&&(o.length&&e.setLayout({isLeafRoot:!0},!0),o.length=0),e.viewChildren=o,e.setLayout({dataExtent:l.dataExtent},!0),o}function filterByThreshold(e,t,r,a,i){if(!a)return r;for(var n=e.get("visibleMin"),o=i.length,u=o,h=o-1;h>=0;h--){var l=i["asc"===a?o-h-1:h].getValue();l/r*t<n&&(u=h,r-=l)}return"asc"===a?i.splice(0,o-u):i.splice(u,o-u),r}function sort(e,t){return t&&e.sort(function(e,r){var a="asc"===t?e.getValue()-r.getValue():r.getValue()-e.getValue();return 0===a?"asc"===t?e.dataIndex-r.dataIndex:r.dataIndex-e.dataIndex:a}),e}function statistic(e,t,r){for(var a=0,i=0,n=t.length;i<n;i++)a+=t[i].getValue();var o=e.get("visualDimension");if(t&&t.length)if("value"===o&&r)u=[t[t.length-1].getValue(),t[0].getValue()],"asc"===r&&u.reverse();else{var u=[1/0,-1/0];each(t,function(e){var t=e.getValue(o);t<u[0]&&(u[0]=t),t>u[1]&&(u[1]=t)})}else u=[NaN,NaN];return{sum:a,dataExtent:u}}function worst(e,t,r){for(var a,i=0,n=1/0,o=0,u=e.length;o<u;o++)(a=e[o].getLayout().area)&&(a<n&&(n=a),a>i&&(i=a));var h=e.area*e.area,l=t*t*r;return h?mathMax(l*i/h,h/(l*n)):1/0}function position(e,t,r,a,i){var n=t===r.width?0:1,o=1-n,u=["x","y"],h=["width","height"],l=r[u[n]],g=t?e.area/t:0;(i||g>r[h[o]])&&(g=r[h[o]]);for(var s=0,d=e.length;s<d;s++){var v=e[s],f={},c=g?v.getLayout().area/g:0,p=f[h[o]]=mathMax(g-2*a,0),y=r[u[n]]+r[h[n]]-l,m=s===d-1||y<c?y:c,L=f[h[n]]=mathMax(m-2*a,0);f[u[o]]=r[u[o]]+mathMin(a,p/2),f[u[n]]=l+mathMin(a,L/2),l+=m,v.setLayout(f,!0)}r[u[o]]+=g,r[h[o]]-=g}function estimateRootSize(e,t,r,a,i){var n,o=(t||{}).node,u=[a,i];if(!o||o===r)return u;for(var h=a*i,l=h*e.option.zoomToNodeRatio;n=o.parentNode;){for(var g=0,s=n.children,d=0,v=s.length;d<v;d++)g+=s[d].getValue();var f=o.getValue();if(0===f)return u;l*=g/f;var c=n.getModel(),p=c.get(PATH_BORDER_WIDTH);(l+=4*p*p+(3*p+Math.max(p,getUpperLabelHeight(c,p)))*Math.pow(l,.5))>MAX_SAFE_INTEGER&&(l=MAX_SAFE_INTEGER),o=n}l<h&&(l=h);var y=Math.pow(l/h,.5);return[a*y,i*y]}function calculateRootPosition(e,t,r){if(t)return{x:t.x,y:t.y};var a={x:0,y:0};if(!r)return a;var i=r.node,n=i.getLayout();if(!n)return a;for(var o=[n.width/2,n.height/2],u=i;u;){var h=u.getLayout();o[0]+=h.x,o[1]+=h.y,u=u.parentNode}return{x:e.width/2-o[0],y:e.height/2-o[1]}}function prunning(e,t,r,a,i){var n=e.getLayout(),o=r[i],u=o&&o===e;if(!(o&&!u||i===r.length&&e!==a)){e.setLayout({isInView:!0,invisible:!u&&!t.intersect(n),isAboveViewRoot:u},!0);var h=new BoundingRect(t.x-n.x,t.y-n.y,t.width,t.height);each(e.viewChildren||[],function(e){prunning(e,h,r,a,i+1)})}}function getUpperLabelHeight(e){return e.get(PATH_UPPER_LABEL_SHOW)?e.get(PATH_UPPER_LABEL_HEIGHT):0}module.exports=_default;
//# sourceMappingURL=/sm/6e518893d745d0e5823ce420e780c9321e0558a050a82afd0823828480d6c012.map