/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/tree/TreeView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var zrUtil=require("zrender/lib/core/util"),graphic=require("../../util/graphic"),SymbolClz=require("../helper/Symbol"),_layoutHelper=require("./layoutHelper"),radialCoordinate=_layoutHelper.radialCoordinate,echarts=require("../../echarts"),bbox=require("zrender/lib/core/bbox"),View=require("../../coord/View"),roamHelper=require("../../component/helper/roamHelper"),RoamController=require("../../component/helper/RoamController"),_cursorHelper=require("../../component/helper/cursorHelper"),onIrrelevantElement=_cursorHelper.onIrrelevantElement,_default=echarts.extendChartView({type:"tree",init:function(e,t){this._oldTree,this._mainGroup=new graphic.Group,this._controller=new RoamController(t.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},render:function(e,t,a,o){var r=e.getData(),i=e.layoutInfo,n=this._mainGroup,l=e.get("layout");"radial"===l?n.attr("position",[i.x+i.width/2,i.y+i.height/2]):n.attr("position",[i.x,i.y]),this._updateViewCoordSys(e,i,l),this._updateController(e,t,a);var d=this._data,s={expandAndCollapse:e.get("expandAndCollapse"),layout:l,orient:e.getOrient(),curvature:e.get("lineStyle.curveness"),symbolRotate:e.get("symbolRotate"),symbolOffset:e.get("symbolOffset"),hoverAnimation:e.get("hoverAnimation"),useNameLabel:!0,fadeIn:!0};r.diff(d).add(function(t){symbolNeedsDraw(r,t)&&updateNode(r,t,null,n,e,s)}).update(function(t,a){var o=d.getItemGraphicEl(a);symbolNeedsDraw(r,t)?updateNode(r,t,o,n,e,s):o&&removeNode(d,a,o,n,e,s)}).remove(function(t){var a=d.getItemGraphicEl(t);a&&removeNode(d,t,a,n,e,s)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),!0===s.expandAndCollapse&&r.eachItemGraphicEl(function(t,o){t.off("click").on("click",function(){a.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:o})})}),this._data=r},_updateViewCoordSys:function(e){var t=e.getData(),a=[];t.each(function(e){var o=t.getItemLayout(e);!o||isNaN(o.x)||isNaN(o.y)||a.push([+o.x,+o.y])});var o=[],r=[];bbox.fromPoints(a,o,r);var i=this._min,n=this._max;r[0]-o[0]==0&&(o[0]=i?i[0]:o[0]-1,r[0]=n?n[0]:r[0]+1),r[1]-o[1]==0&&(o[1]=i?i[1]:o[1]-1,r[1]=n?n[1]:r[1]+1);var l=e.coordinateSystem=new View;l.zoomLimit=e.get("scaleLimit"),l.setBoundingRect(o[0],o[1],r[0]-o[0],r[1]-o[1]),l.setCenter(e.get("center")),l.setZoom(e.get("zoom")),this.group.attr({position:l.position,scale:l.scale}),this._viewCoordSys=l,this._min=o,this._max=r},_updateController:function(e,t,a){var o=this._controller,r=this._controllerHost,i=this.group;o.setPointerChecker(function(t,o,r){var n=i.getBoundingRect();return n.applyTransform(i.transform),n.contain(o,r)&&!onIrrelevantElement(t,a,e)}),o.enable(e.get("roam")),r.zoomLimit=e.get("scaleLimit"),r.zoom=e.coordinateSystem.getZoom(),o.off("pan").off("zoom").on("pan",function(t){roamHelper.updateViewOnPan(r,t.dx,t.dy),a.dispatchAction({seriesId:e.id,type:"treeRoam",dx:t.dx,dy:t.dy})},this).on("zoom",function(t){roamHelper.updateViewOnZoom(r,t.scale,t.originX,t.originY),a.dispatchAction({seriesId:e.id,type:"treeRoam",zoom:t.scale,originX:t.originX,originY:t.originY}),this._updateNodeAndLinkScale(e)},this)},_updateNodeAndLinkScale:function(e){var t=e.getData(),a=this._getNodeGlobalScale(e),o=[a,a];t.eachItemGraphicEl(function(e,t){e.attr("scale",o)})},_getNodeGlobalScale:function(e){var t=e.coordinateSystem;if("view"!==t.type)return 1;var a=this._nodeScaleRatio,o=t.scale,r=o&&o[0]||1;return((t.getZoom()-1)*a+1)/r},dispose:function(){this._controller&&this._controller.dispose(),this._controllerHost={}},remove:function(){this._mainGroup.removeAll(),this._data=null}});function symbolNeedsDraw(e,t){var a=e.getItemLayout(t);return a&&!isNaN(a.x)&&!isNaN(a.y)&&"none"!==e.getItemVisual(t,"symbol")}function getTreeNodeStyle(e,t,a){return a.itemModel=t,a.itemStyle=t.getModel("itemStyle").getItemStyle(),a.hoverItemStyle=t.getModel("emphasis.itemStyle").getItemStyle(),a.lineStyle=t.getModel("lineStyle").getLineStyle(),a.labelModel=t.getModel("label"),a.hoverLabelModel=t.getModel("emphasis.label"),!1===e.isExpand&&0!==e.children.length?a.symbolInnerColor=a.itemStyle.fill:a.symbolInnerColor="#fff",a}function updateNode(e,t,a,o,r,i){var n=!a,l=e.tree.getNodeByDataIndex(t),d=l.getModel(),s=(i=getTreeNodeStyle(l,d,i),e.tree.root),p=l.parentNode===s?l:l.parentNode||l,c=e.getItemGraphicEl(p.dataIndex),u=p.getLayout(),h=c?{x:c.position[0],y:c.position[1],rawX:c.__radialOldRawX,rawY:c.__radialOldRawY}:u,y=l.getLayout();n?(a=new SymbolClz(e,t,i)).attr("position",[h.x,h.y]):a.updateData(e,t,i),a.__radialOldRawX=a.__radialRawX,a.__radialOldRawY=a.__radialRawY,a.__radialRawX=y.rawX,a.__radialRawY=y.rawY,o.add(a),e.setItemGraphicEl(t,a),graphic.updateProps(a,{position:[y.x,y.y]},r);var g=a.getSymbolPath();if("radial"===i.layout){var m,x,_=s.children[0],f=_.getLayout(),v=_.children.length;if(y.x===f.x&&!0===l.isExpand){var S={};S.x=(_.children[0].getLayout().x+_.children[v-1].getLayout().x)/2,S.y=(_.children[0].getLayout().y+_.children[v-1].getLayout().y)/2,(m=Math.atan2(S.y-f.y,S.x-f.x))<0&&(m=2*Math.PI+m),(x=S.x<f.x)&&(m-=Math.PI)}else(m=Math.atan2(y.y-f.y,y.x-f.x))<0&&(m=2*Math.PI+m),0===l.children.length||0!==l.children.length&&!1===l.isExpand?(x=y.x<f.x)&&(m-=Math.PI):(x=y.x>f.x)||(m-=Math.PI);var N=x?"left":"right",w=i.labelModel.get("rotate"),b=w*(Math.PI/180);g.setStyle({textPosition:i.labelModel.get("position")||N,textRotation:null==w?-m:b,textOrigin:"center",verticalAlign:"middle"})}if(l.parentNode&&l.parentNode!==s){var I=a.__edge;I||(I=a.__edge=new graphic.BezierCurve({shape:getEdgeShape(i,h,h),style:zrUtil.defaults({opacity:0,strokeNoScale:!0},i.lineStyle)})),graphic.updateProps(I,{shape:getEdgeShape(i,u,y),style:{opacity:1}},r),o.add(I)}}function removeNode(e,t,a,o,r,i){for(var n,l=e.tree.getNodeByDataIndex(t),d=e.tree.root,s=l.getModel(),p=(i=getTreeNodeStyle(l,s,i),l.parentNode===d?l:l.parentNode||l);null==(n=p.getLayout());)p=p.parentNode===d?p:p.parentNode||p;graphic.updateProps(a,{position:[n.x+1,n.y+1]},r,function(){o.remove(a),e.setItemGraphicEl(t,null)}),a.fadeOut(null,{keepLabel:!0});var c=a.__edge;c&&graphic.updateProps(c,{shape:getEdgeShape(i,n,n),style:{opacity:0}},r,function(){o.remove(c)})}function getEdgeShape(e,t,a){var o,r,i,n,l,d,s,p,c=e.orient;if("radial"===e.layout){l=t.rawX,s=t.rawY,d=a.rawX,p=a.rawY;var u=radialCoordinate(l,s),h=radialCoordinate(l,s+(p-s)*e.curvature),y=radialCoordinate(d,p+(s-p)*e.curvature),g=radialCoordinate(d,p);return{x1:u.x,y1:u.y,x2:g.x,y2:g.y,cpx1:h.x,cpy1:h.y,cpx2:y.x,cpy2:y.y}}return l=t.x,s=t.y,d=a.x,p=a.y,"LR"!==c&&"RL"!==c||(o=l+(d-l)*e.curvature,r=s,i=d+(l-d)*e.curvature,n=p),"TB"!==c&&"BT"!==c||(o=l,r=s+(p-s)*e.curvature,i=d,n=p+(s-p)*e.curvature),{x1:l,y1:s,x2:d,y2:p,cpx1:o,cpy1:r,cpx2:i,cpy2:n}}module.exports=_default;
//# sourceMappingURL=/sm/01526c34d93e3e39260a66aa93053d42184ac39837315dd6049eec53f5b6be86.map