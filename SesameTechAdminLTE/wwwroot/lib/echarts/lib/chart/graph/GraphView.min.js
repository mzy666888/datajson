/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/graph/GraphView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var echarts=require("../../echarts"),zrUtil=require("zrender/lib/core/util"),SymbolDraw=require("../helper/SymbolDraw"),LineDraw=require("../helper/LineDraw"),RoamController=require("../../component/helper/RoamController"),roamHelper=require("../../component/helper/roamHelper"),_cursorHelper=require("../../component/helper/cursorHelper"),onIrrelevantElement=_cursorHelper.onIrrelevantElement,graphic=require("../../util/graphic"),adjustEdge=require("./adjustEdge"),_graphHelper=require("./graphHelper"),getNodeGlobalScale=_graphHelper.getNodeGlobalScale,FOCUS_ADJACENCY="__focusNodeAdjacency",UNFOCUS_ADJACENCY="__unfocusNodeAdjacency",nodeOpacityPath=["itemStyle","opacity"],lineOpacityPath=["lineStyle","opacity"];function getItemOpacity(e,t){var a=e.getVisual("opacity");return null!=a?a:e.getModel().get(t)}function fadeOutItem(e,t,a){var o=e.getGraphicEl(),i=getItemOpacity(e,t);null!=a&&(null==i&&(i=1),i*=a),o.downplay&&o.downplay(),o.traverse(function(e){if(!e.isGroup){var t=e.lineLabelOriginalOpacity;null!=t&&null==a||(t=i),e.setStyle("opacity",t)}})}function fadeInItem(e,t){var a=getItemOpacity(e,t),o=e.getGraphicEl();o.traverse(function(e){!e.isGroup&&e.setStyle("opacity",a)}),o.highlight&&o.highlight()}var _default=echarts.extendChartView({type:"graph",init:function(e,t){var a=new SymbolDraw,o=new LineDraw,i=this.group;this._controller=new RoamController(t.getZr()),this._controllerHost={target:i},i.add(a.group),i.add(o.group),this._symbolDraw=a,this._lineDraw=o,this._firstRender=!0},render:function(e,t,a){var o=e.coordinateSystem;this._model=e;var i=this._symbolDraw,n=this._lineDraw,r=this.group;if("view"===o.type){var d={position:o.position,scale:o.scale};this._firstRender?r.attr(d):graphic.updateProps(r,d,e)}adjustEdge(e.getGraph(),getNodeGlobalScale(e));var c=e.getData();i.updateData(c);var l=e.getEdgeData();n.updateData(l),this._updateNodeAndLinkScale(),this._updateController(e,t,a),clearTimeout(this._layoutTimeout);var u=e.forceLayout,s=e.get("force.layoutAnimation");u&&this._startForceLayoutIteration(u,s),c.eachItemGraphicEl(function(t,o){var i=c.getItemModel(o);t.off("drag").off("dragend");var n=i.get("draggable");n&&t.on("drag",function(){u&&(u.warmUp(),!this._layouting&&this._startForceLayoutIteration(u,s),u.setFixed(o),c.setItemLayout(o,t.position))},this).on("dragend",function(){u&&u.setUnfixed(o)},this),t.setDraggable(n&&u),t[FOCUS_ADJACENCY]&&t.off("mouseover",t[FOCUS_ADJACENCY]),t[UNFOCUS_ADJACENCY]&&t.off("mouseout",t[UNFOCUS_ADJACENCY]),i.get("focusNodeAdjacency")&&(t.on("mouseover",t[FOCUS_ADJACENCY]=function(){a.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,dataIndex:t.dataIndex})}),t.on("mouseout",t[UNFOCUS_ADJACENCY]=function(){a.dispatchAction({type:"unfocusNodeAdjacency",seriesId:e.id})}))},this),c.graph.eachEdge(function(t){var o=t.getGraphicEl();o[FOCUS_ADJACENCY]&&o.off("mouseover",o[FOCUS_ADJACENCY]),o[UNFOCUS_ADJACENCY]&&o.off("mouseout",o[UNFOCUS_ADJACENCY]),t.getModel().get("focusNodeAdjacency")&&(o.on("mouseover",o[FOCUS_ADJACENCY]=function(){a.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,edgeDataIndex:t.dataIndex})}),o.on("mouseout",o[UNFOCUS_ADJACENCY]=function(){a.dispatchAction({type:"unfocusNodeAdjacency",seriesId:e.id})}))});var p="circular"===e.get("layout")&&e.get("circular.rotateLabel"),h=c.getLayout("cx"),g=c.getLayout("cy");c.eachItemGraphicEl(function(e,t){var a=c.getItemModel(t).get("label.rotate")||0,o=e.getSymbolPath();if(p){var i=c.getItemLayout(t),n=Math.atan2(i[1]-g,i[0]-h);n<0&&(n=2*Math.PI+n);var r=i[0]<h;r&&(n-=Math.PI);var d=r?"left":"right";graphic.modifyLabelStyle(o,{textRotation:-n,textPosition:d,textOrigin:"center"},{textPosition:d})}else graphic.modifyLabelStyle(o,{textRotation:a*=Math.PI/180})}),this._firstRender=!1},dispose:function(){this._controller&&this._controller.dispose(),this._controllerHost={}},focusNodeAdjacency:function(e,t,a,o){var i=this._model.getData().graph,n=o.dataIndex,r=o.edgeDataIndex,d=i.getNodeByIndex(n),c=i.getEdgeByIndex(r);(d||c)&&(i.eachNode(function(e){fadeOutItem(e,nodeOpacityPath,.1)}),i.eachEdge(function(e){fadeOutItem(e,lineOpacityPath,.1)}),d&&(fadeInItem(d,nodeOpacityPath),zrUtil.each(d.edges,function(e){e.dataIndex<0||(fadeInItem(e,lineOpacityPath),fadeInItem(e.node1,nodeOpacityPath),fadeInItem(e.node2,nodeOpacityPath))})),c&&(fadeInItem(c,lineOpacityPath),fadeInItem(c.node1,nodeOpacityPath),fadeInItem(c.node2,nodeOpacityPath)))},unfocusNodeAdjacency:function(e,t,a,o){var i=this._model.getData().graph;i.eachNode(function(e){fadeOutItem(e,nodeOpacityPath)}),i.eachEdge(function(e){fadeOutItem(e,lineOpacityPath)})},_startForceLayoutIteration:function(e,t){var a=this;!function o(){e.step(function(e){a.updateLayout(a._model),(a._layouting=!e)&&(t?a._layoutTimeout=setTimeout(o,16):o())})}()},_updateController:function(e,t,a){var o=this._controller,i=this._controllerHost,n=this.group;o.setPointerChecker(function(t,o,i){var r=n.getBoundingRect();return r.applyTransform(n.transform),r.contain(o,i)&&!onIrrelevantElement(t,a,e)}),"view"===e.coordinateSystem.type?(o.enable(e.get("roam")),i.zoomLimit=e.get("scaleLimit"),i.zoom=e.coordinateSystem.getZoom(),o.off("pan").off("zoom").on("pan",function(t){roamHelper.updateViewOnPan(i,t.dx,t.dy),a.dispatchAction({seriesId:e.id,type:"graphRoam",dx:t.dx,dy:t.dy})}).on("zoom",function(t){roamHelper.updateViewOnZoom(i,t.scale,t.originX,t.originY),a.dispatchAction({seriesId:e.id,type:"graphRoam",zoom:t.scale,originX:t.originX,originY:t.originY}),this._updateNodeAndLinkScale(),adjustEdge(e.getGraph(),getNodeGlobalScale(e)),this._lineDraw.updateLayout()},this)):o.disable()},_updateNodeAndLinkScale:function(){var e=this._model,t=e.getData(),a=getNodeGlobalScale(e),o=[a,a];t.eachItemGraphicEl(function(e,t){e.attr("scale",o)})},updateLayout:function(e){adjustEdge(e.getGraph(),getNodeGlobalScale(e)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},remove:function(e,t){this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()}});module.exports=_default;
//# sourceMappingURL=/sm/1d759779a46131fb55fc41fa8ad16fa00373f886451a7a8afcbf5f178662b85e.map