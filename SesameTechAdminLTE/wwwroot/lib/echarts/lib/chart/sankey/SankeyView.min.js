/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/sankey/SankeyView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var graphic=require("../../util/graphic"),echarts=require("../../echarts"),zrUtil=require("zrender/lib/core/util"),nodeOpacityPath=["itemStyle","opacity"],lineOpacityPath=["lineStyle","opacity"];function getItemOpacity(e,t){return e.getVisual("opacity")||e.getModel().get(t)}function fadeOutItem(e,t,a){var n=e.getGraphicEl(),d=getItemOpacity(e,t);null!=a&&(null==d&&(d=1),d*=a),n.downplay&&n.downplay(),n.traverse(function(e){"group"!==e.type&&e.setStyle("opacity",d)})}function fadeInItem(e,t){var a=getItemOpacity(e,t),n=e.getGraphicEl();n.highlight&&n.highlight(),n.traverse(function(e){"group"!==e.type&&e.setStyle("opacity",a)})}var SankeyShape=graphic.extendShape({shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,cpx2:0,cpy2:0,extent:0,orient:""},buildPath:function(e,t){var a=t.extent;e.moveTo(t.x1,t.y1),e.bezierCurveTo(t.cpx1,t.cpy1,t.cpx2,t.cpy2,t.x2,t.y2),"vertical"===t.orient?(e.lineTo(t.x2+a,t.y2),e.bezierCurveTo(t.cpx2+a,t.cpy2,t.cpx1+a,t.cpy1,t.x1+a,t.y1)):(e.lineTo(t.x2,t.y2+a),e.bezierCurveTo(t.cpx2,t.cpy2+a,t.cpx1,t.cpy1+a,t.x1,t.y1+a)),e.closePath()}}),_default=echarts.extendChartView({type:"sankey",_model:null,_focusAdjacencyDisabled:!1,render:function(e,t,a){var n=this,d=e.getGraph(),i=this.group,c=e.layoutInfo,o=c.width,l=c.height,s=e.getData(),y=e.getData("edge"),h=e.get("orient");this._model=e,i.removeAll(),i.attr("position",[c.x,c.y]),d.eachEdge(function(t){var a=new SankeyShape;a.dataIndex=t.dataIndex,a.seriesIndex=e.seriesIndex,a.dataType="edge";var n,d,c,s,r,u,p,g,f=t.getModel("lineStyle"),I=f.get("curveness"),x=t.node1.getLayout(),m=t.node1.getModel(),v=m.get("localX"),O=m.get("localY"),S=t.node2.getLayout(),A=t.node2.getModel(),P=A.get("localX"),b=A.get("localY"),j=t.getLayout();switch(a.shape.extent=Math.max(1,j.dy),a.shape.orient=h,"vertical"===h?(n=(null!=v?v*o:x.x)+j.sy,d=(null!=O?O*l:x.y)+x.dy,c=(null!=P?P*o:S.x)+j.ty,r=n,u=d*(1-I)+(s=null!=b?b*l:S.y)*I,p=c,g=d*I+s*(1-I)):(n=(null!=v?v*o:x.x)+x.dx,d=(null!=O?O*l:x.y)+j.sy,r=n*(1-I)+(c=null!=P?P*o:S.x)*I,u=d,p=n*I+c*(1-I),g=s=(null!=b?b*l:S.y)+j.ty),a.setShape({x1:n,y1:d,x2:c,y2:s,cpx1:r,cpy1:u,cpx2:p,cpy2:g}),a.setStyle(f.getItemStyle()),a.style.fill){case"source":a.style.fill=t.node1.getVisual("color");break;case"target":a.style.fill=t.node2.getVisual("color")}graphic.setHoverStyle(a,t.getModel("emphasis.lineStyle").getItemStyle()),i.add(a),y.setItemGraphicEl(t.dataIndex,a)}),d.eachNode(function(t){var a=t.getLayout(),n=t.getModel(),d=n.get("localX"),c=n.get("localY"),y=n.getModel("label"),h=n.getModel("emphasis.label"),r=new graphic.Rect({shape:{x:null!=d?d*o:a.x,y:null!=c?c*l:a.y,width:a.dx,height:a.dy},style:n.getModel("itemStyle").getItemStyle()}),u=t.getModel("emphasis.itemStyle").getItemStyle();graphic.setLabelStyle(r.style,u,y,h,{labelFetcher:e,labelDataIndex:t.dataIndex,defaultText:t.id,isRectText:!0}),r.setStyle("fill",t.getVisual("color")),graphic.setHoverStyle(r,u),i.add(r),s.setItemGraphicEl(t.dataIndex,r),r.dataType="node"}),s.eachItemGraphicEl(function(t,d){var i=s.getItemModel(d);i.get("draggable")&&(t.drift=function(t,i){n._focusAdjacencyDisabled=!0,this.shape.x+=t,this.shape.y+=i,this.dirty(),a.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:s.getRawIndex(d),localX:this.shape.x/o,localY:this.shape.y/l})},t.ondragend=function(){n._focusAdjacencyDisabled=!1},t.draggable=!0,t.cursor="move"),i.get("focusNodeAdjacency")&&(t.off("mouseover").on("mouseover",function(){n._focusAdjacencyDisabled||a.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,dataIndex:t.dataIndex})}),t.off("mouseout").on("mouseout",function(){n._focusAdjacencyDisabled||a.dispatchAction({type:"unfocusNodeAdjacency",seriesId:e.id})}))}),y.eachItemGraphicEl(function(t,d){y.getItemModel(d).get("focusNodeAdjacency")&&(t.off("mouseover").on("mouseover",function(){n._focusAdjacencyDisabled||a.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,edgeDataIndex:t.dataIndex})}),t.off("mouseout").on("mouseout",function(){n._focusAdjacencyDisabled||a.dispatchAction({type:"unfocusNodeAdjacency",seriesId:e.id})}))}),!this._data&&e.get("animation")&&i.setClipPath(createGridClipShape(i.getBoundingRect(),e,function(){i.removeClipPath()})),this._data=e.getData()},dispose:function(){},focusNodeAdjacency:function(e,t,a,n){var d=this._model.getData(),i=d.graph,c=n.dataIndex,o=d.getItemModel(c),l=n.edgeDataIndex;if(null!=c||null!=l){var s=i.getNodeByIndex(c),y=i.getEdgeByIndex(l);if(i.eachNode(function(e){fadeOutItem(e,nodeOpacityPath,.1)}),i.eachEdge(function(e){fadeOutItem(e,lineOpacityPath,.1)}),s){fadeInItem(s,nodeOpacityPath);var h=o.get("focusNodeAdjacency");"outEdges"===h?zrUtil.each(s.outEdges,function(e){e.dataIndex<0||(fadeInItem(e,lineOpacityPath),fadeInItem(e.node2,nodeOpacityPath))}):"inEdges"===h?zrUtil.each(s.inEdges,function(e){e.dataIndex<0||(fadeInItem(e,lineOpacityPath),fadeInItem(e.node1,nodeOpacityPath))}):"allEdges"===h&&zrUtil.each(s.edges,function(e){e.dataIndex<0||(fadeInItem(e,lineOpacityPath),fadeInItem(e.node1,nodeOpacityPath),fadeInItem(e.node2,nodeOpacityPath))})}y&&(fadeInItem(y,lineOpacityPath),fadeInItem(y.node1,nodeOpacityPath),fadeInItem(y.node2,nodeOpacityPath))}},unfocusNodeAdjacency:function(e,t,a,n){var d=this._model.getGraph();d.eachNode(function(e){fadeOutItem(e,nodeOpacityPath)}),d.eachEdge(function(e){fadeOutItem(e,lineOpacityPath)})}});function createGridClipShape(e,t,a){var n=new graphic.Rect({shape:{x:e.x-10,y:e.y-10,width:0,height:e.height+20}});return graphic.initProps(n,{shape:{width:e.width+20,height:e.height+20}},t,a),n}module.exports=_default;
//# sourceMappingURL=/sm/4e0e7171c8442b15695807590328e0f014339d661d71665327bcea2d966715ba.map