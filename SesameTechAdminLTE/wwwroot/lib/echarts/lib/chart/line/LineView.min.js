/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/echarts@4.5.0/lib/chart/line/LineView.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var _config=require("../../config"),__DEV__=_config.__DEV__,zrUtil=require("zrender/lib/core/util"),SymbolDraw=require("../helper/SymbolDraw"),SymbolClz=require("../helper/Symbol"),lineAnimationDiff=require("./lineAnimationDiff"),graphic=require("../../util/graphic"),modelUtil=require("../../util/model"),_poly=require("./poly"),Polyline=_poly.Polyline,Polygon=_poly.Polygon,ChartView=require("../../view/Chart"),_helper=require("./helper"),prepareDataCoordInfo=_helper.prepareDataCoordInfo,getStackedOnPoint=_helper.getStackedOnPoint,_createClipPathFromCoordSys=require("../helper/createClipPathFromCoordSys"),createGridClipPath=_createClipPathFromCoordSys.createGridClipPath,createPolarClipPath=_createClipPathFromCoordSys.createPolarClipPath;function isPointsSame(t,e){if(t.length===e.length){for(var o=0;o<t.length;o++){var i=t[o],n=e[o];if(i[0]!==n[0]||i[1]!==n[1])return}return!0}}function getSmooth(t){return"number"==typeof t?t:t?.5:0}function getStackedOnPoints(t,e,o){if(!o.valueDim)return[];for(var i=[],n=0,r=e.count();n<r;n++)i.push(getStackedOnPoint(o,t,e,n));return i}function turnPointsIntoStep(t,e,o){for(var i=e.getBaseAxis(),n="x"===i.dim||"radius"===i.dim?0:1,r=[],a=0;a<t.length-1;a++){var s=t[a+1],l=t[a];r.push(l);var h=[];switch(o){case"end":h[n]=s[n],h[1-n]=l[1-n],r.push(h);break;case"middle":var p=(l[n]+s[n])/2,u=[];h[n]=u[n]=p,h[1-n]=l[1-n],u[1-n]=s[1-n],r.push(h),r.push(u);break;default:h[n]=l[n],h[1-n]=s[1-n],r.push(h)}}return t[a]&&r.push(t[a]),r}function getVisualGradient(t,e){var o=t.getVisual("visualMeta");if(o&&o.length&&t.count()&&"cartesian2d"===e.type){for(var i,n,r=o.length-1;r>=0;r--){var a=o[r].dimension,s=t.dimensions[a],l=t.getDimensionInfo(s);if("x"===(i=l&&l.coordDim)||"y"===i){n=o[r];break}}if(n){var h=e.getAxis(i),p=zrUtil.map(n.stops,function(t){return{coord:h.toGlobalCoord(h.dataToCoord(t.value)),color:t.color}}),u=p.length,c=n.outerColors.slice();u&&p[0].coord>p[u-1].coord&&(p.reverse(),c.reverse());var d=p[0].coord-10,g=p[u-1].coord+10,m=g-d;if(m<.001)return"transparent";zrUtil.each(p,function(t){t.offset=(t.coord-d)/m}),p.push({offset:u?p[u-1].offset:.5,color:c[1]||"transparent"}),p.unshift({offset:u?p[0].offset:.5,color:c[0]||"transparent"});var f=new graphic.LinearGradient(0,0,0,0,p,!0);return f[i]=d,f[i+"2"]=g,f}}}function getIsIgnoreFunc(t,e,o){var i=t.get("showAllSymbol"),n="auto"===i;if(!i||n){var r=o.getAxesByScale("ordinal")[0];if(r&&(!n||!canShowAllSymbolForCategory(r,e))){var a=e.mapDimension(r.dim),s={};return zrUtil.each(r.getViewLabels(),function(t){s[t.tickValue]=1}),function(t){return!s.hasOwnProperty(e.get(a,t))}}}}function canShowAllSymbolForCategory(t,e){var o=t.getExtent(),i=Math.abs(o[1]-o[0])/t.scale.count();isNaN(i)&&(i=0);for(var n=e.count(),r=Math.max(1,Math.round(n/5)),a=0;a<n;a+=r)if(1.5*SymbolClz.getSymbolSize(e,a)[t.isHorizontal()?1:0]>i)return!1;return!0}function createLineClipPath(t,e,o){if("cartesian2d"===t.type){var i=t.getBaseAxis().isHorizontal(),n=createGridClipPath(t,e,o);if(!o.get("clip",!0)){var r=n.shape,a=Math.max(r.width,r.height);i?(r.y-=a,r.height+=2*a):(r.x-=a,r.width+=2*a)}return n}return createPolarClipPath(t,e,o)}var _default=ChartView.extend({type:"line",init:function(){var t=new graphic.Group,e=new SymbolDraw;this.group.add(e.group),this._symbolDraw=e,this._lineGroup=t},render:function(t,e,o){var i=t.coordinateSystem,n=this.group,r=t.getData(),a=t.getModel("lineStyle"),s=t.getModel("areaStyle"),l=r.mapArray(r.getItemLayout),h="polar"===i.type,p=this._coordSys,u=this._symbolDraw,c=this._polyline,d=this._polygon,g=this._lineGroup,m=t.get("animation"),f=!s.isEmpty(),y=s.get("origin"),_=getStackedOnPoints(i,r,prepareDataCoordInfo(i,r,y)),v=t.get("showSymbol"),S=v&&!h&&getIsIgnoreFunc(t,r,i),P=this._data;P&&P.eachItemGraphicEl(function(t,e){t.__temp&&(n.remove(t),P.setItemGraphicEl(e,null))}),v||u.remove(),n.add(g);var C,w=!h&&t.get("step");i&&i.getArea&&(null!=(C=i.getArea()).width?(C.x-=.1,C.y-=.1,C.width+=.2,C.height+=.2):C.r0&&(C.r0-=.5,C.r1+=.5)),c&&p.type===i.type&&w===this._step?(f&&!d?d=this._newPolygon(l,_,i,m):d&&!f&&(g.remove(d),d=this._polygon=null),g.setClipPath(createLineClipPath(i,!1,t)),v&&u.updateData(r,{isIgnore:S,clipShape:C}),r.eachItemGraphicEl(function(t){t.stopAnimation(!0)}),isPointsSame(this._stackedOnPoints,_)&&isPointsSame(this._points,l)||(m?this._updateAnimation(r,_,i,o,w,y):(w&&(l=turnPointsIntoStep(l,i,w),_=turnPointsIntoStep(_,i,w)),c.setShape({points:l}),d&&d.setShape({points:l,stackedOnPoints:_})))):(v&&u.updateData(r,{isIgnore:S,clipShape:C}),w&&(l=turnPointsIntoStep(l,i,w),_=turnPointsIntoStep(_,i,w)),c=this._newPolyline(l,i,m),f&&(d=this._newPolygon(l,_,i,m)),g.setClipPath(createLineClipPath(i,!0,t)));var I=getVisualGradient(r,i)||r.getVisual("color");c.useStyle(zrUtil.defaults(a.getLineStyle(),{fill:"none",stroke:I,lineJoin:"bevel"}));var b=t.get("smooth");if(b=getSmooth(t.get("smooth")),c.setShape({smooth:b,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")}),d){var D=r.getCalculationInfo("stackedOnSeries"),G=0;d.useStyle(zrUtil.defaults(s.getAreaStyle(),{fill:I,opacity:.7,lineJoin:"bevel"})),D&&(G=getSmooth(D.get("smooth"))),d.setShape({smooth:b,stackedOnSmooth:G,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")})}this._data=r,this._coordSys=i,this._stackedOnPoints=_,this._points=l,this._step=w,this._valueOrigin=y},dispose:function(){},highlight:function(t,e,o,i){var n=t.getData(),r=modelUtil.queryDataIndex(n,i);if(!(r instanceof Array)&&null!=r&&r>=0){var a=n.getItemGraphicEl(r);if(!a){var s=n.getItemLayout(r);if(!s)return;(a=new SymbolClz(n,r)).position=s,a.setZ(t.get("zlevel"),t.get("z")),a.ignore=isNaN(s[0])||isNaN(s[1]),a.__temp=!0,n.setItemGraphicEl(r,a),a.stopSymbolAnimation(!0),this.group.add(a)}a.highlight()}else ChartView.prototype.highlight.call(this,t,e,o,i)},downplay:function(t,e,o,i){var n=t.getData(),r=modelUtil.queryDataIndex(n,i);if(null!=r&&r>=0){var a=n.getItemGraphicEl(r);a&&(a.__temp?(n.setItemGraphicEl(r,null),this.group.remove(a)):a.downplay())}else ChartView.prototype.downplay.call(this,t,e,o,i)},_newPolyline:function(t){var e=this._polyline;return e&&this._lineGroup.remove(e),e=new Polyline({shape:{points:t},silent:!0,z2:10}),this._lineGroup.add(e),this._polyline=e,e},_newPolygon:function(t,e){var o=this._polygon;return o&&this._lineGroup.remove(o),o=new Polygon({shape:{points:t,stackedOnPoints:e},silent:!0}),this._lineGroup.add(o),this._polygon=o,o},_updateAnimation:function(t,e,o,i,n,r){var a=this._polyline,s=this._polygon,l=t.hostModel,h=lineAnimationDiff(this._data,t,this._stackedOnPoints,e,this._coordSys,o,this._valueOrigin,r),p=h.current,u=h.stackedOnCurrent,c=h.next,d=h.stackedOnNext;n&&(p=turnPointsIntoStep(h.current,o,n),u=turnPointsIntoStep(h.stackedOnCurrent,o,n),c=turnPointsIntoStep(h.next,o,n),d=turnPointsIntoStep(h.stackedOnNext,o,n)),a.shape.__points=h.current,a.shape.points=p,graphic.updateProps(a,{shape:{points:c}},l),s&&(s.setShape({points:p,stackedOnPoints:u}),graphic.updateProps(s,{shape:{points:c,stackedOnPoints:d}},l));for(var g=[],m=h.status,f=0;f<m.length;f++){if("="===m[f].cmd){var y=t.getItemGraphicEl(m[f].idx1);y&&g.push({el:y,ptIdx:f})}}a.animators&&a.animators.length&&a.animators[0].during(function(){for(var t=0;t<g.length;t++){g[t].el.attr("position",a.shape.__points[g[t].ptIdx])}})},remove:function(t){var e=this.group,o=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),o&&o.eachItemGraphicEl(function(t,i){t.__temp&&(e.remove(t),o.setItemGraphicEl(i,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._data=null}});module.exports=_default;
//# sourceMappingURL=/sm/4535ba866fcabf2bc72b5bed96af8a0b132f4571d4371acc14b142b9fa6771e8.map